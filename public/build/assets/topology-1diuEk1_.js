import{e as yi,g as bi,U as C,r as x,b as wi,j as g}from"./app-B4fkVL-W.js";import{M as vi,c as Ni,C as Tr}from"./monitor-layout-X6KElx1m.js";import{g as Mo}from"./device-icons-DptdtEPD.js";import{r as ki}from"./index-BxzREqLW.js";import"./index-DqCvxCPs.js";import{N as Hn,S as Si}from"./server-DqELNAlQ.js";import{P as Ei,S as Ar,T as Ir,U as _i}from"./upload-apSv_Ahe.js";import{C as Ci,X as nn,a as Mi}from"./x-BxlU8eWN.js";import{S as Dr}from"./search-lVQvEiEL.js";import{R as Pn}from"./refresh-cw-vpVBQ_Bj.js";import{C as jr}from"./chevron-up-D7DcPQoO.js";import{S as $i}from"./save-DSWTMF-c.js";import{D as Ti}from"./download-BBdqAOwr.js";import{c as Ai}from"./createLucideIcon-dVGcEtEt.js";import"./app-hK0G8rfC.js";import"./activity-6clVTxZj.js";import"./wifi-DG7M9WHp.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ii=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],Di=Ai("Link2",Ii);function ji(e,t,n={x:250,y:150}){if(e.length===0)return e;const r=new Map;e.forEach(f=>r.set(f.id,[])),t.forEach(f=>{const b=r.get(f.source)||[];b.push(f.target),r.set(f.source,b)});const o=new Set;t.forEach(f=>o.add(f.target));const s=e.filter(f=>!o.has(f.id)),i=s.length>0?s:[e[0]],a=new Map,c=new Set,u=[];for(i.forEach(f=>{u.push({id:f.id,level:0}),a.set(f.id,0)});u.length>0;){const{id:f,level:b}=u.shift();if(c.has(f))continue;c.add(f),(r.get(f)||[]).forEach(v=>{if(!c.has(v)){const m=b+1;(!a.has(v)||a.get(v)>m)&&(a.set(v,m),u.push({id:v,level:m}))}})}e.forEach(f=>{if(!a.has(f.id)){const b=Math.max(...Array.from(a.values()),-1);a.set(f.id,b+1)}});const l=new Map;e.forEach(f=>{const b=a.get(f.id)||0;l.has(b)||l.set(b,[]),l.get(b).push(f)}),Math.max(...Array.from(l.keys()));const d=0,p=0;return e.map(f=>{const b=a.get(f.id)||0,y=l.get(b)||[],v=y.findIndex(w=>w.id===f.id),m=y.length,S=(m-1)*n.x,M=m>1?-S/2:0;return{...f,position:{x:d+M+v*n.x,y:p+b*n.y}}})}function zi(e,t=150){if(e.length===0)return e;const n=0,o=-((e.length-1)*t)/2;return e.map((s,i)=>({...s,position:{x:o+i*t,y:i%2===0?n-80:n+80}}))}function Ri(e,t=200){if(e.length===0)return e;const n=0,r=0,o=2*Math.PI/e.length;return e.map((s,i)=>{const a=i*o-Math.PI/2;return{...s,position:{x:n+t*Math.cos(a),y:r+t*Math.sin(a)}}})}function Hi(e,t=200){if(e.length===0)return e;const n=0,r=0;if(e.length===1)return[{...e[0],position:{x:n,y:r}}];const o={...e[0],position:{x:n,y:r}},s=e.slice(1).map((i,a)=>{const c=2*Math.PI*a/(e.length-1)-Math.PI/2;return{...i,position:{x:n+t*Math.cos(c),y:r+t*Math.sin(c)}}});return[o,...s]}function Pi(e,t=150){if(e.length===0)return e;const n=0,r=0;if(e.length===1)return[{...e[0],position:{x:n,y:r}}];const o={...e[0],position:{x:n,y:r}},s=Math.min(4,Math.floor((e.length-1)/2)),i=e.slice(1,1+s).map((c,u)=>{const l=2*Math.PI*u/s-Math.PI/2;return{...c,position:{x:n+t*Math.cos(l),y:r+t*Math.sin(l)}}}),a=e.slice(1+s).map((c,u)=>{const l=u%s,d=i[l],p=2*Math.PI*u/(e.length-1-s)-Math.PI/2;return{...c,position:{x:d.position.x+t*.6*Math.cos(p),y:d.position.y+t*.6*Math.sin(p)}}});return[o,...i,...a]}function Li(e,t=200){if(e.length===0)return e;const n=0,r=0,o=2*Math.PI/e.length;return e.map((s,i)=>{const a=i*o-Math.PI/2;return{...s,position:{x:n+t*Math.cos(a),y:r+t*Math.sin(a)}}})}function Oi(e,t,n,r){switch(n){case"bus":return zi(e,150);case"ring":return Ri(e,200);case"star":return Hi(e,200);case"extended-star":return Pi(e,150);case"hierarchical":return ji(e,t,{x:200,y:120});case"mesh":return Li(e,200);default:return e}}function ve(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let n=0,r;n<e.length;n++)(r=ve(e[n]))!==""&&(t+=(t&&" ")+r);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}var Ln={exports:{}},On={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zr;function Fi(){if(zr)return On;zr=1;var e=yi(),t=ki();function n(u,l){return u===l&&(u!==0||1/u===1/l)||u!==u&&l!==l}var r=typeof Object.is=="function"?Object.is:n,o=t.useSyncExternalStore,s=e.useRef,i=e.useEffect,a=e.useMemo,c=e.useDebugValue;return On.useSyncExternalStoreWithSelector=function(u,l,d,p,f){var b=s(null);if(b.current===null){var y={hasValue:!1,value:null};b.current=y}else y=b.current;b=a(function(){function m($){if(!S){if(S=!0,M=$,$=p($),f!==void 0&&y.hasValue){var z=y.value;if(f(z,$))return w=z}return w=$}if(z=w,r(M,$))return z;var H=p($);return f!==void 0&&f(z,H)?(M=$,z):(M=$,w=H)}var S=!1,M,w,T=d===void 0?null:d;return[function(){return m(l())},T===null?void 0:function(){return m(T())}]},[l,d,p,f]);var v=o(u,b[0],b[1]);return i(function(){y.hasValue=!0,y.value=v},[v]),c(v),v},On}var Rr;function Bi(){return Rr||(Rr=1,Ln.exports=Fi()),Ln.exports}var Vi=Bi();const Xi=bi(Vi),Yi={},Hr=e=>{let t;const n=new Set,r=(l,d)=>{const p=typeof l=="function"?l(t):l;if(!Object.is(p,t)){const f=t;t=d??(typeof p!="object"||p===null)?p:Object.assign({},t,p),n.forEach(b=>b(t,f))}},o=()=>t,c={setState:r,getState:o,getInitialState:()=>u,subscribe:l=>(n.add(l),()=>n.delete(l)),destroy:()=>{(Yi?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},u=t=e(r,o,c);return c},Wi=e=>e?Hr(e):Hr,{useDebugValue:Ui}=C,{useSyncExternalStoreWithSelector:Zi}=Xi,qi=e=>e;function $o(e,t=qi,n){const r=Zi(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return Ui(r),r}const Pr=(e,t)=>{const n=Wi(e),r=(o,s=t)=>$o(n,o,s);return Object.assign(r,n),r},Ki=(e,t)=>e?Pr(e,t):Pr;function be(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[r,o]of e)if(!Object.is(o,t.get(r)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const r of n)if(!Object.prototype.hasOwnProperty.call(t,r)||!Object.is(e[r],t[r]))return!1;return!0}var Gi={value:()=>{}};function Sn(){for(var e=0,t=arguments.length,n={},r;e<t;++e){if(!(r=arguments[e]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new hn(n)}function hn(e){this._=e}function Qi(e,t){return e.trim().split(/^|\s+/).map(function(n){var r="",o=n.indexOf(".");if(o>=0&&(r=n.slice(o+1),n=n.slice(0,o)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}hn.prototype=Sn.prototype={constructor:hn,on:function(e,t){var n=this._,r=Qi(e+"",n),o,s=-1,i=r.length;if(arguments.length<2){for(;++s<i;)if((o=(e=r[s]).type)&&(o=Ji(n[o],e.name)))return o;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<i;)if(o=(e=r[s]).type)n[o]=Lr(n[o],e.name,t);else if(t==null)for(o in n)n[o]=Lr(n[o],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new hn(e)},call:function(e,t){if((o=arguments.length-2)>0)for(var n=new Array(o),r=0,o,s;r<o;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=this._[e],r=0,o=s.length;r<o;++r)s[r].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],o=0,s=r.length;o<s;++o)r[o].value.apply(t,n)}};function Ji(e,t){for(var n=0,r=e.length,o;n<r;++n)if((o=e[n]).name===t)return o.value}function Lr(e,t,n){for(var r=0,o=e.length;r<o;++r)if(e[r].name===t){e[r]=Gi,e=e.slice(0,r).concat(e.slice(r+1));break}return n!=null&&e.push({name:t,value:n}),e}var Gn="http://www.w3.org/1999/xhtml";const Or={svg:"http://www.w3.org/2000/svg",xhtml:Gn,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function En(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),Or.hasOwnProperty(t)?{space:Or[t],local:e}:e}function ea(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Gn&&t.documentElement.namespaceURI===Gn?t.createElement(e):t.createElementNS(n,e)}}function ta(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function To(e){var t=En(e);return(t.local?ta:ea)(t)}function na(){}function hr(e){return e==null?na:function(){return this.querySelector(e)}}function ra(e){typeof e!="function"&&(e=hr(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var s=t[o],i=s.length,a=r[o]=new Array(i),c,u,l=0;l<i;++l)(c=s[l])&&(u=e.call(c,c.__data__,l,s))&&("__data__"in c&&(u.__data__=c.__data__),a[l]=u);return new Ce(r,this._parents)}function oa(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function sa(){return[]}function Ao(e){return e==null?sa:function(){return this.querySelectorAll(e)}}function ia(e){return function(){return oa(e.apply(this,arguments))}}function aa(e){typeof e=="function"?e=ia(e):e=Ao(e);for(var t=this._groups,n=t.length,r=[],o=[],s=0;s<n;++s)for(var i=t[s],a=i.length,c,u=0;u<a;++u)(c=i[u])&&(r.push(e.call(c,c.__data__,u,i)),o.push(c));return new Ce(r,o)}function Io(e){return function(){return this.matches(e)}}function Do(e){return function(t){return t.matches(e)}}var la=Array.prototype.find;function ca(e){return function(){return la.call(this.children,e)}}function ua(){return this.firstElementChild}function da(e){return this.select(e==null?ua:ca(typeof e=="function"?e:Do(e)))}var fa=Array.prototype.filter;function ha(){return Array.from(this.children)}function pa(e){return function(){return fa.call(this.children,e)}}function ga(e){return this.selectAll(e==null?ha:pa(typeof e=="function"?e:Do(e)))}function ma(e){typeof e!="function"&&(e=Io(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var s=t[o],i=s.length,a=r[o]=[],c,u=0;u<i;++u)(c=s[u])&&e.call(c,c.__data__,u,s)&&a.push(c);return new Ce(r,this._parents)}function jo(e){return new Array(e.length)}function xa(){return new Ce(this._enter||this._groups.map(jo),this._parents)}function xn(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}xn.prototype={constructor:xn,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function ya(e){return function(){return e}}function ba(e,t,n,r,o,s){for(var i=0,a,c=t.length,u=s.length;i<u;++i)(a=t[i])?(a.__data__=s[i],r[i]=a):n[i]=new xn(e,s[i]);for(;i<c;++i)(a=t[i])&&(o[i]=a)}function wa(e,t,n,r,o,s,i){var a,c,u=new Map,l=t.length,d=s.length,p=new Array(l),f;for(a=0;a<l;++a)(c=t[a])&&(p[a]=f=i.call(c,c.__data__,a,t)+"",u.has(f)?o[a]=c:u.set(f,c));for(a=0;a<d;++a)f=i.call(e,s[a],a,s)+"",(c=u.get(f))?(r[a]=c,c.__data__=s[a],u.delete(f)):n[a]=new xn(e,s[a]);for(a=0;a<l;++a)(c=t[a])&&u.get(p[a])===c&&(o[a]=c)}function va(e){return e.__data__}function Na(e,t){if(!arguments.length)return Array.from(this,va);var n=t?wa:ba,r=this._parents,o=this._groups;typeof e!="function"&&(e=ya(e));for(var s=o.length,i=new Array(s),a=new Array(s),c=new Array(s),u=0;u<s;++u){var l=r[u],d=o[u],p=d.length,f=ka(e.call(l,l&&l.__data__,u,r)),b=f.length,y=a[u]=new Array(b),v=i[u]=new Array(b),m=c[u]=new Array(p);n(l,d,y,v,m,f,t);for(var S=0,M=0,w,T;S<b;++S)if(w=y[S]){for(S>=M&&(M=S+1);!(T=v[M])&&++M<b;);w._next=T||null}}return i=new Ce(i,r),i._enter=a,i._exit=c,i}function ka(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Sa(){return new Ce(this._exit||this._groups.map(jo),this._parents)}function Ea(e,t,n){var r=this.enter(),o=this,s=this.exit();return typeof e=="function"?(r=e(r),r&&(r=r.selection())):r=r.append(e+""),t!=null&&(o=t(o),o&&(o=o.selection())),n==null?s.remove():n(s),r&&o?r.merge(o).order():o}function _a(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,o=n.length,s=r.length,i=Math.min(o,s),a=new Array(o),c=0;c<i;++c)for(var u=n[c],l=r[c],d=u.length,p=a[c]=new Array(d),f,b=0;b<d;++b)(f=u[b]||l[b])&&(p[b]=f);for(;c<o;++c)a[c]=n[c];return new Ce(a,this._parents)}function Ca(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r=e[t],o=r.length-1,s=r[o],i;--o>=0;)(i=r[o])&&(s&&i.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(i,s),s=i);return this}function Ma(e){e||(e=$a);function t(d,p){return d&&p?e(d.__data__,p.__data__):!d-!p}for(var n=this._groups,r=n.length,o=new Array(r),s=0;s<r;++s){for(var i=n[s],a=i.length,c=o[s]=new Array(a),u,l=0;l<a;++l)(u=i[l])&&(c[l]=u);c.sort(t)}return new Ce(o,this._parents).order()}function $a(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Ta(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Aa(){return Array.from(this)}function Ia(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],o=0,s=r.length;o<s;++o){var i=r[o];if(i)return i}return null}function Da(){let e=0;for(const t of this)++e;return e}function ja(){return!this.node()}function za(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var o=t[n],s=0,i=o.length,a;s<i;++s)(a=o[s])&&e.call(a,a.__data__,s,o);return this}function Ra(e){return function(){this.removeAttribute(e)}}function Ha(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Pa(e,t){return function(){this.setAttribute(e,t)}}function La(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Oa(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function Fa(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Ba(e,t){var n=En(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((t==null?n.local?Ha:Ra:typeof t=="function"?n.local?Fa:Oa:n.local?La:Pa)(n,t))}function zo(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Va(e){return function(){this.style.removeProperty(e)}}function Xa(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Ya(e,t,n){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function Wa(e,t,n){return arguments.length>1?this.each((t==null?Va:typeof t=="function"?Ya:Xa)(e,t,n??"")):St(this.node(),e)}function St(e,t){return e.style.getPropertyValue(t)||zo(e).getComputedStyle(e,null).getPropertyValue(t)}function Ua(e){return function(){delete this[e]}}function Za(e,t){return function(){this[e]=t}}function qa(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function Ka(e,t){return arguments.length>1?this.each((t==null?Ua:typeof t=="function"?qa:Za)(e,t)):this.node()[e]}function Ro(e){return e.trim().split(/^|\s+/)}function pr(e){return e.classList||new Ho(e)}function Ho(e){this._node=e,this._names=Ro(e.getAttribute("class")||"")}Ho.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function Po(e,t){for(var n=pr(e),r=-1,o=t.length;++r<o;)n.add(t[r])}function Lo(e,t){for(var n=pr(e),r=-1,o=t.length;++r<o;)n.remove(t[r])}function Ga(e){return function(){Po(this,e)}}function Qa(e){return function(){Lo(this,e)}}function Ja(e,t){return function(){(t.apply(this,arguments)?Po:Lo)(this,e)}}function el(e,t){var n=Ro(e+"");if(arguments.length<2){for(var r=pr(this.node()),o=-1,s=n.length;++o<s;)if(!r.contains(n[o]))return!1;return!0}return this.each((typeof t=="function"?Ja:t?Ga:Qa)(n,t))}function tl(){this.textContent=""}function nl(e){return function(){this.textContent=e}}function rl(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function ol(e){return arguments.length?this.each(e==null?tl:(typeof e=="function"?rl:nl)(e)):this.node().textContent}function sl(){this.innerHTML=""}function il(e){return function(){this.innerHTML=e}}function al(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function ll(e){return arguments.length?this.each(e==null?sl:(typeof e=="function"?al:il)(e)):this.node().innerHTML}function cl(){this.nextSibling&&this.parentNode.appendChild(this)}function ul(){return this.each(cl)}function dl(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function fl(){return this.each(dl)}function hl(e){var t=typeof e=="function"?e:To(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function pl(){return null}function gl(e,t){var n=typeof e=="function"?e:To(e),r=t==null?pl:typeof t=="function"?t:hr(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function ml(){var e=this.parentNode;e&&e.removeChild(this)}function xl(){return this.each(ml)}function yl(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function bl(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function wl(e){return this.select(e?bl:yl)}function vl(e){return arguments.length?this.property("__data__",e):this.node().__data__}function Nl(e){return function(t){e.call(this,t,this.__data__)}}function kl(e){return e.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");return r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),{type:t,name:n}})}function Sl(e){return function(){var t=this.__on;if(t){for(var n=0,r=-1,o=t.length,s;n<o;++n)s=t[n],(!e.type||s.type===e.type)&&s.name===e.name?this.removeEventListener(s.type,s.listener,s.options):t[++r]=s;++r?t.length=r:delete this.__on}}}function El(e,t,n){return function(){var r=this.__on,o,s=Nl(t);if(r){for(var i=0,a=r.length;i<a;++i)if((o=r[i]).type===e.type&&o.name===e.name){this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=s,o.options=n),o.value=t;return}}this.addEventListener(e.type,s,n),o={type:e.type,name:e.name,value:t,listener:s,options:n},r?r.push(o):this.__on=[o]}}function _l(e,t,n){var r=kl(e+""),o,s=r.length,i;if(arguments.length<2){var a=this.node().__on;if(a){for(var c=0,u=a.length,l;c<u;++c)for(o=0,l=a[c];o<s;++o)if((i=r[o]).type===l.type&&i.name===l.name)return l.value}return}for(a=t?El:Sl,o=0;o<s;++o)this.each(a(r[o],t,n));return this}function Oo(e,t,n){var r=zo(e),o=r.CustomEvent;typeof o=="function"?o=new o(t,n):(o=r.document.createEvent("Event"),n?(o.initEvent(t,n.bubbles,n.cancelable),o.detail=n.detail):o.initEvent(t,!1,!1)),e.dispatchEvent(o)}function Cl(e,t){return function(){return Oo(this,e,t)}}function Ml(e,t){return function(){return Oo(this,e,t.apply(this,arguments))}}function $l(e,t){return this.each((typeof t=="function"?Ml:Cl)(e,t))}function*Tl(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],o=0,s=r.length,i;o<s;++o)(i=r[o])&&(yield i)}var Fo=[null];function Ce(e,t){this._groups=e,this._parents=t}function Kt(){return new Ce([[document.documentElement]],Fo)}function Al(){return this}Ce.prototype=Kt.prototype={constructor:Ce,select:ra,selectAll:aa,selectChild:da,selectChildren:ga,filter:ma,data:Na,enter:xa,exit:Sa,join:Ea,merge:_a,selection:Al,order:Ca,sort:Ma,call:Ta,nodes:Aa,node:Ia,size:Da,empty:ja,each:za,attr:Ba,style:Wa,property:Ka,classed:el,text:ol,html:ll,raise:ul,lower:fl,append:hl,insert:gl,remove:xl,clone:wl,datum:vl,on:_l,dispatch:$l,[Symbol.iterator]:Tl};function Te(e){return typeof e=="string"?new Ce([[document.querySelector(e)]],[document.documentElement]):new Ce([[e]],Fo)}function Il(e){let t;for(;t=e.sourceEvent;)e=t;return e}function Ie(e,t){if(e=Il(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}if(t.getBoundingClientRect){var o=t.getBoundingClientRect();return[e.clientX-o.left-t.clientLeft,e.clientY-o.top-t.clientTop]}}return[e.pageX,e.pageY]}const Dl={passive:!1},Ot={capture:!0,passive:!1};function Fn(e){e.stopImmediatePropagation()}function vt(e){e.preventDefault(),e.stopImmediatePropagation()}function Bo(e){var t=e.document.documentElement,n=Te(e).on("dragstart.drag",vt,Ot);"onselectstart"in t?n.on("selectstart.drag",vt,Ot):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Vo(e,t){var n=e.document.documentElement,r=Te(e).on("dragstart.drag",null);t&&(r.on("click.drag",vt,Ot),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const rn=e=>()=>e;function Qn(e,{sourceEvent:t,subject:n,target:r,identifier:o,active:s,x:i,y:a,dx:c,dy:u,dispatch:l}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:o,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:i,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:l}})}Qn.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function jl(e){return!e.ctrlKey&&!e.button}function zl(){return this.parentNode}function Rl(e,t){return t??{x:e.x,y:e.y}}function Hl(){return navigator.maxTouchPoints||"ontouchstart"in this}function Pl(){var e=jl,t=zl,n=Rl,r=Hl,o={},s=Sn("start","drag","end"),i=0,a,c,u,l,d=0;function p(w){w.on("mousedown.drag",f).filter(r).on("touchstart.drag",v).on("touchmove.drag",m,Dl).on("touchend.drag touchcancel.drag",S).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function f(w,T){if(!(l||!e.call(this,w,T))){var $=M(this,t.call(this,w,T),w,T,"mouse");$&&(Te(w.view).on("mousemove.drag",b,Ot).on("mouseup.drag",y,Ot),Bo(w.view),Fn(w),u=!1,a=w.clientX,c=w.clientY,$("start",w))}}function b(w){if(vt(w),!u){var T=w.clientX-a,$=w.clientY-c;u=T*T+$*$>d}o.mouse("drag",w)}function y(w){Te(w.view).on("mousemove.drag mouseup.drag",null),Vo(w.view,u),vt(w),o.mouse("end",w)}function v(w,T){if(e.call(this,w,T)){var $=w.changedTouches,z=t.call(this,w,T),H=$.length,I,P;for(I=0;I<H;++I)(P=M(this,z,w,T,$[I].identifier,$[I]))&&(Fn(w),P("start",w,$[I]))}}function m(w){var T=w.changedTouches,$=T.length,z,H;for(z=0;z<$;++z)(H=o[T[z].identifier])&&(vt(w),H("drag",w,T[z]))}function S(w){var T=w.changedTouches,$=T.length,z,H;for(l&&clearTimeout(l),l=setTimeout(function(){l=null},500),z=0;z<$;++z)(H=o[T[z].identifier])&&(Fn(w),H("end",w,T[z]))}function M(w,T,$,z,H,I){var P=s.copy(),F=Ie(I||$,T),B,L,h;if((h=n.call(w,new Qn("beforestart",{sourceEvent:$,target:p,identifier:H,active:i,x:F[0],y:F[1],dx:0,dy:0,dispatch:P}),z))!=null)return B=h.x-F[0]||0,L=h.y-F[1]||0,function _(N,A,R){var k=F,D;switch(N){case"start":o[H]=_,D=i++;break;case"end":delete o[H],--i;case"drag":F=Ie(R||A,T),D=i;break}P.call(N,w,new Qn(N,{sourceEvent:A,subject:h,target:p,identifier:H,active:D,x:F[0]+B,y:F[1]+L,dx:F[0]-k[0],dy:F[1]-k[1],dispatch:P}),z)}}return p.filter=function(w){return arguments.length?(e=typeof w=="function"?w:rn(!!w),p):e},p.container=function(w){return arguments.length?(t=typeof w=="function"?w:rn(w),p):t},p.subject=function(w){return arguments.length?(n=typeof w=="function"?w:rn(w),p):n},p.touchable=function(w){return arguments.length?(r=typeof w=="function"?w:rn(!!w),p):r},p.on=function(){var w=s.on.apply(s,arguments);return w===s?p:w},p.clickDistance=function(w){return arguments.length?(d=(w=+w)*w,p):Math.sqrt(d)},p}function gr(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Xo(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Gt(){}var Ft=.7,yn=1/Ft,Nt="\\s*([+-]?\\d+)\\s*",Bt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Pe="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ll=/^#([0-9a-f]{3,8})$/,Ol=new RegExp(`^rgb\\(${Nt},${Nt},${Nt}\\)$`),Fl=new RegExp(`^rgb\\(${Pe},${Pe},${Pe}\\)$`),Bl=new RegExp(`^rgba\\(${Nt},${Nt},${Nt},${Bt}\\)$`),Vl=new RegExp(`^rgba\\(${Pe},${Pe},${Pe},${Bt}\\)$`),Xl=new RegExp(`^hsl\\(${Bt},${Pe},${Pe}\\)$`),Yl=new RegExp(`^hsla\\(${Bt},${Pe},${Pe},${Bt}\\)$`),Fr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};gr(Gt,Vt,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Br,formatHex:Br,formatHex8:Wl,formatHsl:Ul,formatRgb:Vr,toString:Vr});function Br(){return this.rgb().formatHex()}function Wl(){return this.rgb().formatHex8()}function Ul(){return Yo(this).formatHsl()}function Vr(){return this.rgb().formatRgb()}function Vt(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Ll.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?Xr(t):n===3?new ke(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?on(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?on(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Ol.exec(e))?new ke(t[1],t[2],t[3],1):(t=Fl.exec(e))?new ke(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Bl.exec(e))?on(t[1],t[2],t[3],t[4]):(t=Vl.exec(e))?on(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Xl.exec(e))?Ur(t[1],t[2]/100,t[3]/100,1):(t=Yl.exec(e))?Ur(t[1],t[2]/100,t[3]/100,t[4]):Fr.hasOwnProperty(e)?Xr(Fr[e]):e==="transparent"?new ke(NaN,NaN,NaN,0):null}function Xr(e){return new ke(e>>16&255,e>>8&255,e&255,1)}function on(e,t,n,r){return r<=0&&(e=t=n=NaN),new ke(e,t,n,r)}function Zl(e){return e instanceof Gt||(e=Vt(e)),e?(e=e.rgb(),new ke(e.r,e.g,e.b,e.opacity)):new ke}function Jn(e,t,n,r){return arguments.length===1?Zl(e):new ke(e,t,n,r??1)}function ke(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}gr(ke,Jn,Xo(Gt,{brighter(e){return e=e==null?yn:Math.pow(yn,e),new ke(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Ft:Math.pow(Ft,e),new ke(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new ke(dt(this.r),dt(this.g),dt(this.b),bn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Yr,formatHex:Yr,formatHex8:ql,formatRgb:Wr,toString:Wr}));function Yr(){return`#${ct(this.r)}${ct(this.g)}${ct(this.b)}`}function ql(){return`#${ct(this.r)}${ct(this.g)}${ct(this.b)}${ct((isNaN(this.opacity)?1:this.opacity)*255)}`}function Wr(){const e=bn(this.opacity);return`${e===1?"rgb(":"rgba("}${dt(this.r)}, ${dt(this.g)}, ${dt(this.b)}${e===1?")":`, ${e})`}`}function bn(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function dt(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function ct(e){return e=dt(e),(e<16?"0":"")+e.toString(16)}function Ur(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new De(e,t,n,r)}function Yo(e){if(e instanceof De)return new De(e.h,e.s,e.l,e.opacity);if(e instanceof Gt||(e=Vt(e)),!e)return new De;if(e instanceof De)return e;e=e.rgb();var t=e.r/255,n=e.g/255,r=e.b/255,o=Math.min(t,n,r),s=Math.max(t,n,r),i=NaN,a=s-o,c=(s+o)/2;return a?(t===s?i=(n-r)/a+(n<r)*6:n===s?i=(r-t)/a+2:i=(t-n)/a+4,a/=c<.5?s+o:2-s-o,i*=60):a=c>0&&c<1?0:i,new De(i,a,c,e.opacity)}function Kl(e,t,n,r){return arguments.length===1?Yo(e):new De(e,t,n,r??1)}function De(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}gr(De,Kl,Xo(Gt,{brighter(e){return e=e==null?yn:Math.pow(yn,e),new De(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Ft:Math.pow(Ft,e),new De(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,o=2*n-r;return new ke(Bn(e>=240?e-240:e+120,o,r),Bn(e,o,r),Bn(e<120?e+240:e-120,o,r),this.opacity)},clamp(){return new De(Zr(this.h),sn(this.s),sn(this.l),bn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=bn(this.opacity);return`${e===1?"hsl(":"hsla("}${Zr(this.h)}, ${sn(this.s)*100}%, ${sn(this.l)*100}%${e===1?")":`, ${e})`}`}}));function Zr(e){return e=(e||0)%360,e<0?e+360:e}function sn(e){return Math.max(0,Math.min(1,e||0))}function Bn(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const Wo=e=>()=>e;function Gl(e,t){return function(n){return e+n*t}}function Ql(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function Jl(e){return(e=+e)==1?Uo:function(t,n){return n-t?Ql(t,n,e):Wo(isNaN(t)?n:t)}}function Uo(e,t){var n=t-e;return n?Gl(e,n):Wo(isNaN(e)?t:e)}const qr=(function e(t){var n=Jl(t);function r(o,s){var i=n((o=Jn(o)).r,(s=Jn(s)).r),a=n(o.g,s.g),c=n(o.b,s.b),u=Uo(o.opacity,s.opacity);return function(l){return o.r=i(l),o.g=a(l),o.b=c(l),o.opacity=u(l),o+""}}return r.gamma=e,r})(1);function nt(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var er=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Vn=new RegExp(er.source,"g");function ec(e){return function(){return e}}function tc(e){return function(t){return e(t)+""}}function nc(e,t){var n=er.lastIndex=Vn.lastIndex=0,r,o,s,i=-1,a=[],c=[];for(e=e+"",t=t+"";(r=er.exec(e))&&(o=Vn.exec(t));)(s=o.index)>n&&(s=t.slice(n,s),a[i]?a[i]+=s:a[++i]=s),(r=r[0])===(o=o[0])?a[i]?a[i]+=o:a[++i]=o:(a[++i]=null,c.push({i,x:nt(r,o)})),n=Vn.lastIndex;return n<t.length&&(s=t.slice(n),a[i]?a[i]+=s:a[++i]=s),a.length<2?c[0]?tc(c[0].x):ec(t):(t=c.length,function(u){for(var l=0,d;l<t;++l)a[(d=c[l]).i]=d.x(u);return a.join("")})}var Kr=180/Math.PI,tr={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Zo(e,t,n,r,o,s){var i,a,c;return(i=Math.sqrt(e*e+t*t))&&(e/=i,t/=i),(c=e*n+t*r)&&(n-=e*c,r-=t*c),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,c/=a),e*r<t*n&&(e=-e,t=-t,c=-c,i=-i),{translateX:o,translateY:s,rotate:Math.atan2(t,e)*Kr,skewX:Math.atan(c)*Kr,scaleX:i,scaleY:a}}var an;function rc(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?tr:Zo(t.a,t.b,t.c,t.d,t.e,t.f)}function oc(e){return e==null||(an||(an=document.createElementNS("http://www.w3.org/2000/svg","g")),an.setAttribute("transform",e),!(e=an.transform.baseVal.consolidate()))?tr:(e=e.matrix,Zo(e.a,e.b,e.c,e.d,e.e,e.f))}function qo(e,t,n,r){function o(u){return u.length?u.pop()+" ":""}function s(u,l,d,p,f,b){if(u!==d||l!==p){var y=f.push("translate(",null,t,null,n);b.push({i:y-4,x:nt(u,d)},{i:y-2,x:nt(l,p)})}else(d||p)&&f.push("translate("+d+t+p+n)}function i(u,l,d,p){u!==l?(u-l>180?l+=360:l-u>180&&(u+=360),p.push({i:d.push(o(d)+"rotate(",null,r)-2,x:nt(u,l)})):l&&d.push(o(d)+"rotate("+l+r)}function a(u,l,d,p){u!==l?p.push({i:d.push(o(d)+"skewX(",null,r)-2,x:nt(u,l)}):l&&d.push(o(d)+"skewX("+l+r)}function c(u,l,d,p,f,b){if(u!==d||l!==p){var y=f.push(o(f)+"scale(",null,",",null,")");b.push({i:y-4,x:nt(u,d)},{i:y-2,x:nt(l,p)})}else(d!==1||p!==1)&&f.push(o(f)+"scale("+d+","+p+")")}return function(u,l){var d=[],p=[];return u=e(u),l=e(l),s(u.translateX,u.translateY,l.translateX,l.translateY,d,p),i(u.rotate,l.rotate,d,p),a(u.skewX,l.skewX,d,p),c(u.scaleX,u.scaleY,l.scaleX,l.scaleY,d,p),u=l=null,function(f){for(var b=-1,y=p.length,v;++b<y;)d[(v=p[b]).i]=v.x(f);return d.join("")}}}var sc=qo(rc,"px, ","px)","deg)"),ic=qo(oc,", ",")",")"),ac=1e-12;function Gr(e){return((e=Math.exp(e))+1/e)/2}function lc(e){return((e=Math.exp(e))-1/e)/2}function cc(e){return((e=Math.exp(2*e))-1)/(e+1)}const uc=(function e(t,n,r){function o(s,i){var a=s[0],c=s[1],u=s[2],l=i[0],d=i[1],p=i[2],f=l-a,b=d-c,y=f*f+b*b,v,m;if(y<ac)m=Math.log(p/u)/t,v=function(z){return[a+z*f,c+z*b,u*Math.exp(t*z*m)]};else{var S=Math.sqrt(y),M=(p*p-u*u+r*y)/(2*u*n*S),w=(p*p-u*u-r*y)/(2*p*n*S),T=Math.log(Math.sqrt(M*M+1)-M),$=Math.log(Math.sqrt(w*w+1)-w);m=($-T)/t,v=function(z){var H=z*m,I=Gr(T),P=u/(n*S)*(I*cc(t*H+T)-lc(T));return[a+P*f,c+P*b,u*I/Gr(t*H+T)]}}return v.duration=m*1e3*t/Math.SQRT2,v}return o.rho=function(s){var i=Math.max(.001,+s),a=i*i,c=a*a;return e(i,a,c)},o})(Math.SQRT2,2,4);var Et=0,Ht=0,It=0,Ko=1e3,wn,Pt,vn=0,ht=0,_n=0,Xt=typeof performance=="object"&&performance.now?performance:Date,Go=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function mr(){return ht||(Go(dc),ht=Xt.now()+_n)}function dc(){ht=0}function Nn(){this._call=this._time=this._next=null}Nn.prototype=Qo.prototype={constructor:Nn,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?mr():+n)+(t==null?0:+t),!this._next&&Pt!==this&&(Pt?Pt._next=this:wn=this,Pt=this),this._call=e,this._time=n,nr()},stop:function(){this._call&&(this._call=null,this._time=1/0,nr())}};function Qo(e,t,n){var r=new Nn;return r.restart(e,t,n),r}function fc(){mr(),++Et;for(var e=wn,t;e;)(t=ht-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Et}function Qr(){ht=(vn=Xt.now())+_n,Et=Ht=0;try{fc()}finally{Et=0,pc(),ht=0}}function hc(){var e=Xt.now(),t=e-vn;t>Ko&&(_n-=t,vn=e)}function pc(){for(var e,t=wn,n,r=1/0;t;)t._call?(r>t._time&&(r=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:wn=n);Pt=e,nr(r)}function nr(e){if(!Et){Ht&&(Ht=clearTimeout(Ht));var t=e-ht;t>24?(e<1/0&&(Ht=setTimeout(Qr,e-Xt.now()-_n)),It&&(It=clearInterval(It))):(It||(vn=Xt.now(),It=setInterval(hc,Ko)),Et=1,Go(Qr))}}function Jr(e,t,n){var r=new Nn;return t=t==null?0:+t,r.restart(o=>{r.stop(),e(o+t)},t,n),r}var gc=Sn("start","end","cancel","interrupt"),mc=[],Jo=0,eo=1,rr=2,pn=3,to=4,or=5,gn=6;function Cn(e,t,n,r,o,s){var i=e.__transition;if(!i)e.__transition={};else if(n in i)return;xc(e,n,{name:t,index:r,group:o,on:gc,tween:mc,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:Jo})}function xr(e,t){var n=ze(e,t);if(n.state>Jo)throw new Error("too late; already scheduled");return n}function Le(e,t){var n=ze(e,t);if(n.state>pn)throw new Error("too late; already running");return n}function ze(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function xc(e,t,n){var r=e.__transition,o;r[t]=n,n.timer=Qo(s,0,n.time);function s(u){n.state=eo,n.timer.restart(i,n.delay,n.time),n.delay<=u&&i(u-n.delay)}function i(u){var l,d,p,f;if(n.state!==eo)return c();for(l in r)if(f=r[l],f.name===n.name){if(f.state===pn)return Jr(i);f.state===to?(f.state=gn,f.timer.stop(),f.on.call("interrupt",e,e.__data__,f.index,f.group),delete r[l]):+l<t&&(f.state=gn,f.timer.stop(),f.on.call("cancel",e,e.__data__,f.index,f.group),delete r[l])}if(Jr(function(){n.state===pn&&(n.state=to,n.timer.restart(a,n.delay,n.time),a(u))}),n.state=rr,n.on.call("start",e,e.__data__,n.index,n.group),n.state===rr){for(n.state=pn,o=new Array(p=n.tween.length),l=0,d=-1;l<p;++l)(f=n.tween[l].value.call(e,e.__data__,n.index,n.group))&&(o[++d]=f);o.length=d+1}}function a(u){for(var l=u<n.duration?n.ease.call(null,u/n.duration):(n.timer.restart(c),n.state=or,1),d=-1,p=o.length;++d<p;)o[d].call(e,l);n.state===or&&(n.on.call("end",e,e.__data__,n.index,n.group),c())}function c(){n.state=gn,n.timer.stop(),delete r[t];for(var u in r)return;delete e.__transition}}function mn(e,t){var n=e.__transition,r,o,s=!0,i;if(n){t=t==null?null:t+"";for(i in n){if((r=n[i]).name!==t){s=!1;continue}o=r.state>rr&&r.state<or,r.state=gn,r.timer.stop(),r.on.call(o?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete n[i]}s&&delete e.__transition}}function yc(e){return this.each(function(){mn(this,e)})}function bc(e,t){var n,r;return function(){var o=Le(this,e),s=o.tween;if(s!==n){r=n=s;for(var i=0,a=r.length;i<a;++i)if(r[i].name===t){r=r.slice(),r.splice(i,1);break}}o.tween=r}}function wc(e,t,n){var r,o;if(typeof n!="function")throw new Error;return function(){var s=Le(this,e),i=s.tween;if(i!==r){o=(r=i).slice();for(var a={name:t,value:n},c=0,u=o.length;c<u;++c)if(o[c].name===t){o[c]=a;break}c===u&&o.push(a)}s.tween=o}}function vc(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r=ze(this.node(),n).tween,o=0,s=r.length,i;o<s;++o)if((i=r[o]).name===e)return i.value;return null}return this.each((t==null?bc:wc)(n,e,t))}function yr(e,t,n){var r=e._id;return e.each(function(){var o=Le(this,r);(o.value||(o.value={}))[t]=n.apply(this,arguments)}),function(o){return ze(o,r).value[t]}}function es(e,t){var n;return(typeof t=="number"?nt:t instanceof Vt?qr:(n=Vt(t))?(t=n,qr):nc)(e,t)}function Nc(e){return function(){this.removeAttribute(e)}}function kc(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Sc(e,t,n){var r,o=n+"",s;return function(){var i=this.getAttribute(e);return i===o?null:i===r?s:s=t(r=i,n)}}function Ec(e,t,n){var r,o=n+"",s;return function(){var i=this.getAttributeNS(e.space,e.local);return i===o?null:i===r?s:s=t(r=i,n)}}function _c(e,t,n){var r,o,s;return function(){var i,a=n(this),c;return a==null?void this.removeAttribute(e):(i=this.getAttribute(e),c=a+"",i===c?null:i===r&&c===o?s:(o=c,s=t(r=i,a)))}}function Cc(e,t,n){var r,o,s;return function(){var i,a=n(this),c;return a==null?void this.removeAttributeNS(e.space,e.local):(i=this.getAttributeNS(e.space,e.local),c=a+"",i===c?null:i===r&&c===o?s:(o=c,s=t(r=i,a)))}}function Mc(e,t){var n=En(e),r=n==="transform"?ic:es;return this.attrTween(e,typeof t=="function"?(n.local?Cc:_c)(n,r,yr(this,"attr."+e,t)):t==null?(n.local?kc:Nc)(n):(n.local?Ec:Sc)(n,r,t))}function $c(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function Tc(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function Ac(e,t){var n,r;function o(){var s=t.apply(this,arguments);return s!==r&&(n=(r=s)&&Tc(e,s)),n}return o._value=t,o}function Ic(e,t){var n,r;function o(){var s=t.apply(this,arguments);return s!==r&&(n=(r=s)&&$c(e,s)),n}return o._value=t,o}function Dc(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var r=En(e);return this.tween(n,(r.local?Ac:Ic)(r,t))}function jc(e,t){return function(){xr(this,e).delay=+t.apply(this,arguments)}}function zc(e,t){return t=+t,function(){xr(this,e).delay=t}}function Rc(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?jc:zc)(t,e)):ze(this.node(),t).delay}function Hc(e,t){return function(){Le(this,e).duration=+t.apply(this,arguments)}}function Pc(e,t){return t=+t,function(){Le(this,e).duration=t}}function Lc(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Hc:Pc)(t,e)):ze(this.node(),t).duration}function Oc(e,t){if(typeof t!="function")throw new Error;return function(){Le(this,e).ease=t}}function Fc(e){var t=this._id;return arguments.length?this.each(Oc(t,e)):ze(this.node(),t).ease}function Bc(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;Le(this,e).ease=n}}function Vc(e){if(typeof e!="function")throw new Error;return this.each(Bc(this._id,e))}function Xc(e){typeof e!="function"&&(e=Io(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var s=t[o],i=s.length,a=r[o]=[],c,u=0;u<i;++u)(c=s[u])&&e.call(c,c.__data__,u,s)&&a.push(c);return new We(r,this._parents,this._name,this._id)}function Yc(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,o=n.length,s=Math.min(r,o),i=new Array(r),a=0;a<s;++a)for(var c=t[a],u=n[a],l=c.length,d=i[a]=new Array(l),p,f=0;f<l;++f)(p=c[f]||u[f])&&(d[f]=p);for(;a<r;++a)i[a]=t[a];return new We(i,this._parents,this._name,this._id)}function Wc(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function Uc(e,t,n){var r,o,s=Wc(t)?xr:Le;return function(){var i=s(this,e),a=i.on;a!==r&&(o=(r=a).copy()).on(t,n),i.on=o}}function Zc(e,t){var n=this._id;return arguments.length<2?ze(this.node(),n).on.on(e):this.each(Uc(n,e,t))}function qc(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function Kc(){return this.on("end.remove",qc(this._id))}function Gc(e){var t=this._name,n=this._id;typeof e!="function"&&(e=hr(e));for(var r=this._groups,o=r.length,s=new Array(o),i=0;i<o;++i)for(var a=r[i],c=a.length,u=s[i]=new Array(c),l,d,p=0;p<c;++p)(l=a[p])&&(d=e.call(l,l.__data__,p,a))&&("__data__"in l&&(d.__data__=l.__data__),u[p]=d,Cn(u[p],t,n,p,u,ze(l,n)));return new We(s,this._parents,t,n)}function Qc(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Ao(e));for(var r=this._groups,o=r.length,s=[],i=[],a=0;a<o;++a)for(var c=r[a],u=c.length,l,d=0;d<u;++d)if(l=c[d]){for(var p=e.call(l,l.__data__,d,c),f,b=ze(l,n),y=0,v=p.length;y<v;++y)(f=p[y])&&Cn(f,t,n,y,p,b);s.push(p),i.push(l)}return new We(s,i,t,n)}var Jc=Kt.prototype.constructor;function eu(){return new Jc(this._groups,this._parents)}function tu(e,t){var n,r,o;return function(){var s=St(this,e),i=(this.style.removeProperty(e),St(this,e));return s===i?null:s===n&&i===r?o:o=t(n=s,r=i)}}function ts(e){return function(){this.style.removeProperty(e)}}function nu(e,t,n){var r,o=n+"",s;return function(){var i=St(this,e);return i===o?null:i===r?s:s=t(r=i,n)}}function ru(e,t,n){var r,o,s;return function(){var i=St(this,e),a=n(this),c=a+"";return a==null&&(c=a=(this.style.removeProperty(e),St(this,e))),i===c?null:i===r&&c===o?s:(o=c,s=t(r=i,a))}}function ou(e,t){var n,r,o,s="style."+t,i="end."+s,a;return function(){var c=Le(this,e),u=c.on,l=c.value[s]==null?a||(a=ts(t)):void 0;(u!==n||o!==l)&&(r=(n=u).copy()).on(i,o=l),c.on=r}}function su(e,t,n){var r=(e+="")=="transform"?sc:es;return t==null?this.styleTween(e,tu(e,r)).on("end.style."+e,ts(e)):typeof t=="function"?this.styleTween(e,ru(e,r,yr(this,"style."+e,t))).each(ou(this._id,e)):this.styleTween(e,nu(e,r,t),n).on("end.style."+e,null)}function iu(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}function au(e,t,n){var r,o;function s(){var i=t.apply(this,arguments);return i!==o&&(r=(o=i)&&iu(e,i,n)),r}return s._value=t,s}function lu(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,au(e,t,n??""))}function cu(e){return function(){this.textContent=e}}function uu(e){return function(){var t=e(this);this.textContent=t??""}}function du(e){return this.tween("text",typeof e=="function"?uu(yr(this,"text",e)):cu(e==null?"":e+""))}function fu(e){return function(t){this.textContent=e.call(this,t)}}function hu(e){var t,n;function r(){var o=e.apply(this,arguments);return o!==n&&(t=(n=o)&&fu(o)),t}return r._value=e,r}function pu(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,hu(e))}function gu(){for(var e=this._name,t=this._id,n=ns(),r=this._groups,o=r.length,s=0;s<o;++s)for(var i=r[s],a=i.length,c,u=0;u<a;++u)if(c=i[u]){var l=ze(c,t);Cn(c,e,n,u,i,{time:l.time+l.delay+l.duration,delay:0,duration:l.duration,ease:l.ease})}return new We(r,this._parents,e,n)}function mu(){var e,t,n=this,r=n._id,o=n.size();return new Promise(function(s,i){var a={value:i},c={value:function(){--o===0&&s()}};n.each(function(){var u=Le(this,r),l=u.on;l!==e&&(t=(e=l).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(c)),u.on=t}),o===0&&s()})}var xu=0;function We(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function ns(){return++xu}var Ve=Kt.prototype;We.prototype={constructor:We,select:Gc,selectAll:Qc,selectChild:Ve.selectChild,selectChildren:Ve.selectChildren,filter:Xc,merge:Yc,selection:eu,transition:gu,call:Ve.call,nodes:Ve.nodes,node:Ve.node,size:Ve.size,empty:Ve.empty,each:Ve.each,on:Zc,attr:Mc,attrTween:Dc,style:su,styleTween:lu,text:du,textTween:pu,remove:Kc,tween:vc,delay:Rc,duration:Lc,ease:Fc,easeVarying:Vc,end:mu,[Symbol.iterator]:Ve[Symbol.iterator]};function yu(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var bu={time:null,delay:0,duration:250,ease:yu};function wu(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function vu(e){var t,n;e instanceof We?(t=e._id,e=e._name):(t=ns(),(n=bu).time=mr(),e=e==null?null:e+"");for(var r=this._groups,o=r.length,s=0;s<o;++s)for(var i=r[s],a=i.length,c,u=0;u<a;++u)(c=i[u])&&Cn(c,e,t,u,i,n||wu(c,t));return new We(r,this._parents,e,t)}Kt.prototype.interrupt=yc;Kt.prototype.transition=vu;const ln=e=>()=>e;function Nu(e,{sourceEvent:t,target:n,transform:r,dispatch:o}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:o}})}function Xe(e,t,n){this.k=e,this.x=t,this.y=n}Xe.prototype={constructor:Xe,scale:function(e){return e===1?this:new Xe(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new Xe(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Ye=new Xe(1,0,0);Xe.prototype;function Xn(e){e.stopImmediatePropagation()}function Dt(e){e.preventDefault(),e.stopImmediatePropagation()}function ku(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function Su(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function no(){return this.__zoom||Ye}function Eu(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function _u(){return navigator.maxTouchPoints||"ontouchstart"in this}function Cu(e,t,n){var r=e.invertX(t[0][0])-n[0][0],o=e.invertX(t[1][0])-n[1][0],s=e.invertY(t[0][1])-n[0][1],i=e.invertY(t[1][1])-n[1][1];return e.translate(o>r?(r+o)/2:Math.min(0,r)||Math.max(0,o),i>s?(s+i)/2:Math.min(0,s)||Math.max(0,i))}function rs(){var e=ku,t=Su,n=Cu,r=Eu,o=_u,s=[0,1/0],i=[[-1/0,-1/0],[1/0,1/0]],a=250,c=uc,u=Sn("start","zoom","end"),l,d,p,f=500,b=150,y=0,v=10;function m(h){h.property("__zoom",no).on("wheel.zoom",H,{passive:!1}).on("mousedown.zoom",I).on("dblclick.zoom",P).filter(o).on("touchstart.zoom",F).on("touchmove.zoom",B).on("touchend.zoom touchcancel.zoom",L).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}m.transform=function(h,_,N,A){var R=h.selection?h.selection():h;R.property("__zoom",no),h!==R?T(h,_,N,A):R.interrupt().each(function(){$(this,arguments).event(A).start().zoom(null,typeof _=="function"?_.apply(this,arguments):_).end()})},m.scaleBy=function(h,_,N,A){m.scaleTo(h,function(){var R=this.__zoom.k,k=typeof _=="function"?_.apply(this,arguments):_;return R*k},N,A)},m.scaleTo=function(h,_,N,A){m.transform(h,function(){var R=t.apply(this,arguments),k=this.__zoom,D=N==null?w(R):typeof N=="function"?N.apply(this,arguments):N,j=k.invert(D),O=typeof _=="function"?_.apply(this,arguments):_;return n(M(S(k,O),D,j),R,i)},N,A)},m.translateBy=function(h,_,N,A){m.transform(h,function(){return n(this.__zoom.translate(typeof _=="function"?_.apply(this,arguments):_,typeof N=="function"?N.apply(this,arguments):N),t.apply(this,arguments),i)},null,A)},m.translateTo=function(h,_,N,A,R){m.transform(h,function(){var k=t.apply(this,arguments),D=this.__zoom,j=A==null?w(k):typeof A=="function"?A.apply(this,arguments):A;return n(Ye.translate(j[0],j[1]).scale(D.k).translate(typeof _=="function"?-_.apply(this,arguments):-_,typeof N=="function"?-N.apply(this,arguments):-N),k,i)},A,R)};function S(h,_){return _=Math.max(s[0],Math.min(s[1],_)),_===h.k?h:new Xe(_,h.x,h.y)}function M(h,_,N){var A=_[0]-N[0]*h.k,R=_[1]-N[1]*h.k;return A===h.x&&R===h.y?h:new Xe(h.k,A,R)}function w(h){return[(+h[0][0]+ +h[1][0])/2,(+h[0][1]+ +h[1][1])/2]}function T(h,_,N,A){h.on("start.zoom",function(){$(this,arguments).event(A).start()}).on("interrupt.zoom end.zoom",function(){$(this,arguments).event(A).end()}).tween("zoom",function(){var R=this,k=arguments,D=$(R,k).event(A),j=t.apply(R,k),O=N==null?w(j):typeof N=="function"?N.apply(R,k):N,X=Math.max(j[1][0]-j[0][0],j[1][1]-j[0][1]),Y=R.__zoom,G=typeof _=="function"?_.apply(R,k):_,re=c(Y.invert(O).concat(X/Y.k),G.invert(O).concat(X/G.k));return function(ee){if(ee===1)ee=G;else{var oe=re(ee),Q=X/oe[2];ee=new Xe(Q,O[0]-oe[0]*Q,O[1]-oe[1]*Q)}D.zoom(null,ee)}})}function $(h,_,N){return!N&&h.__zooming||new z(h,_)}function z(h,_){this.that=h,this.args=_,this.active=0,this.sourceEvent=null,this.extent=t.apply(h,_),this.taps=0}z.prototype={event:function(h){return h&&(this.sourceEvent=h),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(h,_){return this.mouse&&h!=="mouse"&&(this.mouse[1]=_.invert(this.mouse[0])),this.touch0&&h!=="touch"&&(this.touch0[1]=_.invert(this.touch0[0])),this.touch1&&h!=="touch"&&(this.touch1[1]=_.invert(this.touch1[0])),this.that.__zoom=_,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(h){var _=Te(this.that).datum();u.call(h,this.that,new Nu(h,{sourceEvent:this.sourceEvent,target:m,transform:this.that.__zoom,dispatch:u}),_)}};function H(h,..._){if(!e.apply(this,arguments))return;var N=$(this,_).event(h),A=this.__zoom,R=Math.max(s[0],Math.min(s[1],A.k*Math.pow(2,r.apply(this,arguments)))),k=Ie(h);if(N.wheel)(N.mouse[0][0]!==k[0]||N.mouse[0][1]!==k[1])&&(N.mouse[1]=A.invert(N.mouse[0]=k)),clearTimeout(N.wheel);else{if(A.k===R)return;N.mouse=[k,A.invert(k)],mn(this),N.start()}Dt(h),N.wheel=setTimeout(D,b),N.zoom("mouse",n(M(S(A,R),N.mouse[0],N.mouse[1]),N.extent,i));function D(){N.wheel=null,N.end()}}function I(h,..._){if(p||!e.apply(this,arguments))return;var N=h.currentTarget,A=$(this,_,!0).event(h),R=Te(h.view).on("mousemove.zoom",O,!0).on("mouseup.zoom",X,!0),k=Ie(h,N),D=h.clientX,j=h.clientY;Bo(h.view),Xn(h),A.mouse=[k,this.__zoom.invert(k)],mn(this),A.start();function O(Y){if(Dt(Y),!A.moved){var G=Y.clientX-D,re=Y.clientY-j;A.moved=G*G+re*re>y}A.event(Y).zoom("mouse",n(M(A.that.__zoom,A.mouse[0]=Ie(Y,N),A.mouse[1]),A.extent,i))}function X(Y){R.on("mousemove.zoom mouseup.zoom",null),Vo(Y.view,A.moved),Dt(Y),A.event(Y).end()}}function P(h,..._){if(e.apply(this,arguments)){var N=this.__zoom,A=Ie(h.changedTouches?h.changedTouches[0]:h,this),R=N.invert(A),k=N.k*(h.shiftKey?.5:2),D=n(M(S(N,k),A,R),t.apply(this,_),i);Dt(h),a>0?Te(this).transition().duration(a).call(T,D,A,h):Te(this).call(m.transform,D,A,h)}}function F(h,..._){if(e.apply(this,arguments)){var N=h.touches,A=N.length,R=$(this,_,h.changedTouches.length===A).event(h),k,D,j,O;for(Xn(h),D=0;D<A;++D)j=N[D],O=Ie(j,this),O=[O,this.__zoom.invert(O),j.identifier],R.touch0?!R.touch1&&R.touch0[2]!==O[2]&&(R.touch1=O,R.taps=0):(R.touch0=O,k=!0,R.taps=1+!!l);l&&(l=clearTimeout(l)),k&&(R.taps<2&&(d=O[0],l=setTimeout(function(){l=null},f)),mn(this),R.start())}}function B(h,..._){if(this.__zooming){var N=$(this,_).event(h),A=h.changedTouches,R=A.length,k,D,j,O;for(Dt(h),k=0;k<R;++k)D=A[k],j=Ie(D,this),N.touch0&&N.touch0[2]===D.identifier?N.touch0[0]=j:N.touch1&&N.touch1[2]===D.identifier&&(N.touch1[0]=j);if(D=N.that.__zoom,N.touch1){var X=N.touch0[0],Y=N.touch0[1],G=N.touch1[0],re=N.touch1[1],ee=(ee=G[0]-X[0])*ee+(ee=G[1]-X[1])*ee,oe=(oe=re[0]-Y[0])*oe+(oe=re[1]-Y[1])*oe;D=S(D,Math.sqrt(ee/oe)),j=[(X[0]+G[0])/2,(X[1]+G[1])/2],O=[(Y[0]+re[0])/2,(Y[1]+re[1])/2]}else if(N.touch0)j=N.touch0[0],O=N.touch0[1];else return;N.zoom("touch",n(M(D,j,O),N.extent,i))}}function L(h,..._){if(this.__zooming){var N=$(this,_).event(h),A=h.changedTouches,R=A.length,k,D;for(Xn(h),p&&clearTimeout(p),p=setTimeout(function(){p=null},f),k=0;k<R;++k)D=A[k],N.touch0&&N.touch0[2]===D.identifier?delete N.touch0:N.touch1&&N.touch1[2]===D.identifier&&delete N.touch1;if(N.touch1&&!N.touch0&&(N.touch0=N.touch1,delete N.touch1),N.touch0)N.touch0[1]=this.__zoom.invert(N.touch0[0]);else if(N.end(),N.taps===2&&(D=Ie(D,this),Math.hypot(d[0]-D[0],d[1]-D[1])<v)){var j=Te(this).on("dblclick.zoom");j&&j.apply(this,arguments)}}}return m.wheelDelta=function(h){return arguments.length?(r=typeof h=="function"?h:ln(+h),m):r},m.filter=function(h){return arguments.length?(e=typeof h=="function"?h:ln(!!h),m):e},m.touchable=function(h){return arguments.length?(o=typeof h=="function"?h:ln(!!h),m):o},m.extent=function(h){return arguments.length?(t=typeof h=="function"?h:ln([[+h[0][0],+h[0][1]],[+h[1][0],+h[1][1]]]),m):t},m.scaleExtent=function(h){return arguments.length?(s[0]=+h[0],s[1]=+h[1],m):[s[0],s[1]]},m.translateExtent=function(h){return arguments.length?(i[0][0]=+h[0][0],i[1][0]=+h[1][0],i[0][1]=+h[0][1],i[1][1]=+h[1][1],m):[[i[0][0],i[0][1]],[i[1][0],i[1][1]]]},m.constrain=function(h){return arguments.length?(n=h,m):n},m.duration=function(h){return arguments.length?(a=+h,m):a},m.interpolate=function(h){return arguments.length?(c=h,m):c},m.on=function(){var h=u.on.apply(u,arguments);return h===u?m:h},m.clickDistance=function(h){return arguments.length?(y=(h=+h)*h,m):Math.sqrt(y)},m.tapDistance=function(h){return arguments.length?(v=+h,m):v},m}const Mn=x.createContext(null),Mu=Mn.Provider,Ue={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,t)=>`Couldn't create edge for ${e?"target":"source"} handle id: "${e?t.targetHandle:t.sourceHandle}", edge id: ${t.id}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`},os=Ue.error001();function ce(e,t){const n=x.useContext(Mn);if(n===null)throw new Error(os);return $o(n,e,t)}const ge=()=>{const e=x.useContext(Mn);if(e===null)throw new Error(os);return x.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe,destroy:e.destroy}),[e])},$u=e=>e.userSelectionActive?"none":"all";function Yt({position:e,children:t,className:n,style:r,...o}){const s=ce($u),i=`${e}`.split("-");return C.createElement("div",{className:ve(["react-flow__panel",n,...i]),style:{...r,pointerEvents:s},...o},t)}function Tu({proOptions:e,position:t="bottom-right"}){return e?.hideAttribution?null:C.createElement(Yt,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://reactflow.dev/pro"},C.createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution"},"React Flow"))}const Au=({x:e,y:t,label:n,labelStyle:r={},labelShowBg:o=!0,labelBgStyle:s={},labelBgPadding:i=[2,4],labelBgBorderRadius:a=2,children:c,className:u,...l})=>{const d=x.useRef(null),[p,f]=x.useState({x:0,y:0,width:0,height:0}),b=ve(["react-flow__edge-textwrapper",u]);return x.useEffect(()=>{if(d.current){const y=d.current.getBBox();f({x:y.x,y:y.y,width:y.width,height:y.height})}},[n]),typeof n>"u"||!n?null:C.createElement("g",{transform:`translate(${e-p.width/2} ${t-p.height/2})`,className:b,visibility:p.width?"visible":"hidden",...l},o&&C.createElement("rect",{width:p.width+2*i[0],x:-i[0],y:-i[1],height:p.height+2*i[1],className:"react-flow__edge-textbg",style:s,rx:a,ry:a}),C.createElement("text",{className:"react-flow__edge-text",y:p.height/2,dy:"0.3em",ref:d,style:r},n),c)};var Iu=x.memo(Au);const br=e=>({width:e.offsetWidth,height:e.offsetHeight}),_t=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),wr=(e={x:0,y:0},t)=>({x:_t(e.x,t[0][0],t[1][0]),y:_t(e.y,t[0][1],t[1][1])}),ro=(e,t,n)=>e<t?_t(Math.abs(e-t),1,50)/50:e>n?-_t(Math.abs(e-n),1,50)/50:0,ss=(e,t)=>{const n=ro(e.x,35,t.width-35)*20,r=ro(e.y,35,t.height-35)*20;return[n,r]},is=e=>e.getRootNode?.()||window?.document,as=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),Wt=({x:e,y:t,width:n,height:r})=>({x:e,y:t,x2:e+n,y2:t+r}),ls=({x:e,y:t,x2:n,y2:r})=>({x:e,y:t,width:n-e,height:r-t}),oo=e=>({...e.positionAbsolute||{x:0,y:0},width:e.width||0,height:e.height||0}),Du=(e,t)=>ls(as(Wt(e),Wt(t))),sr=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),r=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*r)},ju=e=>Ae(e.width)&&Ae(e.height)&&Ae(e.x)&&Ae(e.y),Ae=e=>!isNaN(e)&&isFinite(e),de=Symbol.for("internals"),cs=["Enter"," ","Escape"],zu=(e,t)=>{},Ru=e=>"nativeEvent"in e;function ir(e){const n=(Ru(e)?e.nativeEvent:e).composedPath?.()?.[0]||e.target;return["INPUT","SELECT","TEXTAREA"].includes(n?.nodeName)||n?.hasAttribute("contenteditable")||!!n?.closest(".nokey")}const us=e=>"clientX"in e,st=(e,t)=>{const n=us(e),r=n?e.clientX:e.touches?.[0].clientX,o=n?e.clientY:e.touches?.[0].clientY;return{x:r-(t?.left??0),y:o-(t?.top??0)}},kn=()=>typeof navigator<"u"&&navigator?.userAgent?.indexOf("Mac")>=0,Qt=({id:e,path:t,labelX:n,labelY:r,label:o,labelStyle:s,labelShowBg:i,labelBgStyle:a,labelBgPadding:c,labelBgBorderRadius:u,style:l,markerEnd:d,markerStart:p,interactionWidth:f=20})=>C.createElement(C.Fragment,null,C.createElement("path",{id:e,style:l,d:t,fill:"none",className:"react-flow__edge-path",markerEnd:d,markerStart:p}),f&&C.createElement("path",{d:t,fill:"none",strokeOpacity:0,strokeWidth:f,className:"react-flow__edge-interaction"}),o&&Ae(n)&&Ae(r)?C.createElement(Iu,{x:n,y:r,label:o,labelStyle:s,labelShowBg:i,labelBgStyle:a,labelBgPadding:c,labelBgBorderRadius:u}):null);Qt.displayName="BaseEdge";function jt(e,t,n){return n===void 0?n:r=>{const o=t().edges.find(s=>s.id===e);o&&n(r,{...o})}}function ds({sourceX:e,sourceY:t,targetX:n,targetY:r}){const o=Math.abs(n-e)/2,s=n<e?n+o:n-o,i=Math.abs(r-t)/2,a=r<t?r+i:r-i;return[s,a,o,i]}function fs({sourceX:e,sourceY:t,targetX:n,targetY:r,sourceControlX:o,sourceControlY:s,targetControlX:i,targetControlY:a}){const c=e*.125+o*.375+i*.375+n*.125,u=t*.125+s*.375+a*.375+r*.125,l=Math.abs(c-e),d=Math.abs(u-t);return[c,u,l,d]}var pt;(function(e){e.Strict="strict",e.Loose="loose"})(pt||(pt={}));var ut;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(ut||(ut={}));var Ut;(function(e){e.Partial="partial",e.Full="full"})(Ut||(Ut={}));var ot;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(ot||(ot={}));var Ct;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(Ct||(Ct={}));var K;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(K||(K={}));function so({pos:e,x1:t,y1:n,x2:r,y2:o}){return e===K.Left||e===K.Right?[.5*(t+r),n]:[t,.5*(n+o)]}function hs({sourceX:e,sourceY:t,sourcePosition:n=K.Bottom,targetX:r,targetY:o,targetPosition:s=K.Top}){const[i,a]=so({pos:n,x1:e,y1:t,x2:r,y2:o}),[c,u]=so({pos:s,x1:r,y1:o,x2:e,y2:t}),[l,d,p,f]=fs({sourceX:e,sourceY:t,targetX:r,targetY:o,sourceControlX:i,sourceControlY:a,targetControlX:c,targetControlY:u});return[`M${e},${t} C${i},${a} ${c},${u} ${r},${o}`,l,d,p,f]}const vr=x.memo(({sourceX:e,sourceY:t,targetX:n,targetY:r,sourcePosition:o=K.Bottom,targetPosition:s=K.Top,label:i,labelStyle:a,labelShowBg:c,labelBgStyle:u,labelBgPadding:l,labelBgBorderRadius:d,style:p,markerEnd:f,markerStart:b,interactionWidth:y})=>{const[v,m,S]=hs({sourceX:e,sourceY:t,sourcePosition:o,targetX:n,targetY:r,targetPosition:s});return C.createElement(Qt,{path:v,labelX:m,labelY:S,label:i,labelStyle:a,labelShowBg:c,labelBgStyle:u,labelBgPadding:l,labelBgBorderRadius:d,style:p,markerEnd:f,markerStart:b,interactionWidth:y})});vr.displayName="SimpleBezierEdge";const io={[K.Left]:{x:-1,y:0},[K.Right]:{x:1,y:0},[K.Top]:{x:0,y:-1},[K.Bottom]:{x:0,y:1}},Hu=({source:e,sourcePosition:t=K.Bottom,target:n})=>t===K.Left||t===K.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1},ao=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function Pu({source:e,sourcePosition:t=K.Bottom,target:n,targetPosition:r=K.Top,center:o,offset:s}){const i=io[t],a=io[r],c={x:e.x+i.x*s,y:e.y+i.y*s},u={x:n.x+a.x*s,y:n.y+a.y*s},l=Hu({source:c,sourcePosition:t,target:u}),d=l.x!==0?"x":"y",p=l[d];let f=[],b,y;const v={x:0,y:0},m={x:0,y:0},[S,M,w,T]=ds({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(i[d]*a[d]===-1){b=o.x??S,y=o.y??M;const z=[{x:b,y:c.y},{x:b,y:u.y}],H=[{x:c.x,y},{x:u.x,y}];i[d]===p?f=d==="x"?z:H:f=d==="x"?H:z}else{const z=[{x:c.x,y:u.y}],H=[{x:u.x,y:c.y}];if(d==="x"?f=i.x===p?H:z:f=i.y===p?z:H,t===r){const L=Math.abs(e[d]-n[d]);if(L<=s){const h=Math.min(s-1,s-L);i[d]===p?v[d]=(c[d]>e[d]?-1:1)*h:m[d]=(u[d]>n[d]?-1:1)*h}}if(t!==r){const L=d==="x"?"y":"x",h=i[d]===a[L],_=c[L]>u[L],N=c[L]<u[L];(i[d]===1&&(!h&&_||h&&N)||i[d]!==1&&(!h&&N||h&&_))&&(f=d==="x"?z:H)}const I={x:c.x+v.x,y:c.y+v.y},P={x:u.x+m.x,y:u.y+m.y},F=Math.max(Math.abs(I.x-f[0].x),Math.abs(P.x-f[0].x)),B=Math.max(Math.abs(I.y-f[0].y),Math.abs(P.y-f[0].y));F>=B?(b=(I.x+P.x)/2,y=f[0].y):(b=f[0].x,y=(I.y+P.y)/2)}return[[e,{x:c.x+v.x,y:c.y+v.y},...f,{x:u.x+m.x,y:u.y+m.y},n],b,y,w,T]}function Lu(e,t,n,r){const o=Math.min(ao(e,t)/2,ao(t,n)/2,r),{x:s,y:i}=t;if(e.x===s&&s===n.x||e.y===i&&i===n.y)return`L${s} ${i}`;if(e.y===i){const u=e.x<n.x?-1:1,l=e.y<n.y?1:-1;return`L ${s+o*u},${i}Q ${s},${i} ${s},${i+o*l}`}const a=e.x<n.x?1:-1,c=e.y<n.y?-1:1;return`L ${s},${i+o*c}Q ${s},${i} ${s+o*a},${i}`}function ar({sourceX:e,sourceY:t,sourcePosition:n=K.Bottom,targetX:r,targetY:o,targetPosition:s=K.Top,borderRadius:i=5,centerX:a,centerY:c,offset:u=20}){const[l,d,p,f,b]=Pu({source:{x:e,y:t},sourcePosition:n,target:{x:r,y:o},targetPosition:s,center:{x:a,y:c},offset:u});return[l.reduce((v,m,S)=>{let M="";return S>0&&S<l.length-1?M=Lu(l[S-1],m,l[S+1],i):M=`${S===0?"M":"L"}${m.x} ${m.y}`,v+=M,v},""),d,p,f,b]}const $n=x.memo(({sourceX:e,sourceY:t,targetX:n,targetY:r,label:o,labelStyle:s,labelShowBg:i,labelBgStyle:a,labelBgPadding:c,labelBgBorderRadius:u,style:l,sourcePosition:d=K.Bottom,targetPosition:p=K.Top,markerEnd:f,markerStart:b,pathOptions:y,interactionWidth:v})=>{const[m,S,M]=ar({sourceX:e,sourceY:t,sourcePosition:d,targetX:n,targetY:r,targetPosition:p,borderRadius:y?.borderRadius,offset:y?.offset});return C.createElement(Qt,{path:m,labelX:S,labelY:M,label:o,labelStyle:s,labelShowBg:i,labelBgStyle:a,labelBgPadding:c,labelBgBorderRadius:u,style:l,markerEnd:f,markerStart:b,interactionWidth:v})});$n.displayName="SmoothStepEdge";const Tn=x.memo(e=>C.createElement($n,{...e,pathOptions:x.useMemo(()=>({borderRadius:0,offset:e.pathOptions?.offset}),[e.pathOptions?.offset])}));Tn.displayName="StepEdge";function Ou({sourceX:e,sourceY:t,targetX:n,targetY:r}){const[o,s,i,a]=ds({sourceX:e,sourceY:t,targetX:n,targetY:r});return[`M ${e},${t}L ${n},${r}`,o,s,i,a]}const An=x.memo(({sourceX:e,sourceY:t,targetX:n,targetY:r,label:o,labelStyle:s,labelShowBg:i,labelBgStyle:a,labelBgPadding:c,labelBgBorderRadius:u,style:l,markerEnd:d,markerStart:p,interactionWidth:f})=>{const[b,y,v]=Ou({sourceX:e,sourceY:t,targetX:n,targetY:r});return C.createElement(Qt,{path:b,labelX:y,labelY:v,label:o,labelStyle:s,labelShowBg:i,labelBgStyle:a,labelBgPadding:c,labelBgBorderRadius:u,style:l,markerEnd:d,markerStart:p,interactionWidth:f})});An.displayName="StraightEdge";function cn(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function lo({pos:e,x1:t,y1:n,x2:r,y2:o,c:s}){switch(e){case K.Left:return[t-cn(t-r,s),n];case K.Right:return[t+cn(r-t,s),n];case K.Top:return[t,n-cn(n-o,s)];case K.Bottom:return[t,n+cn(o-n,s)]}}function ps({sourceX:e,sourceY:t,sourcePosition:n=K.Bottom,targetX:r,targetY:o,targetPosition:s=K.Top,curvature:i=.25}){const[a,c]=lo({pos:n,x1:e,y1:t,x2:r,y2:o,c:i}),[u,l]=lo({pos:s,x1:r,y1:o,x2:e,y2:t,c:i}),[d,p,f,b]=fs({sourceX:e,sourceY:t,targetX:r,targetY:o,sourceControlX:a,sourceControlY:c,targetControlX:u,targetControlY:l});return[`M${e},${t} C${a},${c} ${u},${l} ${r},${o}`,d,p,f,b]}const Zt=x.memo(({sourceX:e,sourceY:t,targetX:n,targetY:r,sourcePosition:o=K.Bottom,targetPosition:s=K.Top,label:i,labelStyle:a,labelShowBg:c,labelBgStyle:u,labelBgPadding:l,labelBgBorderRadius:d,style:p,markerEnd:f,markerStart:b,pathOptions:y,interactionWidth:v})=>{const[m,S,M]=ps({sourceX:e,sourceY:t,sourcePosition:o,targetX:n,targetY:r,targetPosition:s,curvature:y?.curvature});return C.createElement(Qt,{path:m,labelX:S,labelY:M,label:i,labelStyle:a,labelShowBg:c,labelBgStyle:u,labelBgPadding:l,labelBgBorderRadius:d,style:p,markerEnd:f,markerStart:b,interactionWidth:v})});Zt.displayName="BezierEdge";const Nr=x.createContext(null),Fu=Nr.Provider;Nr.Consumer;const Bu=()=>x.useContext(Nr),Vu=e=>"id"in e&&"source"in e&&"target"in e,Xu=({source:e,sourceHandle:t,target:n,targetHandle:r})=>`reactflow__edge-${e}${t||""}-${n}${r||""}`,lr=(e,t)=>typeof e>"u"?"":typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(r=>`${r}=${e[r]}`).join("&")}`,Yu=(e,t)=>t.some(n=>n.source===e.source&&n.target===e.target&&(n.sourceHandle===e.sourceHandle||!n.sourceHandle&&!e.sourceHandle)&&(n.targetHandle===e.targetHandle||!n.targetHandle&&!e.targetHandle)),Wu=(e,t)=>{if(!e.source||!e.target)return t;let n;return Vu(e)?n={...e}:n={...e,id:Xu(e)},Yu(n,t)?t:t.concat(n)},cr=({x:e,y:t},[n,r,o],s,[i,a])=>{const c={x:(e-n)/o,y:(t-r)/o};return s?{x:i*Math.round(c.x/i),y:a*Math.round(c.y/a)}:c},gs=({x:e,y:t},[n,r,o])=>({x:e*o+n,y:t*o+r}),ft=(e,t=[0,0])=>{if(!e)return{x:0,y:0,positionAbsolute:{x:0,y:0}};const n=(e.width??0)*t[0],r=(e.height??0)*t[1],o={x:e.position.x-n,y:e.position.y-r};return{...o,positionAbsolute:e.positionAbsolute?{x:e.positionAbsolute.x-n,y:e.positionAbsolute.y-r}:o}},In=(e,t=[0,0])=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const n=e.reduce((r,o)=>{const{x:s,y:i}=ft(o,t).positionAbsolute;return as(r,Wt({x:s,y:i,width:o.width||0,height:o.height||0}))},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return ls(n)},ms=(e,t,[n,r,o]=[0,0,1],s=!1,i=!1,a=[0,0])=>{const c={x:(t.x-n)/o,y:(t.y-r)/o,width:t.width/o,height:t.height/o},u=[];return e.forEach(l=>{const{width:d,height:p,selectable:f=!0,hidden:b=!1}=l;if(i&&!f||b)return!1;const{positionAbsolute:y}=ft(l,a),v={x:y.x,y:y.y,width:d||0,height:p||0},m=sr(c,v),S=typeof d>"u"||typeof p>"u"||d===null||p===null,M=s&&m>0,w=(d||0)*(p||0);(S||M||m>=w||l.dragging)&&u.push(l)}),u},xs=(e,t)=>{const n=e.map(r=>r.id);return t.filter(r=>n.includes(r.source)||n.includes(r.target))},ys=(e,t,n,r,o,s=.1)=>{const i=t/(e.width*(1+s)),a=n/(e.height*(1+s)),c=Math.min(i,a),u=_t(c,r,o),l=e.x+e.width/2,d=e.y+e.height/2,p=t/2-l*u,f=n/2-d*u;return{x:p,y:f,zoom:u}},lt=(e,t=0)=>e.transition().duration(t);function co(e,t,n,r){return(t[n]||[]).reduce((o,s)=>(`${e.id}-${s.id}-${n}`!==r&&o.push({id:s.id||null,type:n,nodeId:e.id,x:(e.positionAbsolute?.x??0)+s.x+s.width/2,y:(e.positionAbsolute?.y??0)+s.y+s.height/2}),o),[])}function Uu(e,t,n,r,o,s){const{x:i,y:a}=st(e),u=t.elementsFromPoint(i,a).find(b=>b.classList.contains("react-flow__handle"));if(u){const b=u.getAttribute("data-nodeid");if(b){const y=kr(void 0,u),v=u.getAttribute("data-handleid"),m=s({nodeId:b,id:v,type:y});if(m){const S=o.find(M=>M.nodeId===b&&M.type===y&&M.id===v);return{handle:{id:v,type:y,nodeId:b,x:S?.x||n.x,y:S?.y||n.y},validHandleResult:m}}}}let l=[],d=1/0;if(o.forEach(b=>{const y=Math.sqrt((b.x-n.x)**2+(b.y-n.y)**2);if(y<=r){const v=s(b);y<=d&&(y<d?l=[{handle:b,validHandleResult:v}]:y===d&&l.push({handle:b,validHandleResult:v}),d=y)}}),!l.length)return{handle:null,validHandleResult:bs()};if(l.length===1)return l[0];const p=l.some(({validHandleResult:b})=>b.isValid),f=l.some(({handle:b})=>b.type==="target");return l.find(({handle:b,validHandleResult:y})=>f?b.type==="target":p?y.isValid:!0)||l[0]}const Zu={source:null,target:null,sourceHandle:null,targetHandle:null},bs=()=>({handleDomNode:null,isValid:!1,connection:Zu,endHandle:null});function ws(e,t,n,r,o,s,i){const a=o==="target",c=i.querySelector(`.react-flow__handle[data-id="${e?.nodeId}-${e?.id}-${e?.type}"]`),u={...bs(),handleDomNode:c};if(c){const l=kr(void 0,c),d=c.getAttribute("data-nodeid"),p=c.getAttribute("data-handleid"),f=c.classList.contains("connectable"),b=c.classList.contains("connectableend"),y={source:a?d:n,sourceHandle:a?p:r,target:a?n:d,targetHandle:a?r:p};u.connection=y,f&&b&&(t===pt.Strict?a&&l==="source"||!a&&l==="target":d!==n||p!==r)&&(u.endHandle={nodeId:d,handleId:p,type:l},u.isValid=s(y))}return u}function qu({nodes:e,nodeId:t,handleId:n,handleType:r}){return e.reduce((o,s)=>{if(s[de]){const{handleBounds:i}=s[de];let a=[],c=[];i&&(a=co(s,i,"source",`${t}-${n}-${r}`),c=co(s,i,"target",`${t}-${n}-${r}`)),o.push(...a,...c)}return o},[])}function kr(e,t){return e||(t?.classList.contains("target")?"target":t?.classList.contains("source")?"source":null)}function Yn(e){e?.classList.remove("valid","connecting","react-flow__handle-valid","react-flow__handle-connecting")}function Ku(e,t){let n=null;return t?n="valid":e&&!t&&(n="invalid"),n}function vs({event:e,handleId:t,nodeId:n,onConnect:r,isTarget:o,getState:s,setState:i,isValidConnection:a,edgeUpdaterType:c,onReconnectEnd:u}){const l=is(e.target),{connectionMode:d,domNode:p,autoPanOnConnect:f,connectionRadius:b,onConnectStart:y,panBy:v,getNodes:m,cancelConnection:S}=s();let M=0,w;const{x:T,y:$}=st(e),z=l?.elementFromPoint(T,$),H=kr(c,z),I=p?.getBoundingClientRect();if(!I||!H)return;let P,F=st(e,I),B=!1,L=null,h=!1,_=null;const N=qu({nodes:m(),nodeId:n,handleId:t,handleType:H}),A=()=>{if(!f)return;const[D,j]=ss(F,I);v({x:D,y:j}),M=requestAnimationFrame(A)};i({connectionPosition:F,connectionStatus:null,connectionNodeId:n,connectionHandleId:t,connectionHandleType:H,connectionStartHandle:{nodeId:n,handleId:t,type:H},connectionEndHandle:null}),y?.(e,{nodeId:n,handleId:t,handleType:H});function R(D){const{transform:j}=s();F=st(D,I);const{handle:O,validHandleResult:X}=Uu(D,l,cr(F,j,!1,[1,1]),b,N,Y=>ws(Y,d,n,t,o?"target":"source",a,l));if(w=O,B||(A(),B=!0),_=X.handleDomNode,L=X.connection,h=X.isValid,i({connectionPosition:w&&h?gs({x:w.x,y:w.y},j):F,connectionStatus:Ku(!!w,h),connectionEndHandle:X.endHandle}),!w&&!h&&!_)return Yn(P);L.source!==L.target&&_&&(Yn(P),P=_,_.classList.add("connecting","react-flow__handle-connecting"),_.classList.toggle("valid",h),_.classList.toggle("react-flow__handle-valid",h))}function k(D){(w||_)&&L&&h&&r?.(L),s().onConnectEnd?.(D),c&&u?.(D),Yn(P),S(),cancelAnimationFrame(M),B=!1,h=!1,L=null,_=null,l.removeEventListener("mousemove",R),l.removeEventListener("mouseup",k),l.removeEventListener("touchmove",R),l.removeEventListener("touchend",k)}l.addEventListener("mousemove",R),l.addEventListener("mouseup",k),l.addEventListener("touchmove",R),l.addEventListener("touchend",k)}const uo=()=>!0,Gu=e=>({connectionStartHandle:e.connectionStartHandle,connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName}),Qu=(e,t,n)=>r=>{const{connectionStartHandle:o,connectionEndHandle:s,connectionClickStartHandle:i}=r;return{connecting:o?.nodeId===e&&o?.handleId===t&&o?.type===n||s?.nodeId===e&&s?.handleId===t&&s?.type===n,clickConnecting:i?.nodeId===e&&i?.handleId===t&&i?.type===n}},Ns=x.forwardRef(({type:e="source",position:t=K.Top,isValidConnection:n,isConnectable:r=!0,isConnectableStart:o=!0,isConnectableEnd:s=!0,id:i,onConnect:a,children:c,className:u,onMouseDown:l,onTouchStart:d,...p},f)=>{const b=i||null,y=e==="target",v=ge(),m=Bu(),{connectOnClick:S,noPanClassName:M}=ce(Gu,be),{connecting:w,clickConnecting:T}=ce(Qu(m,b,e),be);m||v.getState().onError?.("010",Ue.error010());const $=I=>{const{defaultEdgeOptions:P,onConnect:F,hasDefaultEdges:B}=v.getState(),L={...P,...I};if(B){const{edges:h,setEdges:_}=v.getState();_(Wu(L,h))}F?.(L),a?.(L)},z=I=>{if(!m)return;const P=us(I);o&&(P&&I.button===0||!P)&&vs({event:I,handleId:b,nodeId:m,onConnect:$,isTarget:y,getState:v.getState,setState:v.setState,isValidConnection:n||v.getState().isValidConnection||uo}),P?l?.(I):d?.(I)},H=I=>{const{onClickConnectStart:P,onClickConnectEnd:F,connectionClickStartHandle:B,connectionMode:L,isValidConnection:h}=v.getState();if(!m||!B&&!o)return;if(!B){P?.(I,{nodeId:m,handleId:b,handleType:e}),v.setState({connectionClickStartHandle:{nodeId:m,type:e,handleId:b}});return}const _=is(I.target),N=n||h||uo,{connection:A,isValid:R}=ws({nodeId:m,id:b,type:e},L,B.nodeId,B.handleId||null,B.type,N,_);R&&$(A),F?.(I),v.setState({connectionClickStartHandle:null})};return C.createElement("div",{"data-handleid":b,"data-nodeid":m,"data-handlepos":t,"data-id":`${m}-${b}-${e}`,className:ve(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",M,u,{source:!y,target:y,connectable:r,connectablestart:o,connectableend:s,connecting:T,connectionindicator:r&&(o&&!w||s&&w)}]),onMouseDown:z,onTouchStart:z,onClick:S?H:void 0,ref:f,...p},c)});Ns.displayName="Handle";var Mt=x.memo(Ns);const ks=({data:e,isConnectable:t,targetPosition:n=K.Top,sourcePosition:r=K.Bottom})=>C.createElement(C.Fragment,null,C.createElement(Mt,{type:"target",position:n,isConnectable:t}),e?.label,C.createElement(Mt,{type:"source",position:r,isConnectable:t}));ks.displayName="DefaultNode";var ur=x.memo(ks);const Ss=({data:e,isConnectable:t,sourcePosition:n=K.Bottom})=>C.createElement(C.Fragment,null,e?.label,C.createElement(Mt,{type:"source",position:n,isConnectable:t}));Ss.displayName="InputNode";var Es=x.memo(Ss);const _s=({data:e,isConnectable:t,targetPosition:n=K.Top})=>C.createElement(C.Fragment,null,C.createElement(Mt,{type:"target",position:n,isConnectable:t}),e?.label);_s.displayName="OutputNode";var Cs=x.memo(_s);const Sr=()=>null;Sr.displayName="GroupNode";const Ju=e=>({selectedNodes:e.getNodes().filter(t=>t.selected),selectedEdges:e.edges.filter(t=>t.selected).map(t=>({...t}))}),un=e=>e.id;function ed(e,t){return be(e.selectedNodes.map(un),t.selectedNodes.map(un))&&be(e.selectedEdges.map(un),t.selectedEdges.map(un))}const Ms=x.memo(({onSelectionChange:e})=>{const t=ge(),{selectedNodes:n,selectedEdges:r}=ce(Ju,ed);return x.useEffect(()=>{const o={nodes:n,edges:r};e?.(o),t.getState().onSelectionChange.forEach(s=>s(o))},[n,r,e]),null});Ms.displayName="SelectionListener";const td=e=>!!e.onSelectionChange;function nd({onSelectionChange:e}){const t=ce(td);return e||t?C.createElement(Ms,{onSelectionChange:e}):null}const rd=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset});function mt(e,t){x.useEffect(()=>{typeof e<"u"&&t(e)},[e])}function se(e,t,n){x.useEffect(()=>{typeof t<"u"&&n({[e]:t})},[t])}const od=({nodes:e,edges:t,defaultNodes:n,defaultEdges:r,onConnect:o,onConnectStart:s,onConnectEnd:i,onClickConnectStart:a,onClickConnectEnd:c,nodesDraggable:u,nodesConnectable:l,nodesFocusable:d,edgesFocusable:p,edgesUpdatable:f,elevateNodesOnSelect:b,minZoom:y,maxZoom:v,nodeExtent:m,onNodesChange:S,onEdgesChange:M,elementsSelectable:w,connectionMode:T,snapGrid:$,snapToGrid:z,translateExtent:H,connectOnClick:I,defaultEdgeOptions:P,fitView:F,fitViewOptions:B,onNodesDelete:L,onEdgesDelete:h,onNodeDrag:_,onNodeDragStart:N,onNodeDragStop:A,onSelectionDrag:R,onSelectionDragStart:k,onSelectionDragStop:D,noPanClassName:j,nodeOrigin:O,rfId:X,autoPanOnConnect:Y,autoPanOnNodeDrag:G,onError:re,connectionRadius:ee,isValidConnection:oe,nodeDragThreshold:Q})=>{const{setNodes:ne,setEdges:he,setDefaultNodesAndEdges:ae,setMinZoom:pe,setMaxZoom:me,setTranslateExtent:ue,setNodeExtent:Ne,reset:te}=ce(rd,be),W=ge();return x.useEffect(()=>{const we=r?.map(fe=>({...fe,...P}));return ae(n,we),()=>{te()}},[]),se("defaultEdgeOptions",P,W.setState),se("connectionMode",T,W.setState),se("onConnect",o,W.setState),se("onConnectStart",s,W.setState),se("onConnectEnd",i,W.setState),se("onClickConnectStart",a,W.setState),se("onClickConnectEnd",c,W.setState),se("nodesDraggable",u,W.setState),se("nodesConnectable",l,W.setState),se("nodesFocusable",d,W.setState),se("edgesFocusable",p,W.setState),se("edgesUpdatable",f,W.setState),se("elementsSelectable",w,W.setState),se("elevateNodesOnSelect",b,W.setState),se("snapToGrid",z,W.setState),se("snapGrid",$,W.setState),se("onNodesChange",S,W.setState),se("onEdgesChange",M,W.setState),se("connectOnClick",I,W.setState),se("fitViewOnInit",F,W.setState),se("fitViewOnInitOptions",B,W.setState),se("onNodesDelete",L,W.setState),se("onEdgesDelete",h,W.setState),se("onNodeDrag",_,W.setState),se("onNodeDragStart",N,W.setState),se("onNodeDragStop",A,W.setState),se("onSelectionDrag",R,W.setState),se("onSelectionDragStart",k,W.setState),se("onSelectionDragStop",D,W.setState),se("noPanClassName",j,W.setState),se("nodeOrigin",O,W.setState),se("rfId",X,W.setState),se("autoPanOnConnect",Y,W.setState),se("autoPanOnNodeDrag",G,W.setState),se("onError",re,W.setState),se("connectionRadius",ee,W.setState),se("isValidConnection",oe,W.setState),se("nodeDragThreshold",Q,W.setState),mt(e,ne),mt(t,he),mt(y,pe),mt(v,me),mt(H,ue),mt(m,Ne),null},fo={display:"none"},sd={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},$s="react-flow__node-desc",Ts="react-flow__edge-desc",id="react-flow__aria-live",ad=e=>e.ariaLiveMessage;function ld({rfId:e}){const t=ce(ad);return C.createElement("div",{id:`${id}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:sd},t)}function cd({rfId:e,disableKeyboardA11y:t}){return C.createElement(C.Fragment,null,C.createElement("div",{id:`${$s}-${e}`,style:fo},"Press enter or space to select a node.",!t&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "),C.createElement("div",{id:`${Ts}-${e}`,style:fo},"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."),!t&&C.createElement(ld,{rfId:e}))}var qt=(e=null,t={actInsideInputWithModifier:!0})=>{const[n,r]=x.useState(!1),o=x.useRef(!1),s=x.useRef(new Set([])),[i,a]=x.useMemo(()=>{if(e!==null){const u=(Array.isArray(e)?e:[e]).filter(d=>typeof d=="string").map(d=>d.split("+")),l=u.reduce((d,p)=>d.concat(...p),[]);return[u,l]}return[[],[]]},[e]);return x.useEffect(()=>{const c=typeof document<"u"?document:null,u=t?.target||c;if(e!==null){const l=f=>{if(o.current=f.ctrlKey||f.metaKey||f.shiftKey,(!o.current||o.current&&!t.actInsideInputWithModifier)&&ir(f))return!1;const y=po(f.code,a);s.current.add(f[y]),ho(i,s.current,!1)&&(f.preventDefault(),r(!0))},d=f=>{if((!o.current||o.current&&!t.actInsideInputWithModifier)&&ir(f))return!1;const y=po(f.code,a);ho(i,s.current,!0)?(r(!1),s.current.clear()):s.current.delete(f[y]),f.key==="Meta"&&s.current.clear(),o.current=!1},p=()=>{s.current.clear(),r(!1)};return u?.addEventListener("keydown",l),u?.addEventListener("keyup",d),window.addEventListener("blur",p),()=>{u?.removeEventListener("keydown",l),u?.removeEventListener("keyup",d),window.removeEventListener("blur",p)}}},[e,r]),n};function ho(e,t,n){return e.filter(r=>n||r.length===t.size).some(r=>r.every(o=>t.has(o)))}function po(e,t){return t.includes(e)?"code":"key"}function As(e,t,n,r){const o=e.parentNode||e.parentId;if(!o)return n;const s=t.get(o),i=ft(s,r);return As(s,t,{x:(n.x??0)+i.x,y:(n.y??0)+i.y,z:(s[de]?.z??0)>(n.z??0)?s[de]?.z??0:n.z??0},r)}function Is(e,t,n){e.forEach(r=>{const o=r.parentNode||r.parentId;if(o&&!e.has(o))throw new Error(`Parent node ${o} not found`);if(o||n?.[r.id]){const{x:s,y:i,z:a}=As(r,e,{...r.position,z:r[de]?.z??0},t);r.positionAbsolute={x:s,y:i},r[de].z=a,n?.[r.id]&&(r[de].isParent=!0)}})}function Wn(e,t,n,r){const o=new Map,s={},i=r?1e3:0;return e.forEach(a=>{const c=(Ae(a.zIndex)?a.zIndex:0)+(a.selected?i:0),u=t.get(a.id),l={...a,positionAbsolute:{x:a.position.x,y:a.position.y}},d=a.parentNode||a.parentId;d&&(s[d]=!0);const p=u?.type&&u?.type!==a.type;Object.defineProperty(l,de,{enumerable:!1,value:{handleBounds:p?void 0:u?.[de]?.handleBounds,z:c}}),o.set(a.id,l)}),Is(o,n,s),o}function Ds(e,t={}){const{getNodes:n,width:r,height:o,minZoom:s,maxZoom:i,d3Zoom:a,d3Selection:c,fitViewOnInitDone:u,fitViewOnInit:l,nodeOrigin:d}=e(),p=t.initial&&!u&&l;if(a&&c&&(p||!t.initial)){const b=n().filter(v=>{const m=t.includeHiddenNodes?v.width&&v.height:!v.hidden;return t.nodes?.length?m&&t.nodes.some(S=>S.id===v.id):m}),y=b.every(v=>v.width&&v.height);if(b.length>0&&y){const v=In(b,d),{x:m,y:S,zoom:M}=ys(v,r,o,t.minZoom??s,t.maxZoom??i,t.padding??.1),w=Ye.translate(m,S).scale(M);return typeof t.duration=="number"&&t.duration>0?a.transform(lt(c,t.duration),w):a.transform(c,w),!0}}return!1}function ud(e,t){return e.forEach(n=>{const r=t.get(n.id);r&&t.set(r.id,{...r,[de]:r[de],selected:n.selected})}),new Map(t)}function dd(e,t){return t.map(n=>{const r=e.find(o=>o.id===n.id);return r&&(n.selected=r.selected),n})}function dn({changedNodes:e,changedEdges:t,get:n,set:r}){const{nodeInternals:o,edges:s,onNodesChange:i,onEdgesChange:a,hasDefaultNodes:c,hasDefaultEdges:u}=n();e?.length&&(c&&r({nodeInternals:ud(e,o)}),i?.(e)),t?.length&&(u&&r({edges:dd(t,s)}),a?.(t))}const xt=()=>{},fd={zoomIn:xt,zoomOut:xt,zoomTo:xt,getZoom:()=>1,setViewport:xt,getViewport:()=>({x:0,y:0,zoom:1}),fitView:()=>!1,setCenter:xt,fitBounds:xt,project:e=>e,screenToFlowPosition:e=>e,flowToScreenPosition:e=>e,viewportInitialized:!1},hd=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection}),pd=()=>{const e=ge(),{d3Zoom:t,d3Selection:n}=ce(hd,be);return x.useMemo(()=>n&&t?{zoomIn:o=>t.scaleBy(lt(n,o?.duration),1.2),zoomOut:o=>t.scaleBy(lt(n,o?.duration),1/1.2),zoomTo:(o,s)=>t.scaleTo(lt(n,s?.duration),o),getZoom:()=>e.getState().transform[2],setViewport:(o,s)=>{const[i,a,c]=e.getState().transform,u=Ye.translate(o.x??i,o.y??a).scale(o.zoom??c);t.transform(lt(n,s?.duration),u)},getViewport:()=>{const[o,s,i]=e.getState().transform;return{x:o,y:s,zoom:i}},fitView:o=>Ds(e.getState,o),setCenter:(o,s,i)=>{const{width:a,height:c,maxZoom:u}=e.getState(),l=typeof i?.zoom<"u"?i.zoom:u,d=a/2-o*l,p=c/2-s*l,f=Ye.translate(d,p).scale(l);t.transform(lt(n,i?.duration),f)},fitBounds:(o,s)=>{const{width:i,height:a,minZoom:c,maxZoom:u}=e.getState(),{x:l,y:d,zoom:p}=ys(o,i,a,c,u,s?.padding??.1),f=Ye.translate(l,d).scale(p);t.transform(lt(n,s?.duration),f)},project:o=>{const{transform:s,snapToGrid:i,snapGrid:a}=e.getState();return console.warn("[DEPRECATED] `project` is deprecated. Instead use `screenToFlowPosition`. There is no need to subtract the react flow bounds anymore! https://reactflow.dev/api-reference/types/react-flow-instance#screen-to-flow-position"),cr(o,s,i,a)},screenToFlowPosition:o=>{const{transform:s,snapToGrid:i,snapGrid:a,domNode:c}=e.getState();if(!c)return o;const{x:u,y:l}=c.getBoundingClientRect(),d={x:o.x-u,y:o.y-l};return cr(d,s,i,a)},flowToScreenPosition:o=>{const{transform:s,domNode:i}=e.getState();if(!i)return o;const{x:a,y:c}=i.getBoundingClientRect(),u=gs(o,s);return{x:u.x+a,y:u.y+c}},viewportInitialized:!0}:fd,[t,n])};function Er(){const e=pd(),t=ge(),n=x.useCallback(()=>t.getState().getNodes().map(y=>({...y})),[]),r=x.useCallback(y=>t.getState().nodeInternals.get(y),[]),o=x.useCallback(()=>{const{edges:y=[]}=t.getState();return y.map(v=>({...v}))},[]),s=x.useCallback(y=>{const{edges:v=[]}=t.getState();return v.find(m=>m.id===y)},[]),i=x.useCallback(y=>{const{getNodes:v,setNodes:m,hasDefaultNodes:S,onNodesChange:M}=t.getState(),w=v(),T=typeof y=="function"?y(w):y;if(S)m(T);else if(M){const $=T.length===0?w.map(z=>({type:"remove",id:z.id})):T.map(z=>({item:z,type:"reset"}));M($)}},[]),a=x.useCallback(y=>{const{edges:v=[],setEdges:m,hasDefaultEdges:S,onEdgesChange:M}=t.getState(),w=typeof y=="function"?y(v):y;if(S)m(w);else if(M){const T=w.length===0?v.map($=>({type:"remove",id:$.id})):w.map($=>({item:$,type:"reset"}));M(T)}},[]),c=x.useCallback(y=>{const v=Array.isArray(y)?y:[y],{getNodes:m,setNodes:S,hasDefaultNodes:M,onNodesChange:w}=t.getState();if(M){const $=[...m(),...v];S($)}else if(w){const T=v.map($=>({item:$,type:"add"}));w(T)}},[]),u=x.useCallback(y=>{const v=Array.isArray(y)?y:[y],{edges:m=[],setEdges:S,hasDefaultEdges:M,onEdgesChange:w}=t.getState();if(M)S([...m,...v]);else if(w){const T=v.map($=>({item:$,type:"add"}));w(T)}},[]),l=x.useCallback(()=>{const{getNodes:y,edges:v=[],transform:m}=t.getState(),[S,M,w]=m;return{nodes:y().map(T=>({...T})),edges:v.map(T=>({...T})),viewport:{x:S,y:M,zoom:w}}},[]),d=x.useCallback(({nodes:y,edges:v})=>{const{nodeInternals:m,getNodes:S,edges:M,hasDefaultNodes:w,hasDefaultEdges:T,onNodesDelete:$,onEdgesDelete:z,onNodesChange:H,onEdgesChange:I}=t.getState(),P=(y||[]).map(_=>_.id),F=(v||[]).map(_=>_.id),B=S().reduce((_,N)=>{const A=N.parentNode||N.parentId,R=!P.includes(N.id)&&A&&_.find(D=>D.id===A);return(typeof N.deletable=="boolean"?N.deletable:!0)&&(P.includes(N.id)||R)&&_.push(N),_},[]),L=M.filter(_=>typeof _.deletable=="boolean"?_.deletable:!0),h=L.filter(_=>F.includes(_.id));if(B||h){const _=xs(B,L),N=[...h,..._],A=N.reduce((R,k)=>(R.includes(k.id)||R.push(k.id),R),[]);if((T||w)&&(T&&t.setState({edges:M.filter(R=>!A.includes(R.id))}),w&&(B.forEach(R=>{m.delete(R.id)}),t.setState({nodeInternals:new Map(m)}))),A.length>0&&(z?.(N),I&&I(A.map(R=>({id:R,type:"remove"})))),B.length>0&&($?.(B),H)){const R=B.map(k=>({id:k.id,type:"remove"}));H(R)}}},[]),p=x.useCallback(y=>{const v=ju(y),m=v?null:t.getState().nodeInternals.get(y.id);return!v&&!m?[null,null,v]:[v?y:oo(m),m,v]},[]),f=x.useCallback((y,v=!0,m)=>{const[S,M,w]=p(y);return S?(m||t.getState().getNodes()).filter(T=>{if(!w&&(T.id===M.id||!T.positionAbsolute))return!1;const $=oo(T),z=sr($,S);return v&&z>0||z>=S.width*S.height}):[]},[]),b=x.useCallback((y,v,m=!0)=>{const[S]=p(y);if(!S)return!1;const M=sr(S,v);return m&&M>0||M>=S.width*S.height},[]);return x.useMemo(()=>({...e,getNodes:n,getNode:r,getEdges:o,getEdge:s,setNodes:i,setEdges:a,addNodes:c,addEdges:u,toObject:l,deleteElements:d,getIntersectingNodes:f,isNodeIntersecting:b}),[e,n,r,o,s,i,a,c,u,l,d,f,b])}const gd={actInsideInputWithModifier:!1};var md=({deleteKeyCode:e,multiSelectionKeyCode:t})=>{const n=ge(),{deleteElements:r}=Er(),o=qt(e,gd),s=qt(t);x.useEffect(()=>{if(o){const{edges:i,getNodes:a}=n.getState(),c=a().filter(l=>l.selected),u=i.filter(l=>l.selected);r({nodes:c,edges:u}),n.setState({nodesSelectionActive:!1})}},[o]),x.useEffect(()=>{n.setState({multiSelectionActive:s})},[s])};function xd(e){const t=ge();x.useEffect(()=>{let n;const r=()=>{if(!e.current)return;const o=br(e.current);(o.height===0||o.width===0)&&t.getState().onError?.("004",Ue.error004()),t.setState({width:o.width||500,height:o.height||500})};return r(),window.addEventListener("resize",r),e.current&&(n=new ResizeObserver(()=>r()),n.observe(e.current)),()=>{window.removeEventListener("resize",r),n&&e.current&&n.unobserve(e.current)}},[])}const _r={position:"absolute",width:"100%",height:"100%",top:0,left:0},yd=(e,t)=>e.x!==t.x||e.y!==t.y||e.zoom!==t.k,fn=e=>({x:e.x,y:e.y,zoom:e.k}),yt=(e,t)=>e.target.closest(`.${t}`),go=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),mo=e=>{const t=e.ctrlKey&&kn()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t},bd=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection,d3ZoomHandler:e.d3ZoomHandler,userSelectionActive:e.userSelectionActive}),wd=({onMove:e,onMoveStart:t,onMoveEnd:n,onPaneContextMenu:r,zoomOnScroll:o=!0,zoomOnPinch:s=!0,panOnScroll:i=!1,panOnScrollSpeed:a=.5,panOnScrollMode:c=ut.Free,zoomOnDoubleClick:u=!0,elementsSelectable:l,panOnDrag:d=!0,defaultViewport:p,translateExtent:f,minZoom:b,maxZoom:y,zoomActivationKeyCode:v,preventScrolling:m=!0,children:S,noWheelClassName:M,noPanClassName:w})=>{const T=x.useRef(),$=ge(),z=x.useRef(!1),H=x.useRef(!1),I=x.useRef(null),P=x.useRef({x:0,y:0,zoom:0}),{d3Zoom:F,d3Selection:B,d3ZoomHandler:L,userSelectionActive:h}=ce(bd,be),_=qt(v),N=x.useRef(0),A=x.useRef(!1),R=x.useRef();return xd(I),x.useEffect(()=>{if(I.current){const k=I.current.getBoundingClientRect(),D=rs().scaleExtent([b,y]).translateExtent(f),j=Te(I.current).call(D),O=Ye.translate(p.x,p.y).scale(_t(p.zoom,b,y)),X=[[0,0],[k.width,k.height]],Y=D.constrain()(O,X,f);D.transform(j,Y),D.wheelDelta(mo),$.setState({d3Zoom:D,d3Selection:j,d3ZoomHandler:j.on("wheel.zoom"),transform:[Y.x,Y.y,Y.k],domNode:I.current.closest(".react-flow")})}},[]),x.useEffect(()=>{B&&F&&(i&&!_&&!h?B.on("wheel.zoom",k=>{if(yt(k,M))return!1;k.preventDefault(),k.stopImmediatePropagation();const D=B.property("__zoom").k||1;if(k.ctrlKey&&s){const oe=Ie(k),Q=mo(k),ne=D*Math.pow(2,Q);F.scaleTo(B,ne,oe,k);return}const j=k.deltaMode===1?20:1;let O=c===ut.Vertical?0:k.deltaX*j,X=c===ut.Horizontal?0:k.deltaY*j;!kn()&&k.shiftKey&&c!==ut.Vertical&&(O=k.deltaY*j,X=0),F.translateBy(B,-(O/D)*a,-(X/D)*a,{internal:!0});const Y=fn(B.property("__zoom")),{onViewportChangeStart:G,onViewportChange:re,onViewportChangeEnd:ee}=$.getState();clearTimeout(R.current),A.current||(A.current=!0,t?.(k,Y),G?.(Y)),A.current&&(e?.(k,Y),re?.(Y),R.current=setTimeout(()=>{n?.(k,Y),ee?.(Y),A.current=!1},150))},{passive:!1}):typeof L<"u"&&B.on("wheel.zoom",function(k,D){if(!m&&k.type==="wheel"&&!k.ctrlKey||yt(k,M))return null;k.preventDefault(),L.call(this,k,D)},{passive:!1}))},[h,i,c,B,F,L,_,s,m,M,t,e,n]),x.useEffect(()=>{F&&F.on("start",k=>{if(!k.sourceEvent||k.sourceEvent.internal)return null;N.current=k.sourceEvent?.button;const{onViewportChangeStart:D}=$.getState(),j=fn(k.transform);z.current=!0,P.current=j,k.sourceEvent?.type==="mousedown"&&$.setState({paneDragging:!0}),D?.(j),t?.(k.sourceEvent,j)})},[F,t]),x.useEffect(()=>{F&&(h&&!z.current?F.on("zoom",null):h||F.on("zoom",k=>{const{onViewportChange:D}=$.getState();if($.setState({transform:[k.transform.x,k.transform.y,k.transform.k]}),H.current=!!(r&&go(d,N.current??0)),(e||D)&&!k.sourceEvent?.internal){const j=fn(k.transform);D?.(j),e?.(k.sourceEvent,j)}}))},[h,F,e,d,r]),x.useEffect(()=>{F&&F.on("end",k=>{if(!k.sourceEvent||k.sourceEvent.internal)return null;const{onViewportChangeEnd:D}=$.getState();if(z.current=!1,$.setState({paneDragging:!1}),r&&go(d,N.current??0)&&!H.current&&r(k.sourceEvent),H.current=!1,(n||D)&&yd(P.current,k.transform)){const j=fn(k.transform);P.current=j,clearTimeout(T.current),T.current=setTimeout(()=>{D?.(j),n?.(k.sourceEvent,j)},i?150:0)}})},[F,i,d,n,r]),x.useEffect(()=>{F&&F.filter(k=>{const D=_||o,j=s&&k.ctrlKey;if((d===!0||Array.isArray(d)&&d.includes(1))&&k.button===1&&k.type==="mousedown"&&(yt(k,"react-flow__node")||yt(k,"react-flow__edge")))return!0;if(!d&&!D&&!i&&!u&&!s||h||!u&&k.type==="dblclick"||yt(k,M)&&k.type==="wheel"||yt(k,w)&&(k.type!=="wheel"||i&&k.type==="wheel"&&!_)||!s&&k.ctrlKey&&k.type==="wheel"||!D&&!i&&!j&&k.type==="wheel"||!d&&(k.type==="mousedown"||k.type==="touchstart")||Array.isArray(d)&&!d.includes(k.button)&&k.type==="mousedown")return!1;const O=Array.isArray(d)&&d.includes(k.button)||!k.button||k.button<=1;return(!k.ctrlKey||k.type==="wheel")&&O})},[h,F,o,s,i,u,d,l,_]),C.createElement("div",{className:"react-flow__renderer",ref:I,style:_r},S)},vd=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function Nd(){const{userSelectionActive:e,userSelectionRect:t}=ce(vd,be);return e&&t?C.createElement("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}function xo(e,t){const n=t.parentNode||t.parentId,r=e.find(o=>o.id===n);if(r){const o=t.position.x+t.width-r.width,s=t.position.y+t.height-r.height;if(o>0||s>0||t.position.x<0||t.position.y<0){if(r.style={...r.style},r.style.width=r.style.width??r.width,r.style.height=r.style.height??r.height,o>0&&(r.style.width+=o),s>0&&(r.style.height+=s),t.position.x<0){const i=Math.abs(t.position.x);r.position.x=r.position.x-i,r.style.width+=i,t.position.x=0}if(t.position.y<0){const i=Math.abs(t.position.y);r.position.y=r.position.y-i,r.style.height+=i,t.position.y=0}r.width=r.style.width,r.height=r.style.height}}}function js(e,t){if(e.some(r=>r.type==="reset"))return e.filter(r=>r.type==="reset").map(r=>r.item);const n=e.filter(r=>r.type==="add").map(r=>r.item);return t.reduce((r,o)=>{const s=e.filter(a=>a.id===o.id);if(s.length===0)return r.push(o),r;const i={...o};for(const a of s)if(a)switch(a.type){case"select":{i.selected=a.selected;break}case"position":{typeof a.position<"u"&&(i.position=a.position),typeof a.positionAbsolute<"u"&&(i.positionAbsolute=a.positionAbsolute),typeof a.dragging<"u"&&(i.dragging=a.dragging),i.expandParent&&xo(r,i);break}case"dimensions":{typeof a.dimensions<"u"&&(i.width=a.dimensions.width,i.height=a.dimensions.height),typeof a.updateStyle<"u"&&(i.style={...i.style||{},...a.dimensions}),typeof a.resizing=="boolean"&&(i.resizing=a.resizing),i.expandParent&&xo(r,i);break}case"remove":return r}return r.push(i),r},n)}function zs(e,t){return js(e,t)}function kd(e,t){return js(e,t)}const rt=(e,t)=>({id:e,type:"select",selected:t});function wt(e,t){return e.reduce((n,r)=>{const o=t.includes(r.id);return!r.selected&&o?(r.selected=!0,n.push(rt(r.id,!0))):r.selected&&!o&&(r.selected=!1,n.push(rt(r.id,!1))),n},[])}const Un=(e,t)=>n=>{n.target===t.current&&e?.(n)},Sd=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,dragging:e.paneDragging}),Rs=x.memo(({isSelecting:e,selectionMode:t=Ut.Full,panOnDrag:n,onSelectionStart:r,onSelectionEnd:o,onPaneClick:s,onPaneContextMenu:i,onPaneScroll:a,onPaneMouseEnter:c,onPaneMouseMove:u,onPaneMouseLeave:l,children:d})=>{const p=x.useRef(null),f=ge(),b=x.useRef(0),y=x.useRef(0),v=x.useRef(),{userSelectionActive:m,elementsSelectable:S,dragging:M}=ce(Sd,be),w=()=>{f.setState({userSelectionActive:!1,userSelectionRect:null}),b.current=0,y.current=0},T=L=>{s?.(L),f.getState().resetSelectedElements(),f.setState({nodesSelectionActive:!1})},$=L=>{if(Array.isArray(n)&&n?.includes(2)){L.preventDefault();return}i?.(L)},z=a?L=>a(L):void 0,H=L=>{const{resetSelectedElements:h,domNode:_}=f.getState();if(v.current=_?.getBoundingClientRect(),!S||!e||L.button!==0||L.target!==p.current||!v.current)return;const{x:N,y:A}=st(L,v.current);h(),f.setState({userSelectionRect:{width:0,height:0,startX:N,startY:A,x:N,y:A}}),r?.(L)},I=L=>{const{userSelectionRect:h,nodeInternals:_,edges:N,transform:A,onNodesChange:R,onEdgesChange:k,nodeOrigin:D,getNodes:j}=f.getState();if(!e||!v.current||!h)return;f.setState({userSelectionActive:!0,nodesSelectionActive:!1});const O=st(L,v.current),X=h.startX??0,Y=h.startY??0,G={...h,x:O.x<X?O.x:X,y:O.y<Y?O.y:Y,width:Math.abs(O.x-X),height:Math.abs(O.y-Y)},re=j(),ee=ms(_,G,A,t===Ut.Partial,!0,D),oe=xs(ee,N).map(ne=>ne.id),Q=ee.map(ne=>ne.id);if(b.current!==Q.length){b.current=Q.length;const ne=wt(re,Q);ne.length&&R?.(ne)}if(y.current!==oe.length){y.current=oe.length;const ne=wt(N,oe);ne.length&&k?.(ne)}f.setState({userSelectionRect:G})},P=L=>{if(L.button!==0)return;const{userSelectionRect:h}=f.getState();!m&&h&&L.target===p.current&&T?.(L),f.setState({nodesSelectionActive:b.current>0}),w(),o?.(L)},F=L=>{m&&(f.setState({nodesSelectionActive:b.current>0}),o?.(L)),w()},B=S&&(e||m);return C.createElement("div",{className:ve(["react-flow__pane",{dragging:M,selection:e}]),onClick:B?void 0:Un(T,p),onContextMenu:Un($,p),onWheel:Un(z,p),onMouseEnter:B?void 0:c,onMouseDown:B?H:void 0,onMouseMove:B?I:u,onMouseUp:B?P:void 0,onMouseLeave:B?F:l,ref:p,style:_r},d,C.createElement(Nd,null))});Rs.displayName="Pane";function Hs(e,t){const n=e.parentNode||e.parentId;if(!n)return!1;const r=t.get(n);return r?r.selected?!0:Hs(r,t):!1}function yo(e,t,n){let r=e;do{if(r?.matches(t))return!0;if(r===n.current)return!1;r=r.parentElement}while(r);return!1}function Ed(e,t,n,r){return Array.from(e.values()).filter(o=>(o.selected||o.id===r)&&(!o.parentNode||o.parentId||!Hs(o,e))&&(o.draggable||t&&typeof o.draggable>"u")).map(o=>({id:o.id,position:o.position||{x:0,y:0},positionAbsolute:o.positionAbsolute||{x:0,y:0},distance:{x:n.x-(o.positionAbsolute?.x??0),y:n.y-(o.positionAbsolute?.y??0)},delta:{x:0,y:0},extent:o.extent,parentNode:o.parentNode||o.parentId,parentId:o.parentNode||o.parentId,width:o.width,height:o.height,expandParent:o.expandParent}))}function _d(e,t){return!t||t==="parent"?t:[t[0],[t[1][0]-(e.width||0),t[1][1]-(e.height||0)]]}function Ps(e,t,n,r,o=[0,0],s){const i=_d(e,e.extent||r);let a=i;const c=e.parentNode||e.parentId;if(e.extent==="parent"&&!e.expandParent)if(c&&e.width&&e.height){const d=n.get(c),{x:p,y:f}=ft(d,o).positionAbsolute;a=d&&Ae(p)&&Ae(f)&&Ae(d.width)&&Ae(d.height)?[[p+e.width*o[0],f+e.height*o[1]],[p+d.width-e.width+e.width*o[0],f+d.height-e.height+e.height*o[1]]]:a}else s?.("005",Ue.error005()),a=i;else if(e.extent&&c&&e.extent!=="parent"){const d=n.get(c),{x:p,y:f}=ft(d,o).positionAbsolute;a=[[e.extent[0][0]+p,e.extent[0][1]+f],[e.extent[1][0]+p,e.extent[1][1]+f]]}let u={x:0,y:0};if(c){const d=n.get(c);u=ft(d,o).positionAbsolute}const l=a&&a!=="parent"?wr(t,a):t;return{position:{x:l.x-u.x,y:l.y-u.y},positionAbsolute:l}}function Zn({nodeId:e,dragItems:t,nodeInternals:n}){const r=t.map(o=>({...n.get(o.id),position:o.position,positionAbsolute:o.positionAbsolute}));return[e?r.find(o=>o.id===e):r[0],r]}const bo=(e,t,n,r)=>{const o=t.querySelectorAll(e);if(!o||!o.length)return null;const s=Array.from(o),i=t.getBoundingClientRect(),a={x:i.width*r[0],y:i.height*r[1]};return s.map(c=>{const u=c.getBoundingClientRect();return{id:c.getAttribute("data-handleid"),position:c.getAttribute("data-handlepos"),x:(u.left-i.left-a.x)/n,y:(u.top-i.top-a.y)/n,...br(c)}})};function zt(e,t,n){return n===void 0?n:r=>{const o=t().nodeInternals.get(e);o&&n(r,{...o})}}function dr({id:e,store:t,unselect:n=!1,nodeRef:r}){const{addSelectedNodes:o,unselectNodesAndEdges:s,multiSelectionActive:i,nodeInternals:a,onError:c}=t.getState(),u=a.get(e);if(!u){c?.("012",Ue.error012(e));return}t.setState({nodesSelectionActive:!1}),u.selected?(n||u.selected&&i)&&(s({nodes:[u],edges:[]}),requestAnimationFrame(()=>r?.current?.blur())):o([e])}function Cd(){const e=ge();return x.useCallback(({sourceEvent:n})=>{const{transform:r,snapGrid:o,snapToGrid:s}=e.getState(),i=n.touches?n.touches[0].clientX:n.clientX,a=n.touches?n.touches[0].clientY:n.clientY,c={x:(i-r[0])/r[2],y:(a-r[1])/r[2]};return{xSnapped:s?o[0]*Math.round(c.x/o[0]):c.x,ySnapped:s?o[1]*Math.round(c.y/o[1]):c.y,...c}},[])}function qn(e){return(t,n,r)=>e?.(t,r)}function Ls({nodeRef:e,disabled:t=!1,noDragClassName:n,handleSelector:r,nodeId:o,isSelectable:s,selectNodesOnDrag:i}){const a=ge(),[c,u]=x.useState(!1),l=x.useRef([]),d=x.useRef({x:null,y:null}),p=x.useRef(0),f=x.useRef(null),b=x.useRef({x:0,y:0}),y=x.useRef(null),v=x.useRef(!1),m=x.useRef(!1),S=x.useRef(!1),M=Cd();return x.useEffect(()=>{if(e?.current){const w=Te(e.current),T=({x:H,y:I})=>{const{nodeInternals:P,onNodeDrag:F,onSelectionDrag:B,updateNodePositions:L,nodeExtent:h,snapGrid:_,snapToGrid:N,nodeOrigin:A,onError:R}=a.getState();d.current={x:H,y:I};let k=!1,D={x:0,y:0,x2:0,y2:0};if(l.current.length>1&&h){const O=In(l.current,A);D=Wt(O)}if(l.current=l.current.map(O=>{const X={x:H-O.distance.x,y:I-O.distance.y};N&&(X.x=_[0]*Math.round(X.x/_[0]),X.y=_[1]*Math.round(X.y/_[1]));const Y=[[h[0][0],h[0][1]],[h[1][0],h[1][1]]];l.current.length>1&&h&&!O.extent&&(Y[0][0]=O.positionAbsolute.x-D.x+h[0][0],Y[1][0]=O.positionAbsolute.x+(O.width??0)-D.x2+h[1][0],Y[0][1]=O.positionAbsolute.y-D.y+h[0][1],Y[1][1]=O.positionAbsolute.y+(O.height??0)-D.y2+h[1][1]);const G=Ps(O,X,P,Y,A,R);return k=k||O.position.x!==G.position.x||O.position.y!==G.position.y,O.position=G.position,O.positionAbsolute=G.positionAbsolute,O}),!k)return;L(l.current,!0,!0),u(!0);const j=o?F:qn(B);if(j&&y.current){const[O,X]=Zn({nodeId:o,dragItems:l.current,nodeInternals:P});j(y.current,O,X)}},$=()=>{if(!f.current)return;const[H,I]=ss(b.current,f.current);if(H!==0||I!==0){const{transform:P,panBy:F}=a.getState();d.current.x=(d.current.x??0)-H/P[2],d.current.y=(d.current.y??0)-I/P[2],F({x:H,y:I})&&T(d.current)}p.current=requestAnimationFrame($)},z=H=>{const{nodeInternals:I,multiSelectionActive:P,nodesDraggable:F,unselectNodesAndEdges:B,onNodeDragStart:L,onSelectionDragStart:h}=a.getState();m.current=!0;const _=o?L:qn(h);(!i||!s)&&!P&&o&&(I.get(o)?.selected||B()),o&&s&&i&&dr({id:o,store:a,nodeRef:e});const N=M(H);if(d.current=N,l.current=Ed(I,F,N,o),_&&l.current){const[A,R]=Zn({nodeId:o,dragItems:l.current,nodeInternals:I});_(H.sourceEvent,A,R)}};if(t)w.on(".drag",null);else{const H=Pl().on("start",I=>{const{domNode:P,nodeDragThreshold:F}=a.getState();F===0&&z(I),S.current=!1;const B=M(I);d.current=B,f.current=P?.getBoundingClientRect()||null,b.current=st(I.sourceEvent,f.current)}).on("drag",I=>{const P=M(I),{autoPanOnNodeDrag:F,nodeDragThreshold:B}=a.getState();if(I.sourceEvent.type==="touchmove"&&I.sourceEvent.touches.length>1&&(S.current=!0),!S.current){if(!v.current&&m.current&&F&&(v.current=!0,$()),!m.current){const L=P.xSnapped-(d?.current?.x??0),h=P.ySnapped-(d?.current?.y??0);Math.sqrt(L*L+h*h)>B&&z(I)}(d.current.x!==P.xSnapped||d.current.y!==P.ySnapped)&&l.current&&m.current&&(y.current=I.sourceEvent,b.current=st(I.sourceEvent,f.current),T(P))}}).on("end",I=>{if(!(!m.current||S.current)&&(u(!1),v.current=!1,m.current=!1,cancelAnimationFrame(p.current),l.current)){const{updateNodePositions:P,nodeInternals:F,onNodeDragStop:B,onSelectionDragStop:L}=a.getState(),h=o?B:qn(L);if(P(l.current,!1,!1),h){const[_,N]=Zn({nodeId:o,dragItems:l.current,nodeInternals:F});h(I.sourceEvent,_,N)}}}).filter(I=>{const P=I.target;return!I.button&&(!n||!yo(P,`.${n}`,e))&&(!r||yo(P,r,e))});return w.call(H),()=>{w.on(".drag",null)}}}},[e,t,n,r,s,a,o,i,M]),c}function Os(){const e=ge();return x.useCallback(n=>{const{nodeInternals:r,nodeExtent:o,updateNodePositions:s,getNodes:i,snapToGrid:a,snapGrid:c,onError:u,nodesDraggable:l}=e.getState(),d=i().filter(S=>S.selected&&(S.draggable||l&&typeof S.draggable>"u")),p=a?c[0]:5,f=a?c[1]:5,b=n.isShiftPressed?4:1,y=n.x*p*b,v=n.y*f*b,m=d.map(S=>{if(S.positionAbsolute){const M={x:S.positionAbsolute.x+y,y:S.positionAbsolute.y+v};a&&(M.x=c[0]*Math.round(M.x/c[0]),M.y=c[1]*Math.round(M.y/c[1]));const{positionAbsolute:w,position:T}=Ps(S,M,r,o,void 0,u);S.position=T,S.positionAbsolute=w}return S});s(m,!0,!1)},[])}const kt={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var Rt=e=>{const t=({id:n,type:r,data:o,xPos:s,yPos:i,xPosOrigin:a,yPosOrigin:c,selected:u,onClick:l,onMouseEnter:d,onMouseMove:p,onMouseLeave:f,onContextMenu:b,onDoubleClick:y,style:v,className:m,isDraggable:S,isSelectable:M,isConnectable:w,isFocusable:T,selectNodesOnDrag:$,sourcePosition:z,targetPosition:H,hidden:I,resizeObserver:P,dragHandle:F,zIndex:B,isParent:L,noDragClassName:h,noPanClassName:_,initialized:N,disableKeyboardA11y:A,ariaLabel:R,rfId:k,hasHandleBounds:D})=>{const j=ge(),O=x.useRef(null),X=x.useRef(null),Y=x.useRef(z),G=x.useRef(H),re=x.useRef(r),ee=M||S||l||d||p||f,oe=Os(),Q=zt(n,j.getState,d),ne=zt(n,j.getState,p),he=zt(n,j.getState,f),ae=zt(n,j.getState,b),pe=zt(n,j.getState,y),me=te=>{const{nodeDragThreshold:W}=j.getState();if(M&&(!$||!S||W>0)&&dr({id:n,store:j,nodeRef:O}),l){const we=j.getState().nodeInternals.get(n);we&&l(te,{...we})}},ue=te=>{if(!ir(te)&&!A)if(cs.includes(te.key)&&M){const W=te.key==="Escape";dr({id:n,store:j,unselect:W,nodeRef:O})}else S&&u&&Object.prototype.hasOwnProperty.call(kt,te.key)&&(j.setState({ariaLiveMessage:`Moved selected node ${te.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~s}, y: ${~~i}`}),oe({x:kt[te.key].x,y:kt[te.key].y,isShiftPressed:te.shiftKey}))};x.useEffect(()=>()=>{X.current&&(P?.unobserve(X.current),X.current=null)},[]),x.useEffect(()=>{if(O.current&&!I){const te=O.current;(!N||!D||X.current!==te)&&(X.current&&P?.unobserve(X.current),P?.observe(te),X.current=te)}},[I,N,D]),x.useEffect(()=>{const te=re.current!==r,W=Y.current!==z,we=G.current!==H;O.current&&(te||W||we)&&(te&&(re.current=r),W&&(Y.current=z),we&&(G.current=H),j.getState().updateNodeDimensions([{id:n,nodeElement:O.current,forceUpdate:!0}]))},[n,r,z,H]);const Ne=Ls({nodeRef:O,disabled:I||!S,noDragClassName:h,handleSelector:F,nodeId:n,isSelectable:M,selectNodesOnDrag:$});return I?null:C.createElement("div",{className:ve(["react-flow__node",`react-flow__node-${r}`,{[_]:S},m,{selected:u,selectable:M,parent:L,dragging:Ne}]),ref:O,style:{zIndex:B,transform:`translate(${a}px,${c}px)`,pointerEvents:ee?"all":"none",visibility:N?"visible":"hidden",...v},"data-id":n,"data-testid":`rf__node-${n}`,onMouseEnter:Q,onMouseMove:ne,onMouseLeave:he,onContextMenu:ae,onClick:me,onDoubleClick:pe,onKeyDown:T?ue:void 0,tabIndex:T?0:void 0,role:T?"button":void 0,"aria-describedby":A?void 0:`${$s}-${k}`,"aria-label":R},C.createElement(Fu,{value:n},C.createElement(e,{id:n,data:o,type:r,xPos:s,yPos:i,selected:u,isConnectable:w,sourcePosition:z,targetPosition:H,dragging:Ne,dragHandle:F,zIndex:B})))};return t.displayName="NodeWrapper",x.memo(t)};const Md=e=>{const t=e.getNodes().filter(n=>n.selected);return{...In(t,e.nodeOrigin),transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`,userSelectionActive:e.userSelectionActive}};function $d({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:n}){const r=ge(),{width:o,height:s,x:i,y:a,transformString:c,userSelectionActive:u}=ce(Md,be),l=Os(),d=x.useRef(null);if(x.useEffect(()=>{n||d.current?.focus({preventScroll:!0})},[n]),Ls({nodeRef:d}),u||!o||!s)return null;const p=e?b=>{const y=r.getState().getNodes().filter(v=>v.selected);e(b,y)}:void 0,f=b=>{Object.prototype.hasOwnProperty.call(kt,b.key)&&l({x:kt[b.key].x,y:kt[b.key].y,isShiftPressed:b.shiftKey})};return C.createElement("div",{className:ve(["react-flow__nodesselection","react-flow__container",t]),style:{transform:c}},C.createElement("div",{ref:d,className:"react-flow__nodesselection-rect",onContextMenu:p,tabIndex:n?void 0:-1,onKeyDown:n?void 0:f,style:{width:o,height:s,top:a,left:i}}))}var Td=x.memo($d);const Ad=e=>e.nodesSelectionActive,Fs=({children:e,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:o,onPaneContextMenu:s,onPaneScroll:i,deleteKeyCode:a,onMove:c,onMoveStart:u,onMoveEnd:l,selectionKeyCode:d,selectionOnDrag:p,selectionMode:f,onSelectionStart:b,onSelectionEnd:y,multiSelectionKeyCode:v,panActivationKeyCode:m,zoomActivationKeyCode:S,elementsSelectable:M,zoomOnScroll:w,zoomOnPinch:T,panOnScroll:$,panOnScrollSpeed:z,panOnScrollMode:H,zoomOnDoubleClick:I,panOnDrag:P,defaultViewport:F,translateExtent:B,minZoom:L,maxZoom:h,preventScrolling:_,onSelectionContextMenu:N,noWheelClassName:A,noPanClassName:R,disableKeyboardA11y:k})=>{const D=ce(Ad),j=qt(d),O=qt(m),X=O||P,Y=O||$,G=j||p&&X!==!0;return md({deleteKeyCode:a,multiSelectionKeyCode:v}),C.createElement(wd,{onMove:c,onMoveStart:u,onMoveEnd:l,onPaneContextMenu:s,elementsSelectable:M,zoomOnScroll:w,zoomOnPinch:T,panOnScroll:Y,panOnScrollSpeed:z,panOnScrollMode:H,zoomOnDoubleClick:I,panOnDrag:!j&&X,defaultViewport:F,translateExtent:B,minZoom:L,maxZoom:h,zoomActivationKeyCode:S,preventScrolling:_,noWheelClassName:A,noPanClassName:R},C.createElement(Rs,{onSelectionStart:b,onSelectionEnd:y,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:o,onPaneContextMenu:s,onPaneScroll:i,panOnDrag:X,isSelecting:!!G,selectionMode:f},e,D&&C.createElement(Td,{onSelectionContextMenu:N,noPanClassName:R,disableKeyboardA11y:k})))};Fs.displayName="FlowRenderer";var Id=x.memo(Fs);function Dd(e){return ce(x.useCallback(n=>e?ms(n.nodeInternals,{x:0,y:0,width:n.width,height:n.height},n.transform,!0):n.getNodes(),[e]))}function jd(e){const t={input:Rt(e.input||Es),default:Rt(e.default||ur),output:Rt(e.output||Cs),group:Rt(e.group||Sr)},n={},r=Object.keys(e).filter(o=>!["input","default","output","group"].includes(o)).reduce((o,s)=>(o[s]=Rt(e[s]||ur),o),n);return{...t,...r}}const zd=({x:e,y:t,width:n,height:r,origin:o})=>!n||!r?{x:e,y:t}:o[0]<0||o[1]<0||o[0]>1||o[1]>1?{x:e,y:t}:{x:e-n*o[0],y:t-r*o[1]},Rd=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,updateNodeDimensions:e.updateNodeDimensions,onError:e.onError}),Bs=e=>{const{nodesDraggable:t,nodesConnectable:n,nodesFocusable:r,elementsSelectable:o,updateNodeDimensions:s,onError:i}=ce(Rd,be),a=Dd(e.onlyRenderVisibleElements),c=x.useRef(),u=x.useMemo(()=>{if(typeof ResizeObserver>"u")return null;const l=new ResizeObserver(d=>{const p=d.map(f=>({id:f.target.getAttribute("data-id"),nodeElement:f.target,forceUpdate:!0}));s(p)});return c.current=l,l},[]);return x.useEffect(()=>()=>{c?.current?.disconnect()},[]),C.createElement("div",{className:"react-flow__nodes",style:_r},a.map(l=>{let d=l.type||"default";e.nodeTypes[d]||(i?.("003",Ue.error003(d)),d="default");const p=e.nodeTypes[d]||e.nodeTypes.default,f=!!(l.draggable||t&&typeof l.draggable>"u"),b=!!(l.selectable||o&&typeof l.selectable>"u"),y=!!(l.connectable||n&&typeof l.connectable>"u"),v=!!(l.focusable||r&&typeof l.focusable>"u"),m=e.nodeExtent?wr(l.positionAbsolute,e.nodeExtent):l.positionAbsolute,S=m?.x??0,M=m?.y??0,w=zd({x:S,y:M,width:l.width??0,height:l.height??0,origin:e.nodeOrigin});return C.createElement(p,{key:l.id,id:l.id,className:l.className,style:l.style,type:d,data:l.data,sourcePosition:l.sourcePosition||K.Bottom,targetPosition:l.targetPosition||K.Top,hidden:l.hidden,xPos:S,yPos:M,xPosOrigin:w.x,yPosOrigin:w.y,selectNodesOnDrag:e.selectNodesOnDrag,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,selected:!!l.selected,isDraggable:f,isSelectable:b,isConnectable:y,isFocusable:v,resizeObserver:u,dragHandle:l.dragHandle,zIndex:l[de]?.z??0,isParent:!!l[de]?.isParent,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,initialized:!!l.width&&!!l.height,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,ariaLabel:l.ariaLabel,hasHandleBounds:!!l[de]?.handleBounds})}))};Bs.displayName="NodeRenderer";var Hd=x.memo(Bs);const Pd=(e,t,n)=>n===K.Left?e-t:n===K.Right?e+t:e,Ld=(e,t,n)=>n===K.Top?e-t:n===K.Bottom?e+t:e,wo="react-flow__edgeupdater",vo=({position:e,centerX:t,centerY:n,radius:r=10,onMouseDown:o,onMouseEnter:s,onMouseOut:i,type:a})=>C.createElement("circle",{onMouseDown:o,onMouseEnter:s,onMouseOut:i,className:ve([wo,`${wo}-${a}`]),cx:Pd(t,r,e),cy:Ld(n,r,e),r,stroke:"transparent",fill:"transparent"}),Od=()=>!0;var bt=e=>{const t=({id:n,className:r,type:o,data:s,onClick:i,onEdgeDoubleClick:a,selected:c,animated:u,label:l,labelStyle:d,labelShowBg:p,labelBgStyle:f,labelBgPadding:b,labelBgBorderRadius:y,style:v,source:m,target:S,sourceX:M,sourceY:w,targetX:T,targetY:$,sourcePosition:z,targetPosition:H,elementsSelectable:I,hidden:P,sourceHandleId:F,targetHandleId:B,onContextMenu:L,onMouseEnter:h,onMouseMove:_,onMouseLeave:N,reconnectRadius:A,onReconnect:R,onReconnectStart:k,onReconnectEnd:D,markerEnd:j,markerStart:O,rfId:X,ariaLabel:Y,isFocusable:G,isReconnectable:re,pathOptions:ee,interactionWidth:oe,disableKeyboardA11y:Q})=>{const ne=x.useRef(null),[he,ae]=x.useState(!1),[pe,me]=x.useState(!1),ue=ge(),Ne=x.useMemo(()=>`url('#${lr(O,X)}')`,[O,X]),te=x.useMemo(()=>`url('#${lr(j,X)}')`,[j,X]);if(P)return null;const W=ye=>{const{edges:Me,addSelectedEdges:Fe,unselectNodesAndEdges:$e,multiSelectionActive:Qe}=ue.getState(),_e=Me.find(Be=>Be.id===n);_e&&(I&&(ue.setState({nodesSelectionActive:!1}),_e.selected&&Qe?($e({nodes:[],edges:[_e]}),ne.current?.blur()):Fe([n])),i&&i(ye,_e))},we=jt(n,ue.getState,a),fe=jt(n,ue.getState,L),xe=jt(n,ue.getState,h),Ze=jt(n,ue.getState,_),qe=jt(n,ue.getState,N),Se=(ye,Me)=>{if(ye.button!==0)return;const{edges:Fe,isValidConnection:$e}=ue.getState(),Qe=Me?S:m,_e=(Me?B:F)||null,Be=Me?"target":"source",$t=$e||Od,Tt=Me,at=Fe.find(He=>He.id===n);me(!0),k?.(ye,at,Be);const At=He=>{me(!1),D?.(He,at,Be)};vs({event:ye,handleId:_e,nodeId:Qe,onConnect:He=>R?.(at,He),isTarget:Tt,getState:ue.getState,setState:ue.setState,isValidConnection:$t,edgeUpdaterType:Be,onReconnectEnd:At})},Ke=ye=>Se(ye,!0),Oe=ye=>Se(ye,!1),Ee=()=>ae(!0),Re=()=>ae(!1),Ge=!I&&!i,it=ye=>{if(!Q&&cs.includes(ye.key)&&I){const{unselectNodesAndEdges:Me,addSelectedEdges:Fe,edges:$e}=ue.getState();ye.key==="Escape"?(ne.current?.blur(),Me({edges:[$e.find(_e=>_e.id===n)]})):Fe([n])}};return C.createElement("g",{className:ve(["react-flow__edge",`react-flow__edge-${o}`,r,{selected:c,animated:u,inactive:Ge,updating:he}]),onClick:W,onDoubleClick:we,onContextMenu:fe,onMouseEnter:xe,onMouseMove:Ze,onMouseLeave:qe,onKeyDown:G?it:void 0,tabIndex:G?0:void 0,role:G?"button":"img","data-testid":`rf__edge-${n}`,"aria-label":Y===null?void 0:Y||`Edge from ${m} to ${S}`,"aria-describedby":G?`${Ts}-${X}`:void 0,ref:ne},!pe&&C.createElement(e,{id:n,source:m,target:S,selected:c,animated:u,label:l,labelStyle:d,labelShowBg:p,labelBgStyle:f,labelBgPadding:b,labelBgBorderRadius:y,data:s,style:v,sourceX:M,sourceY:w,targetX:T,targetY:$,sourcePosition:z,targetPosition:H,sourceHandleId:F,targetHandleId:B,markerStart:Ne,markerEnd:te,pathOptions:ee,interactionWidth:oe}),re&&C.createElement(C.Fragment,null,(re==="source"||re===!0)&&C.createElement(vo,{position:z,centerX:M,centerY:w,radius:A,onMouseDown:Ke,onMouseEnter:Ee,onMouseOut:Re,type:"source"}),(re==="target"||re===!0)&&C.createElement(vo,{position:H,centerX:T,centerY:$,radius:A,onMouseDown:Oe,onMouseEnter:Ee,onMouseOut:Re,type:"target"})))};return t.displayName="EdgeWrapper",x.memo(t)};function Fd(e){const t={default:bt(e.default||Zt),straight:bt(e.bezier||An),step:bt(e.step||Tn),smoothstep:bt(e.step||$n),simplebezier:bt(e.simplebezier||vr)},n={},r=Object.keys(e).filter(o=>!["default","bezier"].includes(o)).reduce((o,s)=>(o[s]=bt(e[s]||Zt),o),n);return{...t,...r}}function No(e,t,n=null){const r=(n?.x||0)+t.x,o=(n?.y||0)+t.y,s=n?.width||t.width,i=n?.height||t.height;switch(e){case K.Top:return{x:r+s/2,y:o};case K.Right:return{x:r+s,y:o+i/2};case K.Bottom:return{x:r+s/2,y:o+i};case K.Left:return{x:r,y:o+i/2}}}function ko(e,t){return e?e.length===1||!t?e[0]:t&&e.find(n=>n.id===t)||null:null}const Bd=(e,t,n,r,o,s)=>{const i=No(n,e,t),a=No(s,r,o);return{sourceX:i.x,sourceY:i.y,targetX:a.x,targetY:a.y}};function Vd({sourcePos:e,targetPos:t,sourceWidth:n,sourceHeight:r,targetWidth:o,targetHeight:s,width:i,height:a,transform:c}){const u={x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x+n,t.x+o),y2:Math.max(e.y+r,t.y+s)};u.x===u.x2&&(u.x2+=1),u.y===u.y2&&(u.y2+=1);const l=Wt({x:(0-c[0])/c[2],y:(0-c[1])/c[2],width:i/c[2],height:a/c[2]}),d=Math.max(0,Math.min(l.x2,u.x2)-Math.max(l.x,u.x)),p=Math.max(0,Math.min(l.y2,u.y2)-Math.max(l.y,u.y));return Math.ceil(d*p)>0}function So(e){const t=e?.[de]?.handleBounds||null,n=t&&e?.width&&e?.height&&typeof e?.positionAbsolute?.x<"u"&&typeof e?.positionAbsolute?.y<"u";return[{x:e?.positionAbsolute?.x||0,y:e?.positionAbsolute?.y||0,width:e?.width||0,height:e?.height||0},t,!!n]}const Xd=[{level:0,isMaxLevel:!0,edges:[]}];function Yd(e,t,n=!1){let r=-1;const o=e.reduce((i,a)=>{const c=Ae(a.zIndex);let u=c?a.zIndex:0;if(n){const l=t.get(a.target),d=t.get(a.source),p=a.selected||l?.selected||d?.selected,f=Math.max(d?.[de]?.z||0,l?.[de]?.z||0,1e3);u=(c?a.zIndex:0)+(p?f:0)}return i[u]?i[u].push(a):i[u]=[a],r=u>r?u:r,i},{}),s=Object.entries(o).map(([i,a])=>{const c=+i;return{edges:a,level:c,isMaxLevel:c===r}});return s.length===0?Xd:s}function Wd(e,t,n){const r=ce(x.useCallback(o=>e?o.edges.filter(s=>{const i=t.get(s.source),a=t.get(s.target);return i?.width&&i?.height&&a?.width&&a?.height&&Vd({sourcePos:i.positionAbsolute||{x:0,y:0},targetPos:a.positionAbsolute||{x:0,y:0},sourceWidth:i.width,sourceHeight:i.height,targetWidth:a.width,targetHeight:a.height,width:o.width,height:o.height,transform:o.transform})}):o.edges,[e,t]));return Yd(r,t,n)}const Ud=({color:e="none",strokeWidth:t=1})=>C.createElement("polyline",{style:{stroke:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),Zd=({color:e="none",strokeWidth:t=1})=>C.createElement("polyline",{style:{stroke:e,fill:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),Eo={[Ct.Arrow]:Ud,[Ct.ArrowClosed]:Zd};function qd(e){const t=ge();return x.useMemo(()=>Object.prototype.hasOwnProperty.call(Eo,e)?Eo[e]:(t.getState().onError?.("009",Ue.error009(e)),null),[e])}const Kd=({id:e,type:t,color:n,width:r=12.5,height:o=12.5,markerUnits:s="strokeWidth",strokeWidth:i,orient:a="auto-start-reverse"})=>{const c=qd(t);return c?C.createElement("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${r}`,markerHeight:`${o}`,viewBox:"-10 -10 20 20",markerUnits:s,orient:a,refX:"0",refY:"0"},C.createElement(c,{color:n,strokeWidth:i})):null},Gd=({defaultColor:e,rfId:t})=>n=>{const r=[];return n.edges.reduce((o,s)=>([s.markerStart,s.markerEnd].forEach(i=>{if(i&&typeof i=="object"){const a=lr(i,t);r.includes(a)||(o.push({id:a,color:i.color||e,...i}),r.push(a))}}),o),[]).sort((o,s)=>o.id.localeCompare(s.id))},Vs=({defaultColor:e,rfId:t})=>{const n=ce(x.useCallback(Gd({defaultColor:e,rfId:t}),[e,t]),(r,o)=>!(r.length!==o.length||r.some((s,i)=>s.id!==o[i].id)));return C.createElement("defs",null,n.map(r=>C.createElement(Kd,{id:r.id,key:r.id,type:r.type,color:r.color,width:r.width,height:r.height,markerUnits:r.markerUnits,strokeWidth:r.strokeWidth,orient:r.orient})))};Vs.displayName="MarkerDefinitions";var Qd=x.memo(Vs);const Jd=e=>({nodesConnectable:e.nodesConnectable,edgesFocusable:e.edgesFocusable,edgesUpdatable:e.edgesUpdatable,elementsSelectable:e.elementsSelectable,width:e.width,height:e.height,connectionMode:e.connectionMode,nodeInternals:e.nodeInternals,onError:e.onError}),Xs=({defaultMarkerColor:e,onlyRenderVisibleElements:t,elevateEdgesOnSelect:n,rfId:r,edgeTypes:o,noPanClassName:s,onEdgeContextMenu:i,onEdgeMouseEnter:a,onEdgeMouseMove:c,onEdgeMouseLeave:u,onEdgeClick:l,onEdgeDoubleClick:d,onReconnect:p,onReconnectStart:f,onReconnectEnd:b,reconnectRadius:y,children:v,disableKeyboardA11y:m})=>{const{edgesFocusable:S,edgesUpdatable:M,elementsSelectable:w,width:T,height:$,connectionMode:z,nodeInternals:H,onError:I}=ce(Jd,be),P=Wd(t,H,n);return T?C.createElement(C.Fragment,null,P.map(({level:F,edges:B,isMaxLevel:L})=>C.createElement("svg",{key:F,style:{zIndex:F},width:T,height:$,className:"react-flow__edges react-flow__container"},L&&C.createElement(Qd,{defaultColor:e,rfId:r}),C.createElement("g",null,B.map(h=>{const[_,N,A]=So(H.get(h.source)),[R,k,D]=So(H.get(h.target));if(!A||!D)return null;let j=h.type||"default";o[j]||(I?.("011",Ue.error011(j)),j="default");const O=o[j]||o.default,X=z===pt.Strict?k.target:(k.target??[]).concat(k.source??[]),Y=ko(N.source,h.sourceHandle),G=ko(X,h.targetHandle),re=Y?.position||K.Bottom,ee=G?.position||K.Top,oe=!!(h.focusable||S&&typeof h.focusable>"u"),Q=h.reconnectable||h.updatable,ne=typeof p<"u"&&(Q||M&&typeof Q>"u");if(!Y||!G)return I?.("008",Ue.error008(Y,h)),null;const{sourceX:he,sourceY:ae,targetX:pe,targetY:me}=Bd(_,Y,re,R,G,ee);return C.createElement(O,{key:h.id,id:h.id,className:ve([h.className,s]),type:j,data:h.data,selected:!!h.selected,animated:!!h.animated,hidden:!!h.hidden,label:h.label,labelStyle:h.labelStyle,labelShowBg:h.labelShowBg,labelBgStyle:h.labelBgStyle,labelBgPadding:h.labelBgPadding,labelBgBorderRadius:h.labelBgBorderRadius,style:h.style,source:h.source,target:h.target,sourceHandleId:h.sourceHandle,targetHandleId:h.targetHandle,markerEnd:h.markerEnd,markerStart:h.markerStart,sourceX:he,sourceY:ae,targetX:pe,targetY:me,sourcePosition:re,targetPosition:ee,elementsSelectable:w,onContextMenu:i,onMouseEnter:a,onMouseMove:c,onMouseLeave:u,onClick:l,onEdgeDoubleClick:d,onReconnect:p,onReconnectStart:f,onReconnectEnd:b,reconnectRadius:y,rfId:r,ariaLabel:h.ariaLabel,isFocusable:oe,isReconnectable:ne,pathOptions:"pathOptions"in h?h.pathOptions:void 0,interactionWidth:h.interactionWidth,disableKeyboardA11y:m})})))),v):null};Xs.displayName="EdgeRenderer";var ef=x.memo(Xs);const tf=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function nf({children:e}){const t=ce(tf);return C.createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:t}},e)}function rf(e){const t=Er(),n=x.useRef(!1);x.useEffect(()=>{!n.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),n.current=!0)},[e,t.viewportInitialized])}const of={[K.Left]:K.Right,[K.Right]:K.Left,[K.Top]:K.Bottom,[K.Bottom]:K.Top},Ys=({nodeId:e,handleType:t,style:n,type:r=ot.Bezier,CustomComponent:o,connectionStatus:s})=>{const{fromNode:i,handleId:a,toX:c,toY:u,connectionMode:l}=ce(x.useCallback($=>({fromNode:$.nodeInternals.get(e),handleId:$.connectionHandleId,toX:($.connectionPosition.x-$.transform[0])/$.transform[2],toY:($.connectionPosition.y-$.transform[1])/$.transform[2],connectionMode:$.connectionMode}),[e]),be),d=i?.[de]?.handleBounds;let p=d?.[t];if(l===pt.Loose&&(p=p||d?.[t==="source"?"target":"source"]),!i||!p)return null;const f=a?p.find($=>$.id===a):p[0],b=f?f.x+f.width/2:(i.width??0)/2,y=f?f.y+f.height/2:i.height??0,v=(i.positionAbsolute?.x??0)+b,m=(i.positionAbsolute?.y??0)+y,S=f?.position,M=S?of[S]:null;if(!S||!M)return null;if(o)return C.createElement(o,{connectionLineType:r,connectionLineStyle:n,fromNode:i,fromHandle:f,fromX:v,fromY:m,toX:c,toY:u,fromPosition:S,toPosition:M,connectionStatus:s});let w="";const T={sourceX:v,sourceY:m,sourcePosition:S,targetX:c,targetY:u,targetPosition:M};return r===ot.Bezier?[w]=ps(T):r===ot.Step?[w]=ar({...T,borderRadius:0}):r===ot.SmoothStep?[w]=ar(T):r===ot.SimpleBezier?[w]=hs(T):w=`M${v},${m} ${c},${u}`,C.createElement("path",{d:w,fill:"none",className:"react-flow__connection-path",style:n})};Ys.displayName="ConnectionLine";const sf=e=>({nodeId:e.connectionNodeId,handleType:e.connectionHandleType,nodesConnectable:e.nodesConnectable,connectionStatus:e.connectionStatus,width:e.width,height:e.height});function af({containerStyle:e,style:t,type:n,component:r}){const{nodeId:o,handleType:s,nodesConnectable:i,width:a,height:c,connectionStatus:u}=ce(sf,be);return!(o&&s&&a&&i)?null:C.createElement("svg",{style:e,width:a,height:c,className:"react-flow__edges react-flow__connectionline react-flow__container"},C.createElement("g",{className:ve(["react-flow__connection",u])},C.createElement(Ys,{nodeId:o,handleType:s,style:t,type:n,CustomComponent:r,connectionStatus:u})))}function _o(e,t){return x.useRef(null),ge(),x.useMemo(()=>t(e),[e])}const Ws=({nodeTypes:e,edgeTypes:t,onMove:n,onMoveStart:r,onMoveEnd:o,onInit:s,onNodeClick:i,onEdgeClick:a,onNodeDoubleClick:c,onEdgeDoubleClick:u,onNodeMouseEnter:l,onNodeMouseMove:d,onNodeMouseLeave:p,onNodeContextMenu:f,onSelectionContextMenu:b,onSelectionStart:y,onSelectionEnd:v,connectionLineType:m,connectionLineStyle:S,connectionLineComponent:M,connectionLineContainerStyle:w,selectionKeyCode:T,selectionOnDrag:$,selectionMode:z,multiSelectionKeyCode:H,panActivationKeyCode:I,zoomActivationKeyCode:P,deleteKeyCode:F,onlyRenderVisibleElements:B,elementsSelectable:L,selectNodesOnDrag:h,defaultViewport:_,translateExtent:N,minZoom:A,maxZoom:R,preventScrolling:k,defaultMarkerColor:D,zoomOnScroll:j,zoomOnPinch:O,panOnScroll:X,panOnScrollSpeed:Y,panOnScrollMode:G,zoomOnDoubleClick:re,panOnDrag:ee,onPaneClick:oe,onPaneMouseEnter:Q,onPaneMouseMove:ne,onPaneMouseLeave:he,onPaneScroll:ae,onPaneContextMenu:pe,onEdgeContextMenu:me,onEdgeMouseEnter:ue,onEdgeMouseMove:Ne,onEdgeMouseLeave:te,onReconnect:W,onReconnectStart:we,onReconnectEnd:fe,reconnectRadius:xe,noDragClassName:Ze,noWheelClassName:qe,noPanClassName:Se,elevateEdgesOnSelect:Ke,disableKeyboardA11y:Oe,nodeOrigin:Ee,nodeExtent:Re,rfId:Ge})=>{const it=_o(e,jd),ye=_o(t,Fd);return rf(s),C.createElement(Id,{onPaneClick:oe,onPaneMouseEnter:Q,onPaneMouseMove:ne,onPaneMouseLeave:he,onPaneContextMenu:pe,onPaneScroll:ae,deleteKeyCode:F,selectionKeyCode:T,selectionOnDrag:$,selectionMode:z,onSelectionStart:y,onSelectionEnd:v,multiSelectionKeyCode:H,panActivationKeyCode:I,zoomActivationKeyCode:P,elementsSelectable:L,onMove:n,onMoveStart:r,onMoveEnd:o,zoomOnScroll:j,zoomOnPinch:O,zoomOnDoubleClick:re,panOnScroll:X,panOnScrollSpeed:Y,panOnScrollMode:G,panOnDrag:ee,defaultViewport:_,translateExtent:N,minZoom:A,maxZoom:R,onSelectionContextMenu:b,preventScrolling:k,noDragClassName:Ze,noWheelClassName:qe,noPanClassName:Se,disableKeyboardA11y:Oe},C.createElement(nf,null,C.createElement(ef,{edgeTypes:ye,onEdgeClick:a,onEdgeDoubleClick:u,onlyRenderVisibleElements:B,onEdgeContextMenu:me,onEdgeMouseEnter:ue,onEdgeMouseMove:Ne,onEdgeMouseLeave:te,onReconnect:W,onReconnectStart:we,onReconnectEnd:fe,reconnectRadius:xe,defaultMarkerColor:D,noPanClassName:Se,elevateEdgesOnSelect:!!Ke,disableKeyboardA11y:Oe,rfId:Ge},C.createElement(af,{style:S,type:m,component:M,containerStyle:w})),C.createElement("div",{className:"react-flow__edgelabel-renderer"}),C.createElement(Hd,{nodeTypes:it,onNodeClick:i,onNodeDoubleClick:c,onNodeMouseEnter:l,onNodeMouseMove:d,onNodeMouseLeave:p,onNodeContextMenu:f,selectNodesOnDrag:h,onlyRenderVisibleElements:B,noPanClassName:Se,noDragClassName:Ze,disableKeyboardA11y:Oe,nodeOrigin:Ee,nodeExtent:Re,rfId:Ge})))};Ws.displayName="GraphView";var lf=x.memo(Ws);const fr=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],tt={rfId:"1",width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:fr,nodeExtent:fr,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionStatus:null,connectionMode:pt.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:[0,0],nodeDragThreshold:0,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesUpdatable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,onSelectionChange:[],multiSelectionActive:!1,connectionStartHandle:null,connectionEndHandle:null,connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,connectionRadius:20,onError:zu,isValidConnection:void 0},cf=()=>Ki((e,t)=>({...tt,setNodes:n=>{const{nodeInternals:r,nodeOrigin:o,elevateNodesOnSelect:s}=t();e({nodeInternals:Wn(n,r,o,s)})},getNodes:()=>Array.from(t().nodeInternals.values()),setEdges:n=>{const{defaultEdgeOptions:r={}}=t();e({edges:n.map(o=>({...r,...o}))})},setDefaultNodesAndEdges:(n,r)=>{const o=typeof n<"u",s=typeof r<"u",i=o?Wn(n,new Map,t().nodeOrigin,t().elevateNodesOnSelect):new Map;e({nodeInternals:i,edges:s?r:[],hasDefaultNodes:o,hasDefaultEdges:s})},updateNodeDimensions:n=>{const{onNodesChange:r,nodeInternals:o,fitViewOnInit:s,fitViewOnInitDone:i,fitViewOnInitOptions:a,domNode:c,nodeOrigin:u}=t(),l=c?.querySelector(".react-flow__viewport");if(!l)return;const d=window.getComputedStyle(l),{m22:p}=new window.DOMMatrixReadOnly(d.transform),f=n.reduce((y,v)=>{const m=o.get(v.id);if(m?.hidden)o.set(m.id,{...m,[de]:{...m[de],handleBounds:void 0}});else if(m){const S=br(v.nodeElement);!!(S.width&&S.height&&(m.width!==S.width||m.height!==S.height||v.forceUpdate))&&(o.set(m.id,{...m,[de]:{...m[de],handleBounds:{source:bo(".source",v.nodeElement,p,u),target:bo(".target",v.nodeElement,p,u)}},...S}),y.push({id:m.id,type:"dimensions",dimensions:S}))}return y},[]);Is(o,u);const b=i||s&&!i&&Ds(t,{initial:!0,...a});e({nodeInternals:new Map(o),fitViewOnInitDone:b}),f?.length>0&&r?.(f)},updateNodePositions:(n,r=!0,o=!1)=>{const{triggerNodeChanges:s}=t(),i=n.map(a=>{const c={id:a.id,type:"position",dragging:o};return r&&(c.positionAbsolute=a.positionAbsolute,c.position=a.position),c});s(i)},triggerNodeChanges:n=>{const{onNodesChange:r,nodeInternals:o,hasDefaultNodes:s,nodeOrigin:i,getNodes:a,elevateNodesOnSelect:c}=t();if(n?.length){if(s){const u=zs(n,a()),l=Wn(u,o,i,c);e({nodeInternals:l})}r?.(n)}},addSelectedNodes:n=>{const{multiSelectionActive:r,edges:o,getNodes:s}=t();let i,a=null;r?i=n.map(c=>rt(c,!0)):(i=wt(s(),n),a=wt(o,[])),dn({changedNodes:i,changedEdges:a,get:t,set:e})},addSelectedEdges:n=>{const{multiSelectionActive:r,edges:o,getNodes:s}=t();let i,a=null;r?i=n.map(c=>rt(c,!0)):(i=wt(o,n),a=wt(s(),[])),dn({changedNodes:a,changedEdges:i,get:t,set:e})},unselectNodesAndEdges:({nodes:n,edges:r}={})=>{const{edges:o,getNodes:s}=t(),i=n||s(),a=r||o,c=i.map(l=>(l.selected=!1,rt(l.id,!1))),u=a.map(l=>rt(l.id,!1));dn({changedNodes:c,changedEdges:u,get:t,set:e})},setMinZoom:n=>{const{d3Zoom:r,maxZoom:o}=t();r?.scaleExtent([n,o]),e({minZoom:n})},setMaxZoom:n=>{const{d3Zoom:r,minZoom:o}=t();r?.scaleExtent([o,n]),e({maxZoom:n})},setTranslateExtent:n=>{t().d3Zoom?.translateExtent(n),e({translateExtent:n})},resetSelectedElements:()=>{const{edges:n,getNodes:r}=t(),s=r().filter(a=>a.selected).map(a=>rt(a.id,!1)),i=n.filter(a=>a.selected).map(a=>rt(a.id,!1));dn({changedNodes:s,changedEdges:i,get:t,set:e})},setNodeExtent:n=>{const{nodeInternals:r}=t();r.forEach(o=>{o.positionAbsolute=wr(o.position,n)}),e({nodeExtent:n,nodeInternals:new Map(r)})},panBy:n=>{const{transform:r,width:o,height:s,d3Zoom:i,d3Selection:a,translateExtent:c}=t();if(!i||!a||!n.x&&!n.y)return!1;const u=Ye.translate(r[0]+n.x,r[1]+n.y).scale(r[2]),l=[[0,0],[o,s]],d=i?.constrain()(u,l,c);return i.transform(a,d),r[0]!==d.x||r[1]!==d.y||r[2]!==d.k},cancelConnection:()=>e({connectionNodeId:tt.connectionNodeId,connectionHandleId:tt.connectionHandleId,connectionHandleType:tt.connectionHandleType,connectionStatus:tt.connectionStatus,connectionStartHandle:tt.connectionStartHandle,connectionEndHandle:tt.connectionEndHandle}),reset:()=>e({...tt})}),Object.is),Us=({children:e})=>{const t=x.useRef(null);return t.current||(t.current=cf()),C.createElement(Mu,{value:t.current},e)};Us.displayName="ReactFlowProvider";const Zs=({children:e})=>x.useContext(Mn)?C.createElement(C.Fragment,null,e):C.createElement(Us,null,e);Zs.displayName="ReactFlowWrapper";const uf={input:Es,default:ur,output:Cs,group:Sr},df={default:Zt,straight:An,step:Tn,smoothstep:$n,simplebezier:vr},ff=[0,0],hf=[15,15],pf={x:0,y:0,zoom:1},gf={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0},qs=x.forwardRef(({nodes:e,edges:t,defaultNodes:n,defaultEdges:r,className:o,nodeTypes:s=uf,edgeTypes:i=df,onNodeClick:a,onEdgeClick:c,onInit:u,onMove:l,onMoveStart:d,onMoveEnd:p,onConnect:f,onConnectStart:b,onConnectEnd:y,onClickConnectStart:v,onClickConnectEnd:m,onNodeMouseEnter:S,onNodeMouseMove:M,onNodeMouseLeave:w,onNodeContextMenu:T,onNodeDoubleClick:$,onNodeDragStart:z,onNodeDrag:H,onNodeDragStop:I,onNodesDelete:P,onEdgesDelete:F,onSelectionChange:B,onSelectionDragStart:L,onSelectionDrag:h,onSelectionDragStop:_,onSelectionContextMenu:N,onSelectionStart:A,onSelectionEnd:R,connectionMode:k=pt.Strict,connectionLineType:D=ot.Bezier,connectionLineStyle:j,connectionLineComponent:O,connectionLineContainerStyle:X,deleteKeyCode:Y="Backspace",selectionKeyCode:G="Shift",selectionOnDrag:re=!1,selectionMode:ee=Ut.Full,panActivationKeyCode:oe="Space",multiSelectionKeyCode:Q=kn()?"Meta":"Control",zoomActivationKeyCode:ne=kn()?"Meta":"Control",snapToGrid:he=!1,snapGrid:ae=hf,onlyRenderVisibleElements:pe=!1,selectNodesOnDrag:me=!0,nodesDraggable:ue,nodesConnectable:Ne,nodesFocusable:te,nodeOrigin:W=ff,edgesFocusable:we,edgesUpdatable:fe,elementsSelectable:xe,defaultViewport:Ze=pf,minZoom:qe=.5,maxZoom:Se=2,translateExtent:Ke=fr,preventScrolling:Oe=!0,nodeExtent:Ee,defaultMarkerColor:Re="#b1b1b7",zoomOnScroll:Ge=!0,zoomOnPinch:it=!0,panOnScroll:ye=!1,panOnScrollSpeed:Me=.5,panOnScrollMode:Fe=ut.Free,zoomOnDoubleClick:$e=!0,panOnDrag:Qe=!0,onPaneClick:_e,onPaneMouseEnter:Be,onPaneMouseMove:$t,onPaneMouseLeave:Tt,onPaneScroll:at,onPaneContextMenu:At,children:Jt,onEdgeContextMenu:He,onEdgeDoubleClick:en,onEdgeMouseEnter:Je,onEdgeMouseMove:Dn,onEdgeMouseLeave:jn,onEdgeUpdate:zn,onEdgeUpdateStart:gt,onEdgeUpdateEnd:E,onReconnect:V,onReconnectStart:Z,onReconnectEnd:U,reconnectRadius:q=10,edgeUpdaterRadius:J=10,onNodesChange:le,onEdgesChange:ie,noDragClassName:et="nodrag",noWheelClassName:tn="nowheel",noPanClassName:Cr="nopan",fitView:ti=!1,fitViewOptions:ni,connectOnClick:ri=!0,attributionPosition:oi,proOptions:si,defaultEdgeOptions:ii,elevateNodesOnSelect:ai=!0,elevateEdgesOnSelect:li=!1,disableKeyboardA11y:Mr=!1,autoPanOnConnect:ci=!0,autoPanOnNodeDrag:ui=!0,connectionRadius:di=20,isValidConnection:fi,onError:hi,style:pi,id:$r,nodeDragThreshold:gi,...mi},xi)=>{const Rn=$r||"1";return C.createElement("div",{...mi,style:{...pi,...gf},ref:xi,className:ve(["react-flow",o]),"data-testid":"rf__wrapper",id:$r},C.createElement(Zs,null,C.createElement(lf,{onInit:u,onMove:l,onMoveStart:d,onMoveEnd:p,onNodeClick:a,onEdgeClick:c,onNodeMouseEnter:S,onNodeMouseMove:M,onNodeMouseLeave:w,onNodeContextMenu:T,onNodeDoubleClick:$,nodeTypes:s,edgeTypes:i,connectionLineType:D,connectionLineStyle:j,connectionLineComponent:O,connectionLineContainerStyle:X,selectionKeyCode:G,selectionOnDrag:re,selectionMode:ee,deleteKeyCode:Y,multiSelectionKeyCode:Q,panActivationKeyCode:oe,zoomActivationKeyCode:ne,onlyRenderVisibleElements:pe,selectNodesOnDrag:me,defaultViewport:Ze,translateExtent:Ke,minZoom:qe,maxZoom:Se,preventScrolling:Oe,zoomOnScroll:Ge,zoomOnPinch:it,zoomOnDoubleClick:$e,panOnScroll:ye,panOnScrollSpeed:Me,panOnScrollMode:Fe,panOnDrag:Qe,onPaneClick:_e,onPaneMouseEnter:Be,onPaneMouseMove:$t,onPaneMouseLeave:Tt,onPaneScroll:at,onPaneContextMenu:At,onSelectionContextMenu:N,onSelectionStart:A,onSelectionEnd:R,onEdgeContextMenu:He,onEdgeDoubleClick:en,onEdgeMouseEnter:Je,onEdgeMouseMove:Dn,onEdgeMouseLeave:jn,onReconnect:V??zn,onReconnectStart:Z??gt,onReconnectEnd:U??E,reconnectRadius:q??J,defaultMarkerColor:Re,noDragClassName:et,noWheelClassName:tn,noPanClassName:Cr,elevateEdgesOnSelect:li,rfId:Rn,disableKeyboardA11y:Mr,nodeOrigin:W,nodeExtent:Ee}),C.createElement(od,{nodes:e,edges:t,defaultNodes:n,defaultEdges:r,onConnect:f,onConnectStart:b,onConnectEnd:y,onClickConnectStart:v,onClickConnectEnd:m,nodesDraggable:ue,nodesConnectable:Ne,nodesFocusable:te,edgesFocusable:we,edgesUpdatable:fe,elementsSelectable:xe,elevateNodesOnSelect:ai,minZoom:qe,maxZoom:Se,nodeExtent:Ee,onNodesChange:le,onEdgesChange:ie,snapToGrid:he,snapGrid:ae,connectionMode:k,translateExtent:Ke,connectOnClick:ri,defaultEdgeOptions:ii,fitView:ti,fitViewOptions:ni,onNodesDelete:P,onEdgesDelete:F,onNodeDragStart:z,onNodeDrag:H,onNodeDragStop:I,onSelectionDrag:h,onSelectionDragStart:L,onSelectionDragStop:_,noPanClassName:Cr,nodeOrigin:W,rfId:Rn,autoPanOnConnect:ci,autoPanOnNodeDrag:ui,onError:hi,connectionRadius:di,isValidConnection:fi,nodeDragThreshold:gi}),C.createElement(nd,{onSelectionChange:B}),Jt,C.createElement(Tu,{proOptions:si,position:oi}),C.createElement(cd,{rfId:Rn,disableKeyboardA11y:Mr})))});qs.displayName="ReactFlow";function Ks(e){return t=>{const[n,r]=x.useState(t),o=x.useCallback(s=>r(i=>e(s,i)),[]);return[n,r,o]}}const mf=Ks(zs),xf=Ks(kd),Gs=({id:e,x:t,y:n,width:r,height:o,style:s,color:i,strokeColor:a,strokeWidth:c,className:u,borderRadius:l,shapeRendering:d,onClick:p,selected:f})=>{const{background:b,backgroundColor:y}=s||{},v=i||b||y;return C.createElement("rect",{className:ve(["react-flow__minimap-node",{selected:f},u]),x:t,y:n,rx:l,ry:l,width:r,height:o,fill:v,stroke:a,strokeWidth:c,shapeRendering:d,onClick:p?m=>p(m,e):void 0})};Gs.displayName="MiniMapNode";var yf=x.memo(Gs);const bf=e=>e.nodeOrigin,wf=e=>e.getNodes().filter(t=>!t.hidden&&t.width&&t.height),Kn=e=>e instanceof Function?e:()=>e;function vf({nodeStrokeColor:e="transparent",nodeColor:t="#e2e2e2",nodeClassName:n="",nodeBorderRadius:r=5,nodeStrokeWidth:o=2,nodeComponent:s=yf,onClick:i}){const a=ce(wf,be),c=ce(bf),u=Kn(t),l=Kn(e),d=Kn(n),p=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return C.createElement(C.Fragment,null,a.map(f=>{const{x:b,y}=ft(f,c).positionAbsolute;return C.createElement(s,{key:f.id,x:b,y,width:f.width,height:f.height,style:f.style,selected:f.selected,className:d(f),color:u(f),borderRadius:r,strokeColor:l(f),strokeWidth:o,shapeRendering:p,onClick:i,id:f.id})}))}var Nf=x.memo(vf);const kf=200,Sf=150,Ef=e=>{const t=e.getNodes(),n={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:n,boundingRect:t.length>0?Du(In(t,e.nodeOrigin),n):n,rfId:e.rfId}},_f="react-flow__minimap-desc";function Qs({style:e,className:t,nodeStrokeColor:n="transparent",nodeColor:r="#e2e2e2",nodeClassName:o="",nodeBorderRadius:s=5,nodeStrokeWidth:i=2,nodeComponent:a,maskColor:c="rgb(240, 240, 240, 0.6)",maskStrokeColor:u="none",maskStrokeWidth:l=1,position:d="bottom-right",onClick:p,onNodeClick:f,pannable:b=!1,zoomable:y=!1,ariaLabel:v="React Flow mini map",inversePan:m=!1,zoomStep:S=10,offsetScale:M=5}){const w=ge(),T=x.useRef(null),{boundingRect:$,viewBB:z,rfId:H}=ce(Ef,be),I=e?.width??kf,P=e?.height??Sf,F=$.width/I,B=$.height/P,L=Math.max(F,B),h=L*I,_=L*P,N=M*L,A=$.x-(h-$.width)/2-N,R=$.y-(_-$.height)/2-N,k=h+N*2,D=_+N*2,j=`${_f}-${H}`,O=x.useRef(0);O.current=L,x.useEffect(()=>{if(T.current){const G=Te(T.current),re=Q=>{const{transform:ne,d3Selection:he,d3Zoom:ae}=w.getState();if(Q.sourceEvent.type!=="wheel"||!he||!ae)return;const pe=-Q.sourceEvent.deltaY*(Q.sourceEvent.deltaMode===1?.05:Q.sourceEvent.deltaMode?1:.002)*S,me=ne[2]*Math.pow(2,pe);ae.scaleTo(he,me)},ee=Q=>{const{transform:ne,d3Selection:he,d3Zoom:ae,translateExtent:pe,width:me,height:ue}=w.getState();if(Q.sourceEvent.type!=="mousemove"||!he||!ae)return;const Ne=O.current*Math.max(1,ne[2])*(m?-1:1),te={x:ne[0]-Q.sourceEvent.movementX*Ne,y:ne[1]-Q.sourceEvent.movementY*Ne},W=[[0,0],[me,ue]],we=Ye.translate(te.x,te.y).scale(ne[2]),fe=ae.constrain()(we,W,pe);ae.transform(he,fe)},oe=rs().on("zoom",b?ee:null).on("zoom.wheel",y?re:null);return G.call(oe),()=>{G.on("zoom",null)}}},[b,y,m,S]);const X=p?G=>{const re=Ie(G);p(G,{x:re[0],y:re[1]})}:void 0,Y=f?(G,re)=>{const ee=w.getState().nodeInternals.get(re);f(G,ee)}:void 0;return C.createElement(Yt,{position:d,style:e,className:ve(["react-flow__minimap",t]),"data-testid":"rf__minimap"},C.createElement("svg",{width:I,height:P,viewBox:`${A} ${R} ${k} ${D}`,role:"img","aria-labelledby":j,ref:T,onClick:X},v&&C.createElement("title",{id:j},v),C.createElement(Nf,{onClick:Y,nodeColor:r,nodeStrokeColor:n,nodeBorderRadius:s,nodeClassName:o,nodeStrokeWidth:i,nodeComponent:a}),C.createElement("path",{className:"react-flow__minimap-mask",d:`M${A-N},${R-N}h${k+N*2}v${D+N*2}h${-k-N*2}z
        M${z.x},${z.y}h${z.width}v${z.height}h${-z.width}z`,fill:c,fillRule:"evenodd",stroke:u,strokeWidth:l,pointerEvents:"none"})))}Qs.displayName="MiniMap";var Cf=x.memo(Qs);function Mf(){return C.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},C.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function $f(){return C.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},C.createElement("path",{d:"M0 0h32v4.2H0z"}))}function Tf(){return C.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},C.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function Af(){return C.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},C.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function If(){return C.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},C.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}const Lt=({children:e,className:t,...n})=>C.createElement("button",{type:"button",className:ve(["react-flow__controls-button",t]),...n},e);Lt.displayName="ControlButton";const Df=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom}),Js=({style:e,showZoom:t=!0,showFitView:n=!0,showInteractive:r=!0,fitViewOptions:o,onZoomIn:s,onZoomOut:i,onFitView:a,onInteractiveChange:c,className:u,children:l,position:d="bottom-left"})=>{const p=ge(),[f,b]=x.useState(!1),{isInteractive:y,minZoomReached:v,maxZoomReached:m}=ce(Df,be),{zoomIn:S,zoomOut:M,fitView:w}=Er();if(x.useEffect(()=>{b(!0)},[]),!f)return null;const T=()=>{S(),s?.()},$=()=>{M(),i?.()},z=()=>{w(o),a?.()},H=()=>{p.setState({nodesDraggable:!y,nodesConnectable:!y,elementsSelectable:!y}),c?.(!y)};return C.createElement(Yt,{className:ve(["react-flow__controls",u]),position:d,style:e,"data-testid":"rf__controls"},t&&C.createElement(C.Fragment,null,C.createElement(Lt,{onClick:T,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:m},C.createElement(Mf,null)),C.createElement(Lt,{onClick:$,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:v},C.createElement($f,null))),n&&C.createElement(Lt,{className:"react-flow__controls-fitview",onClick:z,title:"fit view","aria-label":"fit view"},C.createElement(Tf,null)),r&&C.createElement(Lt,{className:"react-flow__controls-interactive",onClick:H,title:"toggle interactivity","aria-label":"toggle interactivity"},y?C.createElement(If,null):C.createElement(Af,null)),l)};Js.displayName="Controls";var jf=x.memo(Js),je;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(je||(je={}));function zf({color:e,dimensions:t,lineWidth:n}){return C.createElement("path",{stroke:e,strokeWidth:n,d:`M${t[0]/2} 0 V${t[1]} M0 ${t[1]/2} H${t[0]}`})}function Rf({color:e,radius:t}){return C.createElement("circle",{cx:t,cy:t,r:t,fill:e})}const Hf={[je.Dots]:"#91919a",[je.Lines]:"#eee",[je.Cross]:"#e2e2e2"},Pf={[je.Dots]:1,[je.Lines]:1,[je.Cross]:6},Lf=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function ei({id:e,variant:t=je.Dots,gap:n=20,size:r,lineWidth:o=1,offset:s=2,color:i,style:a,className:c}){const u=x.useRef(null),{transform:l,patternId:d}=ce(Lf,be),p=i||Hf[t],f=r||Pf[t],b=t===je.Dots,y=t===je.Cross,v=Array.isArray(n)?n:[n,n],m=[v[0]*l[2]||1,v[1]*l[2]||1],S=f*l[2],M=y?[S,S]:m,w=b?[S/s,S/s]:[M[0]/s,M[1]/s];return C.createElement("svg",{className:ve(["react-flow__background",c]),style:{...a,position:"absolute",width:"100%",height:"100%",top:0,left:0},ref:u,"data-testid":"rf__background"},C.createElement("pattern",{id:d+e,x:l[0]%m[0],y:l[1]%m[1],width:m[0],height:m[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${w[0]},-${w[1]})`},b?C.createElement(Rf,{color:p,radius:S/s}):C.createElement(zf,{dimensions:M,color:p,lineWidth:o})),C.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${d+e})`}))}ei.displayName="Background";var Of=x.memo(ei);const Co=x.memo(e=>{const{sourceX:t,sourceY:n,targetX:r,targetY:o,selected:s,style:i={},sourceHandleId:a,targetHandleId:c}=e,u=typeof t=="number"&&!isNaN(t)?t:0,l=typeof n=="number"&&!isNaN(n)?n:0,d=typeof r=="number"&&!isNaN(r)?r:0,p=typeof o=="number"&&!isNaN(o)?o:0,f=d-u,b=.3,y=u+f*b,v=l,m=d-f*b,M=`M ${u} ${l} C ${y} ${v}, ${m} ${p}, ${d} ${p}`,w=s?"#3b82f6":i.stroke||"#94a3b8",T=s?3.5:i.strokeWidth||2.5;return g.jsxs("g",{children:[s&&g.jsx("path",{d:M,stroke:w,strokeWidth:T+4,fill:"none",strokeLinecap:"round",opacity:.2,style:{filter:"blur(4px)"}}),g.jsx("path",{d:M,stroke:w,strokeWidth:T,fill:"none",strokeLinecap:"round",style:{opacity:s?1:.65,filter:s?"drop-shadow(0 0 6px rgba(59, 130, 246, 0.5))":"drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1))",transition:"all 0.3s ease",...i}}),s&&g.jsxs(g.Fragment,{children:[g.jsx("circle",{cx:u,cy:l,r:6,fill:w,stroke:"white",strokeWidth:2.5,style:{filter:"drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))"}}),g.jsx("circle",{cx:d,cy:p,r:6,fill:w,stroke:"white",strokeWidth:2.5,style:{filter:"drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))"}})]})]})}),Ff={cable:Co,default:Zt,straight:An,step:Tn,smooth:Co},Bf=(e,t)=>{if(!(t==="online"))return{bg:"bg-slate-300 dark:bg-slate-600",border:"border-slate-400 dark:border-slate-500",text:"text-slate-700 dark:text-slate-200",icon:"text-slate-500 dark:text-slate-400",statusDot:"bg-slate-500"};switch(e?.toLowerCase()){case"switches":return{bg:"bg-blue-50 dark:bg-blue-950/30",border:"border-blue-300 dark:border-blue-700",text:"text-blue-900 dark:text-blue-100",icon:"text-blue-600 dark:text-blue-400",statusDot:"bg-blue-500"};case"servers":return{bg:"bg-purple-50 dark:bg-purple-950/30",border:"border-purple-300 dark:border-purple-700",text:"text-purple-900 dark:text-purple-100",icon:"text-purple-600 dark:text-purple-400",statusDot:"bg-purple-500"};case"wifi":return{bg:"bg-pink-50 dark:bg-pink-950/30",border:"border-pink-300 dark:border-pink-700",text:"text-pink-900 dark:text-pink-100",icon:"text-pink-600 dark:text-pink-400",statusDot:"bg-pink-500"};case"cctv":return{bg:"bg-indigo-50 dark:bg-indigo-950/30",border:"border-indigo-300 dark:border-indigo-700",text:"text-indigo-900 dark:text-indigo-100",icon:"text-indigo-600 dark:text-indigo-400",statusDot:"bg-indigo-500"};case"tas":return{bg:"bg-teal-50 dark:bg-teal-950/30",border:"border-teal-300 dark:border-teal-700",text:"text-teal-900 dark:text-teal-100",icon:"text-teal-600 dark:text-teal-400",statusDot:"bg-teal-500"};default:return{bg:"bg-slate-50 dark:bg-slate-800",border:"border-slate-300 dark:border-slate-600",text:"text-slate-900 dark:text-slate-100",icon:"text-slate-600 dark:text-slate-400",statusDot:"bg-slate-500"}}},Vf=x.memo(({data:e,selected:t})=>{const n=Bf(e.category,e.status),r=Mo(e.category||""),o=e.status==="online";return g.jsxs("div",{className:"relative group",style:{pointerEvents:"auto"},children:[["top","bottom","left","right"].map(s=>g.jsx(Mt,{type:"source",position:K[s],id:s,className:"!bg-slate-600 !border-2 !border-white hover:!bg-blue-500 hover:!scale-110 transition-all duration-200",style:{width:"12px",height:"12px",borderRadius:"50%",cursor:"grab",zIndex:10}},`source-${s}`)),["top","bottom","left","right"].map(s=>g.jsx(Mt,{type:"target",position:K[s],id:s,className:"!bg-slate-600 !border-2 !border-white hover:!bg-blue-500 hover:!scale-110 transition-all duration-200",style:{width:"12px",height:"12px",borderRadius:"50%",cursor:"grab",zIndex:10}},`target-${s}`)),g.jsxs("div",{className:`
                    ${n.bg} ${n.border} border-2 rounded-lg shadow-lg hover:shadow-xl 
                    transition-all duration-300 px-3 py-2.5 min-w-[120px] max-w-[150px]
                    ${t?"ring-2 ring-blue-500/50 ring-offset-1 scale-105":"hover:scale-105"}
                    backdrop-blur-sm
                `,children:[g.jsx("div",{className:"absolute -top-1.5 -right-1.5 z-10",children:g.jsx("div",{className:`w-3 h-3 rounded-full ${n.statusDot} ${o?"animate-pulse":""} shadow-md border-2 border-white dark:border-slate-800`})}),g.jsx("div",{className:"flex items-center justify-center mb-2",children:g.jsx("div",{className:`p-2 rounded-lg bg-white/70 dark:bg-black/30 backdrop-blur-sm ${n.icon} shadow-sm`,children:g.jsx(r,{className:"w-5 h-5"})})}),g.jsx("div",{className:`${n.text} text-sm font-bold text-center mb-1.5 truncate leading-tight`,children:e.name}),g.jsx("div",{className:`${n.text} text-[10px] opacity-80 text-center font-mono truncate mb-1.5 px-1.5 py-0.5 bg-white/40 dark:bg-black/20 rounded`,children:e.ip_address}),g.jsx("div",{className:`mt-1.5 text-center ${n.text} text-[9px] font-bold uppercase tracking-wide opacity-70 px-1.5 py-0.5 rounded bg-white/30 dark:bg-black/20`,children:e.category||"Device"})]})]})}),Xf={device:Vf};function l0(){const{props:e}=wi(),{currentBranch:t,topologies:n}=e,[r,o]=x.useState(n||[]),[s,i]=x.useState(null),[a,c]=x.useState([]),[u,l]=x.useState(!1),[d,p]=x.useState(!1),[f,b]=x.useState(""),[y,v]=x.useState(!1),[m,S]=x.useState(!1),[M,w]=x.useState(!1),[T,$]=x.useState(null),[z,H]=x.useState(""),[I,P]=x.useState(""),[F,B]=x.useState(""),[L,h]=x.useState(""),[_,N]=x.useState(!1),[A,R]=x.useState(!1),[k,D]=x.useState(!1),[j,O]=x.useState(!1),[X,Y]=x.useState(null),[G,re]=x.useState(""),[ee,oe]=x.useState(new Set),[Q,ne]=x.useState(new Set),[he,ae]=x.useState(!1),[pe,me]=x.useState(""),[ue,Ne]=x.useState(""),[te,W,we]=mf([]),[fe,xe,Ze]=xf([]),qe=x.useRef(null),[Se,Ke]=x.useState(null);x.useEffect(()=>{Oe()},[t?.id]),x.useEffect(()=>{Ee()},[t?.id]),x.useEffect(()=>{s?Re(s.id):(W([]),xe([]))},[s?.id]),x.useEffect(()=>{const E=setTimeout(()=>{me(f)},300);return()=>clearTimeout(E)},[f]),x.useEffect(()=>{const E=setTimeout(()=>{Ne(G)},300);return()=>clearTimeout(E)},[G]);const Oe=x.useCallback(async()=>{if(t?.id){l(!0);try{const E=await fetch(`/api/devices?branch_id=${t.id}&per_page=100&page=1&include_inactive=true&active_filter=all`);if(!E.ok)throw new Error(`HTTP error! status: ${E.status}`);const V=await E.json();if(V.error)throw new Error(V.error);V.data&&Array.isArray(V.data)?c(V.data):c([])}catch(E){console.error("Failed to load devices:",E),c([])}finally{l(!1)}}},[t?.id]),Ee=async()=>{if(t?.id){p(!0);try{const V=await(await fetch(`/api/topologies?branch_id=${t.id}`)).json();V.success&&V.data?o(V.data||[]):Array.isArray(V)&&o(V)}catch(E){console.error("Failed to load topologies:",E)}finally{p(!1)}}},Re=async E=>{try{const Z=await(await fetch(`/api/topologies/${E}`)).json();if(Z.success&&Z.data){const U=Z.data;i({id:U.id,name:U.name,description:U.description||"",canvas_data:U.canvas_data||{nodes:[],edges:[]},device_count:U.devices?.length||0,created_at:U.created_at,updated_at:U.updated_at});const q=(U.devices||[]).map(ie=>({id:ie.node_id,type:"device",position:{x:ie.position_x,y:ie.position_y},data:{name:ie.name,ip_address:ie.ip_address,category:ie.category,status:ie.status,brand:ie.brand,model:ie.model,deviceId:ie.id}})),J=new Set(q.map(ie=>ie.id)),le=(U.canvas_data?.edges||[]).filter(ie=>{const et=J.has(ie.source),tn=J.has(ie.target);return!et||!tn?(console.warn("Edge filtered out - missing node:",{edgeId:ie.id,source:ie.source,target:ie.target,hasSource:et,hasTarget:tn,availableNodes:Array.from(J)}),!1):!0}).map(ie=>{const et={id:ie.id,source:ie.source,target:ie.target,type:ie.type||"cable",animated:ie.animated||!1,style:ie.style||{strokeWidth:2.5,stroke:"#94a3b8"}};return ie.sourceHandle&&(et.sourceHandle=ie.sourceHandle),ie.targetHandle&&(et.targetHandle=ie.targetHandle),et});W(q),xe(le)}}catch(V){console.error("Failed to load topology data:",V)}},Ge=x.useCallback(E=>{if(!s||E.source===E.target)return!1;const V={id:`edge-${E.source}-${E.target}-${E.sourceHandle||"default"}-${E.targetHandle||"default"}-${Date.now()}`,source:E.source,target:E.target,sourceHandle:E.sourceHandle||void 0,targetHandle:E.targetHandle||void 0,type:"cable",animated:!1,style:{strokeWidth:2.5,stroke:"#94a3b8"}};return fe.find(U=>U.source===E.source&&U.target===E.target&&U.sourceHandle===E.sourceHandle&&U.targetHandle===E.targetHandle)||(xe(U=>[...U,V]),W(U=>U.map(q=>q.id===E.source||q.id===E.target?{...q,style:{...q.style,border:"3px solid #10b981",borderColor:"#10b981",transition:"border-color 0.3s"}}:q)),setTimeout(()=>{W(U=>U.map(q=>({...q,style:{...q.style,border:void 0,borderColor:void 0}})))},500)),!0},[s,fe,xe,W]),it=x.useCallback(E=>{E.preventDefault(),E.dataTransfer.dropEffect="move"},[]),ye=x.useCallback(E=>{E&&(E.ctrlKey||E.metaKey)||(Y(null),(!E||!E.ctrlKey&&!E.metaKey)&&(oe(new Set),ne(new Set),ae(!1)))},[]),Me=x.useCallback(E=>{const V=new Set(E.nodes.map(U=>U.id)),Z=new Set(E.edges.map(U=>U.id));oe(V),ne(Z),ae(V.size>0||Z.size>0)},[]),Fe=x.useCallback(()=>{ee.size===0&&Q.size===0||confirm(`Delete ${ee.size} device(s) and ${Q.size} connection(s)?`)&&(ee.size>0&&W(E=>E.filter(V=>!ee.has(V.id))),Q.size>0&&xe(E=>E.filter(V=>!Q.has(V.id))),oe(new Set),ne(new Set),ae(!1))},[ee,Q,W,xe]),$e=x.useCallback(E=>{Q.size!==0&&xe(V=>V.map(Z=>Q.has(Z.id)?{...Z,type:E}:Z))},[Q,xe]),Qe=x.useCallback(()=>{const E=new Set(te.map(Z=>Z.id)),V=new Set(fe.map(Z=>Z.id));oe(E),ne(V),ae(E.size>0||V.size>0)},[te,fe]),_e=x.useCallback(()=>{oe(new Set),ne(new Set),ae(!1)},[]),Be=x.useCallback((E,V)=>{s&&(E.stopPropagation(),E.ctrlKey||E.metaKey?oe(Z=>{const U=new Set(Z);return U.has(V.id)?U.delete(V.id):U.add(V.id),ae(U.size>0||Q.size>0),U}):(oe(new Set),ne(new Set),ae(!1)))},[s,Q]),$t=x.useCallback((E,V)=>{E.stopPropagation(),E.ctrlKey||E.metaKey?ne(Z=>{const U=new Set(Z);return U.has(V.id)?U.delete(V.id):U.add(V.id),ae(U.size>0||ee.size>0),U}):(Y(V),oe(new Set),ne(new Set([V.id])),ae(!0))},[ee]),Tt=x.useCallback(E=>{if(E.preventDefault(),!s){alert("Please select a topology first");return}const V=E.dataTransfer.getData("application/reactflow");if(!V||!Se)return;const Z=a.find(le=>le.id===parseInt(V));if(!Z)return;const U=Se.screenToFlowPosition({x:E.clientX,y:E.clientY});if(te.some(le=>le.data.deviceId===Z.id)){alert(`Device "${Z.name}" is already in the canvas. Each device can only be added once.`);return}const J={id:`device-${Z.id}-${Date.now()}`,type:"device",position:U,data:{name:Z.name,ip_address:Z.ip_address,category:Z.category,status:Z.status,brand:Z.brand||"",model:Z.model||"",deviceId:Z.id}};W(le=>le.concat(J))},[Se,a,te,W,s]),at=async()=>{if(!(!z.trim()||!t?.id)){N(!0);try{const E={nodes:te.map(q=>({id:q.id,position:q.position,type:q.type,data:q.data})),edges:fe.map(q=>{const J={id:q.id,source:q.source,target:q.target,type:q.type||"cable",animated:q.animated||!1,style:q.style||{strokeWidth:4,stroke:"#6366f1"},markerEnd:q.markerEnd||{type:Ct.ArrowClosed,width:24,height:24,color:"#6366f1"}};return q.sourceHandle&&(J.sourceHandle=q.sourceHandle),q.targetHandle&&(J.targetHandle=q.targetHandle),J})},V=te.map(q=>({device_id:q.data.deviceId,node_id:q.id,position_x:q.position.x,position_y:q.position.y,node_data:q.data})),U=await(await fetch("/api/topologies",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({branch_id:t.id,name:z,description:I,canvas_data:E,devices:V})})).json();U.success?(v(!1),H(""),P(""),W([]),xe([]),Ee()):alert("Failed to create topology: "+(U.message||"Unknown error"))}catch(E){console.error("Failed to create topology:",E),alert("Failed to create topology")}finally{N(!1)}}},At=async()=>{if(!(!s||!t?.id)){N(!0);try{const E={nodes:te.map(J=>({id:J.id,position:J.position,type:J.type,data:J.data})),edges:fe.map(J=>{const le={id:J.id,source:J.source,target:J.target,type:J.type||"cable",animated:J.animated||!1,style:J.style||{strokeWidth:2.5,stroke:"#94a3b8"}};return J.sourceHandle&&(le.sourceHandle=J.sourceHandle),J.targetHandle&&(le.targetHandle=J.targetHandle),le})},V=te.filter(J=>J.data&&J.data.deviceId).map(J=>({device_id:J.data.deviceId,node_id:J.id,position_x:J.position.x,position_y:J.position.y,node_data:J.data})),Z={name:s.name,description:s.description||"",canvas_data:E};V.length>0&&(Z.devices=V);const U=await fetch(`/api/topologies/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify(Z)});if(!U.ok){const J=await U.text();throw console.error("HTTP Error:",U.status,J),new Error(`HTTP ${U.status}: ${J}`)}const q=await U.json();if(console.log("Update response:",q),q.success)Ee(),Re(s.id);else{let J=q.message||"Unknown error";if(q.errors){const le=Object.values(q.errors).flat().join(", ");J+=": "+le}q.error&&(J+=": "+q.error),console.error("Update failed:",q),alert("Failed to update topology: "+J)}}catch(E){console.error("Failed to update topology:",E),alert("Failed to update topology: "+(E instanceof Error?E.message:"Network error"))}finally{N(!1)}}},Jt=async()=>{if(T)try{const V=await(await fetch(`/api/topologies/${T.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}})).json();V.success?(w(!1),$(null),s?.id===T.id&&(i(null),W([]),xe([])),Ee()):alert("Failed to delete topology: "+(V.message||"Unknown error"))}catch(E){console.error("Failed to delete topology:",E),alert("Failed to delete topology")}},He=x.useMemo(()=>{if(!pe.trim())return r;const E=pe.toLowerCase();return r.filter(V=>V.name.toLowerCase().includes(E))},[r,pe]),en=x.useMemo(()=>{if(!a.length)return[];const E=new Set(te.map(Z=>Z.data?.deviceId||Z.data?.device_id)),V=ue.toLowerCase();return a.filter(Z=>E.has(Z.id)?!1:V?Z.name.toLowerCase().includes(V)||Z.ip_address.toLowerCase().includes(V):!0).slice(0,50)},[a,te,ue]),Je=E=>{if(te.length===0){alert("No nodes to arrange. Add devices to the canvas first.");return}const V=Oi(te,fe,E);W(V)},Dn=()=>{if(!s){alert("Please select a topology first");return}const E={name:s.name,description:s.description,nodes:te.map(q=>({id:q.id,type:q.type,position:q.position,data:q.data})),edges:fe.map(q=>({id:q.id,source:q.source,target:q.target,type:q.type,style:q.style})),exportedAt:new Date().toISOString()},V=new Blob([JSON.stringify(E,null,2)],{type:"application/json"}),Z=URL.createObjectURL(V),U=document.createElement("a");U.href=Z,U.download=`${s.name.replace(/[^a-z0-9]/gi,"_")}_topology_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(U),U.click(),document.body.removeChild(U),URL.revokeObjectURL(Z)},jn=async E=>{const V=E.target.files?.[0];if(V)try{const Z=await V.text(),U=JSON.parse(Z);if(!U.nodes||!Array.isArray(U.nodes))throw new Error("Invalid topology file format");const q=U.nodes.map(le=>({id:le.id,type:le.type||"device",position:le.position||{x:0,y:0},data:le.data||{}})),J=(U.edges||[]).map(le=>({id:le.id,source:le.source,target:le.target,type:le.type||"cable",style:le.style||{strokeWidth:4,stroke:"#22c55e"},markerEnd:{type:Ct.ArrowClosed,width:24,height:24,color:"#22c55e"}}));W(q),xe(J),alert(`Imported ${q.length} nodes and ${J.length} connections`)}catch(Z){console.error("Import error:",Z),alert("Failed to import topology: "+(Z instanceof Error?Z.message:"Invalid file format"))}finally{E.target.value=""}},zn=x.useMemo(()=>({type:"smooth",animated:!1,style:{strokeWidth:2.5,stroke:"#94a3b8"}}),[]),gt=(E,V)=>{xe(Z=>Z.map(U=>U.id===E?{...U,type:V==="default"?"default":V}:U)),Y(null)};return g.jsxs(vi,{title:"Topology",children:[g.jsxs("div",{className:"flex flex-col lg:flex-row h-[calc(100vh-4rem)] gap-3 p-3 bg-gradient-to-br from-slate-50 via-white to-slate-50 dark:from-slate-950 dark:via-slate-900 dark:to-slate-950",children:[g.jsxs("div",{className:`${A?"w-12":"w-full lg:w-64"} bg-white/80 dark:bg-slate-800/90 backdrop-blur-xl rounded-lg shadow-lg border border-slate-200/50 dark:border-slate-700/50 flex flex-col h-[300px] lg:h-auto transition-all duration-300 ease-out overflow-hidden`,children:[g.jsxs("div",{className:"p-3 border-b border-slate-200/60 dark:border-slate-700/60 bg-gradient-to-r from-slate-50/50 to-transparent dark:from-slate-800/50",children:[g.jsxs("div",{className:"flex items-center justify-between mb-2",children:[!A&&g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"p-1.5 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg shadow-md",children:g.jsx(Hn,{className:"w-4 h-4 text-white"})}),g.jsx("h2",{className:"text-base font-bold text-slate-900 dark:text-white",children:"Topologies"})]}),g.jsxs("div",{className:"flex items-center gap-1.5 ml-auto",children:[!A&&g.jsx("button",{onClick:()=>v(!0),className:"p-1.5 bg-gradient-to-br from-blue-500 to-blue-600 text-white hover:from-blue-600 hover:to-blue-700 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md hover:scale-105",title:"Create New Topology",children:g.jsx(Ei,{className:"w-4 h-4"})}),g.jsx("button",{onClick:()=>R(!A),className:"p-1.5 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700/50 rounded-lg transition-all duration-200",title:A?"Expand Panel":"Collapse Panel",children:A?g.jsx(Ci,{className:"w-4 h-4"}):g.jsx(Ni,{className:"w-4 h-4"})})]})]}),!A&&g.jsxs("div",{className:"relative",children:[g.jsx(Dr,{className:"absolute left-2.5 top-1/2 transform -translate-y-1/2 w-3.5 h-3.5 text-slate-400"}),g.jsx("input",{type:"text",placeholder:"Search topologies...",value:f,onChange:E=>b(E.target.value),className:"w-full pl-9 pr-3 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none focus:ring-1 focus:ring-blue-500/50 focus:border-blue-500 transition-all"})]})]}),!A&&g.jsx("div",{className:"flex-1 overflow-y-auto p-1.5",children:d?g.jsx("div",{className:"flex items-center justify-center py-6",children:g.jsx(Pn,{className:"w-4 h-4 animate-spin text-slate-400"})}):He.length===0?g.jsx("div",{className:"text-center py-6 text-xs text-slate-500 dark:text-slate-400",children:"No topologies found"}):He.map(E=>g.jsx("div",{onClick:()=>{s?.id!==E.id&&i(E)},className:`p-2.5 mb-2 rounded-lg cursor-pointer transition-all duration-200 ${s?.id===E.id?"bg-gradient-to-br from-blue-50 to-blue-100/50 dark:from-blue-900/30 dark:to-blue-800/20 border border-blue-500 shadow-md":"bg-white/60 dark:bg-slate-700/40 border border-slate-200/60 dark:border-slate-600/60 hover:bg-white dark:hover:bg-slate-700/60 hover:border-slate-300 dark:hover:border-slate-500 hover:shadow-sm backdrop-blur-sm"}`,children:g.jsxs("div",{className:"flex items-start justify-between",children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("h3",{className:`font-semibold text-sm mb-1 truncate ${s?.id===E.id?"text-blue-900 dark:text-blue-100":"text-slate-900 dark:text-white"}`,children:E.name}),E.description&&g.jsx("p",{className:`text-xs mb-2 line-clamp-2 ${s?.id===E.id?"text-blue-700 dark:text-blue-300":"text-slate-600 dark:text-slate-400"}`,children:E.description}),g.jsxs("div",{className:"flex items-center gap-2 text-[10px]",children:[g.jsxs("span",{className:`px-1.5 py-0.5 rounded ${s?.id===E.id?"bg-blue-200/50 dark:bg-blue-800/30 text-blue-800 dark:text-blue-200":"bg-slate-100 dark:bg-slate-600/50 text-slate-700 dark:text-slate-300"}`,children:[E.device_count," devices"]}),g.jsx("span",{className:`text-[10px] ${s?.id===E.id?"text-blue-600 dark:text-blue-400":"text-slate-500 dark:text-slate-400"}`,children:new Date(E.updated_at).toLocaleDateString()})]})]}),g.jsxs("div",{className:"flex gap-1 ml-2 flex-shrink-0",children:[g.jsx("button",{onClick:V=>{V.stopPropagation(),B(E.name),h(E.description||""),i(E),S(!0)},className:"p-1 text-slate-600 dark:text-slate-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition-all",title:"Edit",children:g.jsx(Ar,{className:"w-3 h-3"})}),g.jsx("button",{onClick:V=>{V.stopPropagation(),$(E),w(!0)},className:"p-1 text-slate-600 dark:text-slate-400 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-all",title:"Delete",children:g.jsx(Ir,{className:"w-3 h-3"})})]})]})},E.id))}),!A&&g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"border-t border-slate-200/60 dark:border-slate-700/60 p-3 bg-gradient-to-r from-slate-50/50 to-transparent dark:from-slate-800/50",children:[g.jsxs("div",{className:"flex items-center justify-between mb-2",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"p-1.5 bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg shadow-md",children:g.jsx(Si,{className:"w-4 h-4 text-white"})}),g.jsx("h2",{className:"text-base font-bold text-slate-900 dark:text-white",children:"Devices"})]}),g.jsx("button",{onClick:()=>D(!k),className:"p-1 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700/50 rounded transition-all",title:k?"Expand":"Collapse",children:k?g.jsx(Tr,{className:"w-3.5 h-3.5"}):g.jsx(jr,{className:"w-3.5 h-3.5"})})]}),!k&&g.jsxs("div",{className:"relative",children:[g.jsx(Dr,{className:"absolute left-2.5 top-1/2 transform -translate-y-1/2 w-3.5 h-3.5 text-slate-400"}),g.jsx("input",{type:"text",placeholder:"Search devices...",value:G,onChange:E=>re(E.target.value),className:"w-full pl-9 pr-3 py-1.5 text-sm border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none focus:ring-1 focus:ring-blue-500/50 focus:border-blue-500 transition-all"})]})]}),!k&&g.jsx("div",{className:"flex-1 overflow-y-auto p-1.5 min-h-0",children:u?g.jsx("div",{className:"flex items-center justify-center py-6",children:g.jsx(Pn,{className:"w-4 h-4 animate-spin text-slate-400"})}):en.length===0?g.jsx("div",{className:"text-center py-6 text-xs text-slate-500 dark:text-slate-400",children:G?"No devices found":"All devices are in canvas"}):g.jsx("div",{className:"space-y-1",children:en.map(E=>{const Z=(q=>{switch(q){case"online":return"bg-green-500";case"offline":return"bg-red-500";case"warning":return"bg-yellow-500";default:return"bg-gray-500"}})(E.status),U=Mo(E.category||"");return g.jsx("button",{onClick:()=>handleAddDevice(E),className:"w-full p-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700/50 hover:border-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 cursor-pointer transition-all duration-200 text-left",children:g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"p-1 bg-slate-100 dark:bg-slate-600 rounded flex-shrink-0",children:g.jsx(U,{className:"w-3 h-3 text-slate-700 dark:text-slate-200"})}),g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsxs("div",{className:"flex items-center gap-1.5 mb-0.5",children:[g.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${Z}`}),g.jsx("span",{className:"font-medium text-slate-900 dark:text-white text-xs truncate",children:E.name})]}),g.jsx("div",{className:"text-[10px] text-slate-600 dark:text-slate-400 font-mono truncate",children:E.ip_address})]})]})},E.id)})})})]})]}),g.jsxs("div",{className:"flex-1 bg-white/80 dark:bg-slate-800/90 backdrop-blur-xl rounded-lg shadow-lg border border-slate-200/50 dark:border-slate-700/50 flex flex-col min-w-0 overflow-hidden",children:[g.jsx("div",{className:"bg-gradient-to-r from-slate-50/80 via-white/80 to-slate-50/80 dark:from-slate-800/80 dark:via-slate-800/80 dark:to-slate-800/80 backdrop-blur-xl border-b border-slate-200/60 dark:border-slate-700/60 px-3 py-2",children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx("div",{className:"flex-1 min-w-0",children:g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"p-1.5 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg shadow-md",children:g.jsx(Hn,{className:"w-4 h-4 text-white"})}),g.jsxs("div",{children:[g.jsx("h2",{className:"text-base font-bold text-slate-900 dark:text-white truncate",children:s?s.name:"No Topology Selected"}),s&&g.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 truncate",children:s.description||"No description"})]})]})}),s&&g.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:g.jsx("button",{onClick:At,disabled:_,className:"px-3 py-1.5 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1.5 text-xs font-semibold shadow-md hover:shadow-lg transition-all duration-200 hover:scale-105",children:_?g.jsxs(g.Fragment,{children:[g.jsx(Pn,{className:"w-3.5 h-3.5 animate-spin"}),g.jsx("span",{children:"Saving..."})]}):g.jsxs(g.Fragment,{children:[g.jsx($i,{className:"w-3.5 h-3.5"}),g.jsx("span",{children:"Save"})]})})})]})}),g.jsx("div",{className:"flex-1 relative w-full h-full min-h-0",ref:qe,onDrop:Tt,onDragOver:it,children:s?g.jsxs(qs,{nodes:te,edges:fe,onNodesChange:we,onEdgesChange:Ze,onConnect:Ge,onNodeClick:Be,onPaneClick:ye,onEdgeClick:$t,onSelectionChange:Me,onInit:Ke,nodeTypes:Xf,edgeTypes:Ff,fitView:!0,deleteKeyCode:["Backspace","Delete"],nodesDraggable:!0,nodesConnectable:!0,connectOnClick:!1,elementsSelectable:!0,selectionOnDrag:!0,multiSelectionKeyCode:["Meta","Control"],panOnDrag:[1,2],panOnScroll:!0,zoomOnScroll:!0,zoomOnPinch:!0,connectionMode:"loose",connectionRadius:25,connectionLineStyle:{stroke:"#3b82f6",strokeWidth:2.5,strokeDasharray:"5,5"},connectionLineType:"smoothstep",snapToGrid:!1,defaultEdgeOptions:zn,className:"w-full h-full",style:{cursor:"default"},preventScrolling:!1,proOptions:{hideAttribution:!0},onlyRenderVisibleElements:!0,minZoom:.1,maxZoom:2,children:[g.jsx(Of,{gap:30,size:2,color:"#cbd5e1",variant:"dots",style:{opacity:.25}}),g.jsx(jf,{showInteractive:!1}),g.jsx(Cf,{nodeColor:E=>E.data?.status==="online"?"#22c55e":E.data?.status==="offline"?"#ef4444":"#94a3b8",maskColor:"rgba(0, 0, 0, 0.1)",style:{backgroundColor:"transparent"}}),!1,he&&(ee.size>0||Q.size>0)&&g.jsxs(Yt,{position:"top-left",className:"bg-white dark:bg-slate-800 rounded-lg shadow-lg border border-blue-500 dark:border-blue-600 max-w-xs overflow-hidden z-50",children:[g.jsxs("div",{className:"p-2 border-b border-slate-200 dark:border-slate-700 bg-gradient-to-r from-blue-50 to-blue-100/50 dark:from-blue-900/30 dark:to-blue-800/20",children:[g.jsxs("div",{className:"flex items-center justify-between mb-2",children:[g.jsxs("div",{className:"font-semibold text-blue-900 dark:text-blue-100 text-xs flex items-center gap-1.5",children:[g.jsx(Ar,{className:"w-3.5 h-3.5"}),"Bulk Edit"]}),g.jsx("button",{onClick:_e,className:"p-1 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700 rounded transition-colors",title:"Close",children:g.jsx(nn,{className:"w-3.5 h-3.5"})})]}),g.jsxs("div",{className:"text-[10px] text-blue-700 dark:text-blue-300 mb-2",children:[ee.size>0&&`${ee.size} device(s) selected`,ee.size>0&&Q.size>0&&"  ",Q.size>0&&`${Q.size} connection(s) selected`]})]}),g.jsxs("div",{className:"p-2 space-y-2",children:[g.jsxs("div",{className:"flex gap-1.5",children:[g.jsx("button",{onClick:Qe,className:"flex-1 px-2 py-1.5 text-[10px] font-medium bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-colors",children:"Select All"}),g.jsx("button",{onClick:_e,className:"flex-1 px-2 py-1.5 text-[10px] font-medium bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors",children:"Deselect All"})]}),Q.size>0&&g.jsxs("div",{className:"space-y-1.5 border-t border-slate-200 dark:border-slate-700 pt-2",children:[g.jsx("div",{className:"font-semibold text-slate-900 dark:text-white text-xs mb-1",children:"Change Line Type"}),g.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[g.jsx("button",{onClick:()=>$e("straight"),className:"px-2 py-1 text-[10px] font-medium bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors",children:"Straight"}),g.jsx("button",{onClick:()=>$e("bezier"),className:"px-2 py-1 text-[10px] font-medium bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-colors",children:"Bezier"}),g.jsx("button",{onClick:()=>$e("step"),className:"px-2 py-1 text-[10px] font-medium bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded hover:bg-purple-200 dark:hover:bg-purple-900/50 transition-colors",children:"Step"}),g.jsx("button",{onClick:()=>$e("cable"),className:"px-2 py-1 text-[10px] font-medium bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 rounded hover:bg-orange-200 dark:hover:bg-orange-900/50 transition-colors",children:"Cable"})]})]}),g.jsx("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-2",children:g.jsxs("button",{onClick:Fe,className:"w-full px-2 py-1.5 text-[10px] font-medium bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 rounded hover:bg-red-200 dark:hover:bg-red-900/50 transition-colors flex items-center justify-center gap-1",children:[g.jsx(Ir,{className:"w-3 h-3"}),"Delete Selected"]})})]})]}),g.jsxs(Yt,{position:"top-right",className:"bg-white dark:bg-slate-800 rounded-lg shadow-lg border border-slate-200 dark:border-slate-700 max-w-xs overflow-hidden",children:[g.jsxs("div",{className:"p-2 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between bg-slate-50 dark:bg-slate-900/50",children:[g.jsxs("div",{className:"font-semibold text-slate-900 dark:text-white text-xs flex items-center gap-1.5",children:[g.jsx(Mi,{className:"w-3.5 h-3.5"}),"Layouts"]}),g.jsx("button",{onClick:()=>O(!j),className:"p-1 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700 rounded transition-colors",title:j?"Expand Controls":"Collapse Controls",children:j?g.jsx(Tr,{className:"w-3.5 h-3.5"}):g.jsx(jr,{className:"w-3.5 h-3.5"})})]}),!j&&g.jsxs("div",{className:"p-2 space-y-2 max-h-[calc(100vh-12rem)] overflow-y-auto",children:[g.jsxs("div",{className:"space-y-1.5",children:[g.jsx("div",{className:"font-semibold text-slate-900 dark:text-white text-xs mb-1.5",children:"Network Topologies"}),g.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[g.jsx("button",{onClick:()=>Je("bus"),className:"px-2 py-1.5 text-[10px] font-medium bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-colors",title:"Bus topology - nodes connected to a central backbone",children:"Bus"}),g.jsx("button",{onClick:()=>Je("ring"),className:"px-2 py-1.5 text-[10px] font-medium bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded hover:bg-purple-200 dark:hover:bg-purple-900/50 transition-colors",title:"Ring topology - nodes arranged in a circle",children:"Ring"}),g.jsx("button",{onClick:()=>Je("star"),className:"px-2 py-1.5 text-[10px] font-medium bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors",title:"Star topology - central hub with nodes around it",children:"Star"}),g.jsx("button",{onClick:()=>Je("extended-star"),className:"px-2 py-1.5 text-[10px] font-medium bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300 rounded hover:bg-yellow-200 dark:hover:bg-yellow-900/50 transition-colors",title:"Extended Star topology - multi-tiered star structure",children:"Extended Star"}),g.jsx("button",{onClick:()=>Je("hierarchical"),className:"px-2 py-1.5 text-[10px] font-medium bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 rounded hover:bg-indigo-200 dark:hover:bg-indigo-900/50 transition-colors",title:"Hierarchical/Tree topology - tree structure",children:"Hierarchical"}),g.jsx("button",{onClick:()=>Je("mesh"),className:"px-2 py-1.5 text-[10px] font-medium bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 rounded hover:bg-orange-200 dark:hover:bg-orange-900/50 transition-colors",title:"Mesh topology - fully interconnected network",children:"Mesh"})]})]}),g.jsxs("div",{className:"space-y-1.5 border-t border-slate-200 dark:border-slate-700 pt-2",children:[g.jsx("div",{className:"font-semibold text-slate-900 dark:text-white text-xs mb-1.5",children:"Export/Import"}),g.jsxs("div",{className:"flex gap-1.5",children:[g.jsxs("button",{onClick:Dn,className:"flex-1 px-2 py-1.5 text-[10px] font-medium bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-300 rounded hover:bg-emerald-200 dark:hover:bg-emerald-900/50 flex items-center justify-center gap-1 transition-colors",title:"Export topology as JSON",children:[g.jsx(Ti,{className:"w-3 h-3"}),"Export"]}),g.jsxs("label",{className:"flex-1 px-2 py-1.5 text-[10px] font-medium bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 rounded hover:bg-indigo-200 dark:hover:bg-indigo-900/50 flex items-center justify-center gap-1 cursor-pointer transition-colors",children:[g.jsx(_i,{className:"w-3 h-3"}),"Import",g.jsx("input",{type:"file",accept:".json",onChange:jn,className:"hidden"})]})]})]}),g.jsxs("div",{className:"space-y-1 text-[10px] text-slate-600 dark:text-slate-400 border-t border-slate-200 dark:border-slate-700 pt-2",children:[g.jsx("div",{className:"font-semibold text-slate-900 dark:text-white mb-1.5 text-xs",children:"How to connect:"}),g.jsxs("div",{className:"space-y-0.5",children:[g.jsx("div",{children:" Drag from connection point"}),g.jsx("div",{children:" Release on another device"}),g.jsx("div",{children:" Drag devices to move"}),g.jsx("div",{children:" Delete: Select edge + Delete"})]}),g.jsxs("div",{className:"mt-1.5 pt-1.5 border-t border-slate-200 dark:border-slate-600 text-slate-500",children:["Connections: ",fe.length]})]})]})]})]}):g.jsx("div",{className:"flex items-center justify-center h-full text-slate-500 dark:text-slate-400",children:g.jsxs("div",{className:"text-center",children:[g.jsx(Hn,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),g.jsx("p",{className:"text-lg font-medium mb-2",children:"No Topology Selected"}),g.jsx("p",{className:"text-sm",children:"Select a topology from the left panel or create a new one"})]})})})]})]}),X&&g.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 backdrop-blur-sm",onClick:()=>Y(null),children:g.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl p-6 w-96 max-w-[90vw] border border-slate-200 dark:border-slate-700",onClick:E=>E.stopPropagation(),children:[g.jsxs("div",{className:"flex items-center justify-between mb-5",children:[g.jsxs("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white flex items-center gap-2",children:[g.jsx(Di,{className:"w-5 h-5 text-blue-600"}),"Change Line Type"]}),g.jsx("button",{onClick:()=>Y(null),className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 p-1 hover:bg-slate-100 dark:hover:bg-slate-700 rounded transition-colors",children:g.jsx(nn,{className:"w-5 h-5"})})]}),g.jsxs("div",{className:"space-y-4",children:[g.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Select a line type for the connection between nodes"}),g.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[g.jsxs("button",{onClick:()=>gt(X.id,"straight"),className:`px-4 py-4 rounded-lg border-2 transition-all hover:scale-105 ${X.type==="straight"?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 shadow-md":"border-slate-200 dark:border-slate-600 hover:border-blue-300 dark:hover:border-blue-700 text-slate-700 dark:text-slate-300 bg-slate-50 dark:bg-slate-700/50"}`,children:[g.jsx("div",{className:"font-semibold mb-1 text-sm",children:"Straight"}),g.jsx("div",{className:"text-xs opacity-75",children:"Direct line"})]}),g.jsxs("button",{onClick:()=>gt(X.id,"default"),className:`px-4 py-4 rounded-lg border-2 transition-all hover:scale-105 ${X.type==="default"||X.type==="bezier"||!X.type?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 shadow-md":"border-slate-200 dark:border-slate-600 hover:border-blue-300 dark:hover:border-blue-700 text-slate-700 dark:text-slate-300 bg-slate-50 dark:bg-slate-700/50"}`,children:[g.jsx("div",{className:"font-semibold mb-1 text-sm",children:"Curved"}),g.jsx("div",{className:"text-xs opacity-75",children:"Smooth curve"})]}),g.jsxs("button",{onClick:()=>gt(X.id,"step"),className:`px-4 py-4 rounded-lg border-2 transition-all hover:scale-105 ${X.type==="step"?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 shadow-md":"border-slate-200 dark:border-slate-600 hover:border-blue-300 dark:hover:border-blue-700 text-slate-700 dark:text-slate-300 bg-slate-50 dark:bg-slate-700/50"}`,children:[g.jsx("div",{className:"font-semibold mb-1 text-sm",children:"Step"}),g.jsx("div",{className:"text-xs opacity-75",children:"Right-angle"})]}),g.jsxs("button",{onClick:()=>gt(X.id,"cable"),className:`px-4 py-4 rounded-lg border-2 transition-all hover:scale-105 ${X.type==="cable"?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 shadow-md":"border-slate-200 dark:border-slate-600 hover:border-blue-300 dark:hover:border-blue-700 text-slate-700 dark:text-slate-300 bg-slate-50 dark:bg-slate-700/50"}`,children:[g.jsx("div",{className:"font-semibold mb-1 text-sm",children:"Cable"}),g.jsx("div",{className:"text-xs opacity-75",children:"Cable style"})]})]})]}),g.jsx("div",{className:"mt-6 flex justify-end pt-4 border-t border-slate-200 dark:border-slate-700",children:g.jsx("button",{onClick:()=>Y(null),className:"px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors font-medium",children:"Close"})})]})}),y&&g.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:g.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl p-6 w-96",children:[g.jsxs("div",{className:"flex items-center justify-between mb-4",children:[g.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:"Create New Topology"}),g.jsx("button",{onClick:()=>{v(!1),H(""),P("")},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-300",children:g.jsx(nn,{className:"w-5 h-5"})})]}),g.jsxs("div",{className:"space-y-4",children:[g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Name *"}),g.jsx("input",{type:"text",value:z,onChange:E=>H(E.target.value),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter topology name"})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Description"}),g.jsx("textarea",{value:I,onChange:E=>P(E.target.value),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter topology description",rows:3})]})]}),g.jsxs("div",{className:"flex gap-2 mt-6",children:[g.jsx("button",{onClick:at,disabled:!z.trim()||_,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:_?"Creating...":"Create"}),g.jsx("button",{onClick:()=>{v(!1),H(""),P("")},className:"px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700",children:"Cancel"})]})]})}),m&&s&&g.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:g.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl p-6 w-96",children:[g.jsxs("div",{className:"flex items-center justify-between mb-4",children:[g.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:"Edit Topology"}),g.jsx("button",{onClick:()=>{S(!1),B(""),h("")},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-300",children:g.jsx(nn,{className:"w-5 h-5"})})]}),g.jsxs("div",{className:"space-y-4",children:[g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Name *"}),g.jsx("input",{type:"text",value:F,onChange:E=>B(E.target.value),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter topology name"})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Description"}),g.jsx("textarea",{value:L,onChange:E=>h(E.target.value),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter topology description",rows:3})]})]}),g.jsxs("div",{className:"flex gap-2 mt-6",children:[g.jsx("button",{onClick:async()=>{if(!(!F.trim()||!s)){N(!0);try{const V=await(await fetch(`/api/topologies/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({name:F,description:L,canvas_data:s.canvas_data,devices:te.map(Z=>({device_id:Z.data.deviceId,node_id:Z.id,position_x:Z.position.x,position_y:Z.position.y,node_data:Z.data}))})})).json();V.success?(S(!1),B(""),h(""),Ee(),s&&Re(s.id)):alert("Failed to update topology: "+(V.message||"Unknown error"))}catch(E){console.error("Failed to update topology:",E),alert("Failed to update topology")}finally{N(!1)}}},disabled:!F.trim()||_,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:_?"Saving...":"Save"}),g.jsx("button",{onClick:()=>{S(!1),B(""),h("")},className:"px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700",children:"Cancel"})]})]})}),M&&T&&g.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:g.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl p-6 w-96",children:[g.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-4",children:"Delete Topology"}),g.jsxs("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:['Are you sure you want to delete "',T.name,'"? This action cannot be undone.']}),g.jsxs("div",{className:"flex gap-2",children:[g.jsx("button",{onClick:Jt,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Delete"}),g.jsx("button",{onClick:()=>{w(!1),$(null)},className:"px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700",children:"Cancel"})]})]})})]})}export{l0 as default};
